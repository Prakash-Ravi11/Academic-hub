<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Academic Hub ‚Äì Advanced Study Dashboard</title>
<meta name="theme-color" content="#667eea">

<!-- External libraries -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
/* ===== THEME VARIABLES ===== */
:root {
  --bg-primary: #0a0b0f;
  --bg-secondary: #1a1b23;
  --bg-tertiary: #2d2e36;
  --text-primary: #ffffff;
  --text-secondary: #8e8e93;
  --text-muted: #6d6d70;
  --accent-primary: #667eea;
  --accent-secondary: #764ba2;
  --accent-success: #10b981;
  --accent-warning: #f59e0b;
  --accent-danger: #ef4444;
  --border-primary: #3a3b42;
  --glass-bg: rgba(26, 27, 35, 0.8);
  --glass-border: rgba(255, 255, 255, 0.1);
  --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.15);
}

[data-theme="light"] {
  --bg-primary: #f8fafc;
  --bg-secondary: #ffffff;
  --bg-tertiary: #f1f5f9;
  --text-primary: #0f172a;
  --text-secondary: #475569;
  --text-muted: #64748b;
  --border-primary: #e2e8f0;
  --glass-bg: rgba(255, 255, 255, 0.8);
  --glass-border: rgba(0, 0, 0, 0.1);
}

/* ===== GLOBAL STYLES ===== */
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Inter', sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  transition: all 0.3s ease;
  overflow-x: hidden;
}

/* ===== SIDEBAR ===== */
.sidebar {
  position: fixed;
  left: 0;
  top: 0;
  width: 280px;
  height: 100vh;
  background: var(--bg-secondary);
  border-right: 1px solid var(--border-primary);
  z-index: 1000;
  display: flex;
  flex-direction: column;
  transition: all 0.3s ease;
}

.sidebar-header {
  padding: 24px 20px;
  border-bottom: 1px solid var(--border-primary);
}

.logo {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}

.logo-icon {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  font-weight: 700;
  color: white;
}

.logo-text {
  font-size: 20px;
  font-weight: 700;
  color: var(--text-primary);
}

.search-container {
  position: relative;
  margin-bottom: 16px;
}

.search-input {
  width: 100%;
  padding: 12px 16px 12px 40px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border-primary);
  border-radius: 8px;
  color: var(--text-primary);
  font-size: 14px;
  outline: none;
}

.search-input::placeholder { color: var(--text-secondary); }

.search-icon {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-secondary);
}

.sidebar-nav {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
}

.nav-section { margin-bottom: 32px; }

.nav-title {
  font-size: 12px;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 12px;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  color: var(--text-secondary);
  border-radius: 8px;
  margin-bottom: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.nav-item:hover {
  background: var(--bg-tertiary);
  color: var(--text-primary);
}

.nav-item.active {
  background: var(--accent-primary);
  color: white;
}

.nav-icon {
  font-size: 16px;
  width: 20px;
  text-align: center;
}

/* ===== MAIN CONTENT ===== */
.main-content {
  margin-left: 280px;
  min-height: 100vh;
  background: var(--bg-primary);
  transition: all 0.3s ease;
}

.top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 24px 40px;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border-primary);
  position: sticky;
  top: 0;
  z-index: 100;
}

.page-title {
  font-size: 32px;
  font-weight: 700;
  color: var(--text-primary);
}

.top-bar-controls {
  display: flex;
  align-items: center;
  gap: 16px;
}

.real-time-display {
  text-align: right;
  font-family: 'Courier New', monospace;
}

.current-date {
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.current-time {
  font-size: 24px;
  font-weight: 700;
  color: var(--accent-primary);
}

.theme-toggle {
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
  color: var(--text-primary);
  padding: 12px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 18px;
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.theme-toggle:hover {
  transform: scale(1.1);
  background: var(--accent-primary);
  color: white;
}

/* ===== CONTENT AREAS ===== */
.content-area {
  display: none;
  min-height: calc(100vh - 100px);
}

.content-area.active { display: block; }

/* ===== GLASS COMPONENTS ===== */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  box-shadow: var(--shadow-lg);
  transition: all 0.3s ease;
}

.glass:hover { transform: translateY(-4px); }

/* ===== SUBJECTS ===== */
.subjects-container { padding: 40px; }

.subjects-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 32px;
}

.subjects-stats {
  display: flex;
  gap: 32px;
  align-items: center;
}

.stat-item { text-align: center; }

.stat-number {
  font-size: 32px;
  font-weight: 700;
  color: var(--accent-primary);
  display: block;
  font-family: 'Courier New', monospace;
}

.stat-label {
  font-size: 12px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.subjects-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
  gap: 24px;
}

.subject-card {
  padding: 24px;
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
}

.subject-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: var(--accent-color);
}

.subject-card:hover { transform: translateY(-6px); }

.subject-card.math { --accent-color: #667eea; }
.subject-card.dsa { --accent-color: #4ecdc4; }
.subject-card.coa { --accent-color: #45b7d1; }
.subject-card.prog { --accent-color: #f9ca24; }
.subject-card.os { --accent-color: #f0932b; }
.subject-card.uhv { --accent-color: #eb4d4b; }

.subject-header {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  margin-bottom: 20px;
  position: relative;
}

.subject-icon {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  color: white;
  flex-shrink: 0;
}

.subject-info { flex: 1; }

.subject-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 4px;
  line-height: 1.3;
}

.subject-code {
  font-size: 12px;
  color: var(--text-secondary);
  font-weight: 500;
  margin-bottom: 8px;
}

.subject-details {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 20px;
}

.detail-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.detail-label {
  font-size: 14px;
  color: var(--text-secondary);
}

.detail-value {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
}

.faculty-name { color: var(--accent-color) !important; }

.progress-section { margin-bottom: 20px; }

.time-display {
  font-family: 'Courier New', monospace;
  font-size: 14px;
  font-weight: 600;
  color: var(--accent-color);
  margin-bottom: 8px;
}

.progress-bar {
  width: 100%;
  height: 8px;
  background: var(--bg-tertiary);
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 8px;
}

.progress-fill {
  height: 100%;
  background: var(--accent-color);
  width: 0%;
  transition: width 1s ease;
  border-radius: 4px;
}

.progress-text {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  color: var(--text-secondary);
}

.file-upload-area {
  border: 2px dashed var(--border-primary);
  border-radius: 8px;
  padding: 20px;
  margin-top: 16px;
  text-align: center;
  background: var(--bg-tertiary);
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
}

.file-upload-area:hover,
.file-upload-area.dragover {
  border-color: var(--accent-primary);
  background: rgba(102, 126, 234, 0.1);
}

.upload-text {
  color: var(--text-secondary);
  font-size: 14px;
  margin-bottom: 4px;
}

.upload-subtext {
  color: var(--text-muted);
  font-size: 12px;
}

.upload-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  background: var(--accent-primary);
  width: 0%;
  transition: width 0.3s ease;
}

.subject-actions {
  display: flex;
  gap: 12px;
}

.btn {
  padding: 12px 16px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn-primary {
  background: var(--accent-primary);
  color: white;
  flex: 1;
}

.btn-primary:hover {
  background: var(--accent-secondary);
  transform: translateY(-1px);
}

.btn-secondary {
  background: var(--bg-tertiary);
  color: var(--text-secondary);
  border: 1px solid var(--border-primary);
}

.btn-secondary:hover {
  background: var(--border-primary);
  color: var(--text-primary);
}

.btn-secondary.active {
  background: var(--accent-primary);
  color: white;
}

/* ===== MODALS ===== */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

.modal.show { display: flex; }

.modal-content {
  background: var(--bg-secondary);
  border-radius: 12px;
  padding: 32px;
  max-width: 500px;
  width: 90%;
  border: 1px solid var(--border-primary);
  box-shadow: var(--shadow-lg);
  max-height: 80vh;
  overflow-y: auto;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
}

.modal-title {
  font-size: 24px;
  font-weight: 700;
  color: var(--text-primary);
}

.modal-close {
  background: none;
  border: none;
  font-size: 24px;
  color: var(--text-secondary);
  cursor: pointer;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s ease;
}

.modal-close:hover {
  background: var(--bg-tertiary);
  color: var(--text-primary);
}

/* ===== TIMER ===== */
.timer-display {
  font-family: 'Courier New', monospace;
  font-size: 48px;
  font-weight: 700;
  color: var(--accent-primary);
  text-align: center;
  margin: 24px 0;
}

.timer-controls {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin: 24px 0;
}

.timer-btn {
  padding: 12px 24px;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.timer-btn.start {
  background: var(--accent-success);
  color: white;
}

.timer-btn.pause {
  background: var(--accent-warning);
  color: white;
}

.timer-btn.stop {
  background: var(--accent-danger);
  color: white;
}

.timer-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  margin-top: 24px;
  padding-top: 24px;
  border-top: 1px solid var(--border-primary);
}

.timer-stat {
  text-align: center;
}

.timer-stat-value {
  font-size: 20px;
  font-weight: 700;
  color: var(--accent-primary);
  display: block;
}

.timer-stat-label {
  font-size: 12px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* ===== MATERIALS ===== */
.materials-list {
  max-height: 400px;
  overflow-y: auto;
  margin: 20px 0;
}

.file-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  background: var(--bg-tertiary);
  border-radius: 8px;
  margin-bottom: 12px;
  border: 1px solid var(--border-primary);
}

.file-info {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 12px;
}

.file-icon {
  font-size: 24px;
}

.file-details {
  flex: 1;
}

.file-name {
  font-size: 14px;
  color: var(--text-primary);
  font-weight: 600;
  margin-bottom: 4px;
}

.file-meta {
  font-size: 12px;
  color: var(--text-secondary);
}

.file-actions {
  display: flex;
  gap: 8px;
}

.file-btn {
  padding: 8px 12px;
  background: var(--bg-secondary);
  border: 1px solid var(--border-primary);
  border-radius: 6px;
  color: var(--text-primary);
  cursor: pointer;
  font-size: 12px;
  transition: all 0.2s ease;
}

.file-btn:hover {
  background: var(--accent-primary);
  color: white;
}

.file-btn.danger:hover {
  background: var(--accent-danger);
}

/* ===== PROGRESS ANALYTICS ===== */
.progress-container {
  padding: 40px;
  max-width: 1400px;
  margin: 0 auto;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 24px;
  margin-bottom: 32px;
}

.stat-card {
  padding: 24px;
  text-align: center;
}

.chart-container {
  padding: 24px;
  min-height: 350px;
}

.charts-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 24px;
  margin-bottom: 40px;
}

.chart-container.full-width {
  grid-column: 1 / -1;
}

.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.chart-title {
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary);
}

/* ===== HEATMAP ===== */
.heatmap-container {
  display: grid;
  grid-template-columns: repeat(10, 1fr);
  gap: 3px;
  margin: 20px 0;
}

.heatmap-day {
  aspect-ratio: 1;
  border-radius: 3px;
  background: var(--bg-tertiary);
  cursor: pointer;
  transition: all 0.2s ease;
}

.heatmap-day:hover {
  transform: scale(1.2);
}

.heatmap-day[data-level="1"] { background: rgba(102, 126, 234, 0.3); }
.heatmap-day[data-level="2"] { background: rgba(102, 126, 234, 0.5); }
.heatmap-day[data-level="3"] { background: rgba(102, 126, 234, 0.7); }
.heatmap-day[data-level="4"] { background: rgba(102, 126, 234, 1); }

/* ===== AI TOOLS ===== */
.ai-tools-container {
  padding: 40px;
  max-width: 1200px;
  margin: 0 auto;
}

.ai-tools-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 24px;
  margin-bottom: 40px;
}

.ai-tool-card {
  padding: 32px;
  text-align: center;
}

.tool-icon {
  width: 64px;
  height: 64px;
  background: var(--accent-primary);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  margin: 0 auto 16px;
  color: white;
}

.tool-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 8px;
}

.tool-description {
  color: var(--text-secondary);
  margin-bottom: 20px;
}

.tool-status {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  margin-bottom: 16px;
}

.tool-status.connected {
  background: rgba(16, 185, 129, 0.2);
  color: var(--accent-success);
}

.tool-status.disconnected {
  background: rgba(239, 68, 68, 0.2);
  color: var(--accent-danger);
}

.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: currentColor;
}

/* ===== CHAT ===== */
.chat-container {
  height: 500px;
  border: 1px solid var(--border-primary);
  border-radius: 12px;
  overflow: hidden;
  margin-bottom: 16px;
  display: flex;
  flex-direction: column;
}

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  background: var(--bg-primary);
}

.chat-message {
  margin-bottom: 16px;
  max-width: 80%;
}

.chat-message.user {
  margin-left: auto;
  background: var(--accent-primary);
  color: white;
  padding: 12px 16px;
  border-radius: 12px;
}

.chat-message.ai {
  background: var(--bg-tertiary);
  color: var(--text-primary);
  padding: 12px 16px;
  border-radius: 12px;
}

.chat-input-container {
  display: flex;
  gap: 12px;
  padding: 20px;
  background: var(--bg-secondary);
  border-top: 1px solid var(--border-primary);
}

.chat-input {
  flex: 1;
  padding: 12px 16px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border-primary);
  border-radius: 8px;
  color: var(--text-primary);
  outline: none;
}

.send-btn {
  padding: 12px 20px;
  background: var(--accent-primary);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}

.send-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* ===== FORMS ===== */
.form-group {
  margin-bottom: 20px;
}

.form-label {
  display: block;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 8px;
}

.form-input,
.form-select {
  width: 100%;
  padding: 12px 16px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border-primary);
  border-radius: 8px;
  color: var(--text-primary);
  font-size: 14px;
  outline: none;
}

.form-input:focus,
.form-select:focus {
  border-color: var(--accent-primary);
}

.form-help {
  font-size: 12px;
  color: var(--text-secondary);
  margin-top: 4px;
}

/* ===== ACHIEVEMENTS ===== */
.achievements-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 16px;
}

.achievement-badge {
  padding: 20px;
  text-align: center;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.achievement-badge.unlocked {
  background: linear-gradient(135deg, var(--accent-success), rgba(16, 185, 129, 0.8));
}

.achievement-badge.locked {
  opacity: 0.5;
}

.achievement-icon {
  font-size: 40px;
  margin-bottom: 12px;
  display: block;
}

.achievement-title {
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.achievement-desc {
  font-size: 12px;
  color: var(--text-secondary);
}

/* ===== RESPONSIVE ===== */
@media (max-width: 1024px) {
  .sidebar {
    transform: translateX(-100%);
  }

  .sidebar.open {
    transform: translateX(0);
  }

  .main-content {
    margin-left: 0;
  }

  .mobile-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
    display: none;
  }

  .mobile-overlay.show {
    display: block;
  }
}

@media (max-width: 768px) {
  .subjects-grid {
    grid-template-columns: 1fr;
  }

  .charts-grid {
    grid-template-columns: 1fr;
  }

  .top-bar {
    padding: 16px 20px;
  }

  .page-title {
    font-size: 24px;
  }

  .subjects-container,
  .progress-container,
  .ai-tools-container {
    padding: 20px;
  }
}

/* ===== UTILITY ===== */
.hidden { display: none !important; }
.show { display: flex !important; }

/* ===== NOTIFICATIONS ===== */
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: var(--bg-secondary);
  color: var(--text-primary);
  padding: 16px 24px;
  border-radius: 12px;
  border: 1px solid var(--border-primary);
  box-shadow: var(--shadow-lg);
  z-index: 10000;
  max-width: 400px;
  animation: slideIn 0.3s ease;
}

.notification.success {
  border-left: 4px solid var(--accent-success);
}

.notification.error {
  border-left: 4px solid var(--accent-danger);
}

@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}
</style>
</head>

<body data-theme="dark">
<!-- Mobile Overlay -->
<div class="mobile-overlay" id="mobileOverlay"></div>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="logo">
      <div class="logo-icon">AH</div>
      <div class="logo-text">Academic Hub</div>
    </div>
    
    <div class="search-container">
      <span class="search-icon">üîç</span>
      <input type="text" class="search-input" placeholder="Search subjects..." id="searchInput">
    </div>
  </div>

  <div class="sidebar-nav">
    <div class="nav-section">
      <div class="nav-title">Dashboard</div>
      <div class="nav-item active" data-content="subjects">
        <span class="nav-icon">üìö</span>
        <span>My Subjects</span>
      </div>
      <div class="nav-item" data-content="progress">
        <span class="nav-icon">üìä</span>
        <span>Progress Analytics</span>
      </div>
      <div class="nav-item" data-content="schedule">
        <span class="nav-icon">üìÖ</span>
        <span>Smart Schedule</span>
      </div>
      <div class="nav-item" data-content="materials">
        <span class="nav-icon">üìÅ</span>
        <span>Materials Hub</span>
      </div>
    </div>

    <div class="nav-section">
      <div class="nav-title">AI Tools</div>
      <div class="nav-item" data-content="ai-chat">
        <span class="nav-icon">ü§ñ</span>
        <span>AI Assistant</span>
      </div>
      <div class="nav-item" data-content="notebook-llm">
        <span class="nav-icon">üìì</span>
        <span>NotebookLLM</span>
      </div>
    </div>

    <div class="nav-section">
      <div class="nav-title">Tools</div>
      <div class="nav-item" data-content="timer">
        <span class="nav-icon">‚è±Ô∏è</span>
        <span>Focus Timer</span>
      </div>
      <div class="nav-item" data-content="notes">
        <span class="nav-icon">üìù</span>
        <span>Smart Notes</span>
      </div>
      <div class="nav-item" data-content="goals">
        <span class="nav-icon">üéØ</span>
        <span>Study Goals</span>
      </div>
    </div>

    <div class="nav-section">
      <div class="nav-title">Account</div>
      <div class="nav-item" data-content="settings">
        <span class="nav-icon">‚öôÔ∏è</span>
        <span>Settings</span>
      </div>
      <div class="nav-item" data-content="help">
        <span class="nav-icon">‚ùì</span>
        <span>Help</span>
      </div>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="main-content">
  <!-- Subjects Content -->
  <div class="content-area active" id="subjects-content">
    <div class="top-bar">
      <h1 class="page-title">My Subjects</h1>
      <div class="top-bar-controls">
        <div class="real-time-display">
          <div class="current-date" id="currentDate"></div>
          <div class="current-time" id="currentTime"></div>
        </div>
        <button class="btn btn-primary" onclick="addNewSubject()">‚ûï Add Subject</button>
        <button class="theme-toggle" id="themeToggle">üåô</button>
      </div>
    </div>

    <div class="subjects-container">
      <div class="subjects-header">
        <div class="subjects-stats">
          <div class="stat-item">
            <span class="stat-number" id="totalSubjects">6</span>
            <span class="stat-label">Total Subjects</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="totalCredits">23</span>
            <span class="stat-label">Credits</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="avgProgress">0%</span>
            <span class="stat-label">Avg Progress</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="totalStudyTime">0h</span>
            <span class="stat-label">Study Time</span>
          </div>
        </div>
      </div>

      <div class="subjects-grid" id="subjectsGrid"></div>
    </div>
  </div>

  <!-- Progress Analytics Content -->
  <div class="content-area" id="progress-content">
    <div class="top-bar">
      <h1 class="page-title">üìä Progress Analytics</h1>
      <div class="top-bar-controls">
        <div class="real-time-display">
          <div class="current-date" id="progressCurrentDate"></div>
          <div class="current-time" id="progressCurrentTime"></div>
        </div>
        <button class="theme-toggle">üåô</button>
      </div>
    </div>

    <div class="progress-container">
      <div class="stats-grid">
        <div class="glass stat-card">
          <div class="stat-icon">üìö</div>
          <div class="stat-number" id="totalStudyTimeProgress">0h</div>
          <div class="stat-label">Total Study Time</div>
        </div>
        <div class="glass stat-card">
          <div class="stat-icon">üéØ</div>
          <div class="stat-number" id="averageProgressStat">0%</div>
          <div class="stat-label">Average Progress</div>
        </div>
        <div class="glass stat-card">
          <div class="stat-icon">üî•</div>
          <div class="stat-number" id="studyStreak">0</div>
          <div class="stat-label">Study Streak</div>
        </div>
        <div class="glass stat-card">
          <div class="stat-icon">üìà</div>
          <div class="stat-number" id="todayStudyTime">0h</div>
          <div class="stat-label">Today's Study</div>
        </div>
      </div>

      <div class="charts-grid">
        <div class="glass chart-container">
          <div class="chart-header">
            <h3 class="chart-title">üìä Weekly Progress</h3>
            <select id="weeklyChartSubject">
              <option value="all">All Subjects</option>
            </select>
          </div>
          <canvas id="weeklyProgressChart"></canvas>
        </div>

        <div class="glass chart-container">
          <div class="chart-header">
            <h3 class="chart-title">üéØ Subject Distribution</h3>
          </div>
          <canvas id="subjectDistributionChart"></canvas>
        </div>

        <div class="glass chart-container">
          <div class="chart-header">
            <h3 class="chart-title">üìà Performance Trend</h3>
            <div>
              <button class="btn btn-secondary active" data-period="7">7D</button>
              <button class="btn btn-secondary" data-period="30">30D</button>
              <button class="btn btn-secondary" data-period="90">90D</button>
            </div>
          </div>
          <canvas id="performanceTrendChart"></canvas>
        </div>

        <div class="glass chart-container full-width">
          <div class="chart-header">
            <h3 class="chart-title">üóìÔ∏è Study Activity Heatmap (Last 30 Days)</h3>
          </div>
          <div class="heatmap-container" id="studyHeatmap"></div>
        </div>
      </div>

      <h3 style="margin: 24px 0 16px; color: var(--text-primary);">üèÜ Achievements</h3>
      <div class="achievements-grid" id="achievementsGrid"></div>
    </div>
  </div>

  <!-- AI Chat Content -->
  <div class="content-area" id="ai-chat-content">
    <div class="top-bar">
      <h1 class="page-title">ü§ñ AI Assistant</h1>
      <div class="top-bar-controls">
        <button class="btn btn-secondary" onclick="openSettings()">‚öôÔ∏è API Settings</button>
        <button class="theme-toggle">üåô</button>
      </div>
    </div>

    <div class="ai-tools-container">
      <div class="ai-tools-grid">
        <div class="glass ai-tool-card">
          <div class="tool-icon">üí¨</div>
          <div class="tool-title">ChatGPT Assistant</div>
          <div class="tool-description">Get instant help with your studies using ChatGPT via OpenRouter API</div>
          <div class="tool-status disconnected" id="chatgpt-status">
            <span class="status-dot"></span>
            <span>Not Connected</span>
          </div>
          <button onclick="initializeChatGPT()" class="btn btn-primary">Start Chat</button>
        </div>

        <div class="glass ai-tool-card">
          <div class="tool-icon">üìñ</div>
          <div class="tool-title">Study Assistant</div>
          <div class="tool-description">AI that understands your subjects and provides contextual help</div>
          <div class="tool-status connected">
            <span class="status-dot"></span>
            <span>Ready</span>
          </div>
          <button onclick="initializeChatGPT()" class="btn btn-primary">Ask Questions</button>
        </div>
      </div>

      <div class="glass" id="chatPanel" style="display: none;">
        <div class="chart-header">
          <h3 class="chart-title">üí¨ AI Study Assistant</h3>
          <button onclick="closeChatInterface()" class="btn btn-secondary">‚úï</button>
        </div>
        <div class="chat-container">
          <div class="chat-messages" id="chatMessages">
            <div class="chat-message ai">
              <strong>AI Assistant:</strong> Hello! I'm here to help with your studies. What would you like to know?
            </div>
          </div>
          <div class="chat-input-container">
            <input type="text" class="chat-input" id="chatInput" placeholder="Ask me anything about your subjects...">
            <button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- NotebookLLM Content -->
  <div class="content-area" id="notebook-llm-content">
    <div class="top-bar">
      <h1 class="page-title">üìì NotebookLLM</h1>
      <div class="top-bar-controls">
        <button onclick="openSettings()" class="btn btn-secondary">‚öôÔ∏è Settings</button>
        <button class="theme-toggle">üåô</button>
      </div>
    </div>

    <div class="ai-tools-container">
      <div class="glass">
        <div class="chart-header">
          <h3 class="chart-title">üìì Document Analysis & Insights</h3>
        </div>
        <div style="text-align: center; padding: 40px;">
          <div class="tool-icon" style="margin: 0 auto 20px;">üìÅ</div>
          <p style="color: var(--text-secondary); margin-bottom: 20px;">
            Upload your study materials to get AI-powered insights and summaries.
          </p>
          <button class="btn btn-primary" onclick="uploadDocument()">üìé Upload Document</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Other Content Areas -->
  <div class="content-area" id="schedule-content">
    <div class="top-bar">
      <h1 class="page-title">üìÖ Smart Schedule</h1>
      <button class="theme-toggle">üåô</button>
    </div>
    <div style="padding: 40px; text-align: center;">
      <div class="glass" style="padding: 40px;">
        <h3>Smart Scheduling</h3>
        <p style="color: var(--text-secondary);">AI-powered schedule optimization coming soon!</p>
      </div>
    </div>
  </div>

  <div class="content-area" id="materials-content">
    <div class="top-bar">
      <h1 class="page-title">üìÅ Materials Hub</h1>
      <button class="theme-toggle">üåô</button>
    </div>
    <div style="padding: 40px; text-align: center;">
      <div class="glass" style="padding: 40px;">
        <h3>Materials Hub</h3>
        <p style="color: var(--text-secondary);">Centralized materials management!</p>
      </div>
    </div>
  </div>

  <div class="content-area" id="timer-content">
    <div class="top-bar">
      <h1 class="page-title">‚è±Ô∏è Focus Timer</h1>
      <button class="theme-toggle">üåô</button>
    </div>
    <div style="padding: 40px; text-align: center;">
      <div class="glass" style="padding: 40px;">
        <h3>Focus Timer</h3>
        <p style="color: var(--text-secondary);">Pomodoro timer and focus sessions!</p>
      </div>
    </div>
  </div>

  <div class="content-area" id="notes-content">
    <div class="top-bar">
      <h1 class="page-title">üìù Smart Notes</h1>
      <button class="theme-toggle">üåô</button>
    </div>
    <div style="padding: 40px; text-align: center;">
      <div class="glass" style="padding: 40px;">
        <h3>Smart Notes</h3>
        <p style="color: var(--text-secondary);">AI-enhanced note taking!</p>
      </div>
    </div>
  </div>

  <div class="content-area" id="goals-content">
    <div class="top-bar">
      <h1 class="page-title">üéØ Study Goals</h1>
      <button class="theme-toggle">üåô</button>
    </div>
    <div style="padding: 40px; text-align: center;">
      <div class="glass" style="padding: 40px;">
        <h3>Study Goals</h3>
        <p style="color: var(--text-secondary);">Set and track your academic goals!</p>
      </div>
    </div>
  </div>

  <div class="content-area" id="settings-content">
    <div class="top-bar">
      <h1 class="page-title">‚öôÔ∏è Settings</h1>
      <button class="theme-toggle">üåô</button>
    </div>
    <div style="padding: 40px;">
      <div class="glass" style="padding: 32px;">
        <h3 style="margin-bottom: 24px;">üîë API Configuration</h3>
        <div class="form-group">
          <label class="form-label">OpenRouter API Key</label>
          <input type="password" class="form-input" id="settingsApiKey" placeholder="Enter your OpenRouter API key">
          <div class="form-help">Get your API key from <a href="https://openrouter.ai" target="_blank" style="color: var(--accent-primary);">openrouter.ai</a></div>
        </div>
        <div class="form-group">
          <label class="form-label">Preferred AI Model</label>
          <select class="form-select" id="settingsModel">
            <option value="openai/gpt-4-turbo">GPT-4 Turbo</option>
            <option value="openai/gpt-3.5-turbo">GPT-3.5 Turbo</option>
            <option value="anthropic/claude-3-opus">Claude-3 Opus</option>
          </select>
        </div>
        <button onclick="saveMainSettings()" class="btn btn-primary">üíæ Save Settings</button>
      </div>
    </div>
  </div>

  <div class="content-area" id="help-content">
    <div class="top-bar">
      <h1 class="page-title">‚ùì Help</h1>
      <button class="theme-toggle">üåô</button>
    </div>
    <div style="padding: 40px; text-align: center;">
      <div class="glass" style="padding: 40px;">
        <h3>Help & Support</h3>
        <p style="color: var(--text-secondary);">Get help with Academic Hub features!</p>
      </div>
    </div>
  </div>
</div>

<!-- Study Timer Modal -->
<div class="modal" id="timerModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title" id="timerModalTitle">Study Timer</h2>
      <button class="modal-close" onclick="closeTimer()">√ó</button>
    </div>
    
    <div class="timer-display" id="timerDisplay">00:00:00</div>
    
    <div class="timer-controls">
      <button class="timer-btn start" id="startBtn">‚ñ∂Ô∏è Start</button>
      <button class="timer-btn pause hidden" id="pauseBtn">‚è∏Ô∏è Pause</button>
      <button class="timer-btn stop hidden" id="stopBtn">‚èπÔ∏è Stop</button>
    </div>

    <div class="timer-stats">
      <div class="timer-stat">
        <span class="timer-stat-value" id="sessionTime">0m</span>
        <span class="timer-stat-label">Session</span>
      </div>
      <div class="timer-stat">
        <span class="timer-stat-value" id="todayTime">0m</span>
        <span class="timer-stat-label">Today</span>
      </div>
    </div>
  </div>
</div>

<!-- Materials Modal -->
<div class="modal" id="materialsModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title" id="materialsTitle">Materials</h2>
      <button class="modal-close" onclick="closeMaterials()">√ó</button>
    </div>
    
    <div class="materials-list" id="materialsList"></div>
    
    <div style="text-align: center; margin-top: 20px;">
      <button class="btn btn-primary" id="uploadMoreBtn">üìé Upload Files</button>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div class="modal" id="settingsModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">üîë OpenRouter API Settings</h2>
      <button class="modal-close" onclick="closeSettings()">√ó</button>
    </div>
    
    <div class="form-group">
      <label class="form-label">API Key</label>
      <input class="form-input" id="apiKeyInput" type="password" placeholder="sk-or-v1-...">
      <div class="form-help">Your API key is stored securely in your browser only.</div>
    </div>
    
    <div class="form-group">
      <label class="form-label">Default Model</label>
      <select class="form-select" id="modelSelect">
        <option value="openai/gpt-4-turbo">GPT-4 Turbo</option>
        <option value="openai/gpt-3.5-turbo">GPT-3.5 Turbo</option>
        <option value="anthropic/claude-3-sonnet">Claude-3 Sonnet</option>
      </select>
    </div>
    
    <div style="text-align: center; margin-top: 24px;">
      <button class="btn btn-primary" onclick="saveSettings()">üíæ Save</button>
    </div>
  </div>
</div>

<script>
/* ===== GLOBAL STATE ===== */
const defaultSubjects = [
  {id:'math', icon:'üìê', title:'Transforms and Boundary Value Problems', code:'21MAB201T', credits:4, faculty:'Dr. V. Vidhya', color:'#667eea'},
  {id:'dsa', icon:'üå≥', title:'Data Structures and Algorithms', code:'21CSC201J', credits:4, faculty:'Dr. Kalpana C', color:'#4ecdc4'},
  {id:'coa', icon:'üèóÔ∏è', title:'Computer Organization and Architecture', code:'21CSS201T', credits:4, faculty:'Dr. Meenakshi M', color:'#45b7d1'},
  {id:'prog', icon:'üë®‚Äçüíª', title:'Advanced Programming Practice', code:'21CSC203P', credits:4, faculty:'Dr. Prince Chelladurai S', color:'#f9ca24'},
  {id:'os', icon:'‚öôÔ∏è', title:'Operating Systems', code:'21CSC202J', credits:4, faculty:'Dr. G. Priyadharshini', color:'#f0932b'},
  {id:'uhv', icon:'üß†', title:'Universal Human Values - II', code:'21LEM202T', credits:3, faculty:'Dr. Caleb Theodar M', color:'#eb4d4b'}
];

let subjects = JSON.parse(localStorage.getItem('ah-subjects') || 'null') || defaultSubjects;
let files = JSON.parse(localStorage.getItem('ah-files') || 'null') || {};
let studyTimes = JSON.parse(localStorage.getItem('ah-studyTimes') || 'null') || {};
let dailyLog = JSON.parse(localStorage.getItem('ah-dailyLog') || 'null') || {};
let aiConfig = JSON.parse(localStorage.getItem('ah-ai') || 'null') || {key:'', model:'openai/gpt-4-turbo'};

let timer = null, startT = 0, paused = 0, currentSub = null;
const charts = {};

/* ===== INITIALIZATION ===== */
document.addEventListener('DOMContentLoaded', () => {
  buildSubjectCards();
  refreshStats();
  buildSubjectSelect();
  initTheme();
  tickClock();
  setInterval(tickClock, 1000);
  initNav();
  initCharts();
  initHeatmap();
  initAchievements();
  checkAIStatus();
});

/* ===== NAVIGATION ===== */
function initNav() {
  document.querySelectorAll('.nav-item').forEach(el => {
    el.onclick = () => {
      const id = el.dataset.content;
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      el.classList.add('active');
      document.querySelectorAll('.content-area').forEach(c => c.classList.remove('active'));
      document.getElementById(id + '-content').classList.add('active');
      if (id === 'progress') { updateCharts(); }
    };
  });
}

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('mobileOverlay').classList.toggle('show');
}

/* ===== CLOCK ===== */
function tickClock() {
  const now = new Date();
  const d = now.toLocaleDateString(undefined, {weekday:'long', day:'numeric', month:'short', year:'numeric'});
  const t = now.toLocaleTimeString(undefined, {hour:'2-digit', minute:'2-digit', second:'2-digit'});
  document.querySelectorAll('#currentDate, #progressCurrentDate').forEach(e => e.textContent = d);
  document.querySelectorAll('#currentTime, #progressCurrentTime').forEach(e => e.textContent = t);
}

/* ===== THEME ===== */
function initTheme() {
  const btns = document.querySelectorAll('.theme-toggle');
  btns.forEach(b => b.onclick = () => {
    const body = document.body, n = body.dataset.theme === 'dark' ? 'light' : 'dark';
    body.dataset.theme = n;
    localStorage.setItem('ah-theme', n);
    btns.forEach(x => x.textContent = n === 'dark' ? 'üåô' : '‚òÄÔ∏è');
    updateChartsColors();
  });
  
  const saved = localStorage.getItem('ah-theme');
  if (saved) { document.body.dataset.theme = saved; }
  btns.forEach(x => x.textContent = document.body.dataset.theme === 'dark' ? 'üåô' : '‚òÄÔ∏è');
}

/* ===== SUBJECT MANAGEMENT ===== */
function buildSubjectCards() {
  const grid = document.getElementById('subjectsGrid');
  grid.innerHTML = '';
  
  subjects.forEach(s => {
    const pct = Math.min((studyTimes[s.id] || 0) / 14400 * 100, 100); // 4h target
    grid.insertAdjacentHTML('beforeend', `
      <div class="glass subject-card ${s.id}" data-id="${s.id}">
        <div class="subject-header">
          <div class="subject-icon" style="background:${s.color}">${s.icon}</div>
          <div class="subject-info">
            <div class="subject-title">${s.title}</div>
            <div class="subject-code">${s.code}</div>
          </div>
          <button class="modal-close" style="font-size:18px" onclick="deleteSubject('${s.id}')" title="Delete">üóëÔ∏è</button>
        </div>
        <div class="subject-details">
          <div class="detail-item"><span class="detail-label">Credits</span><span class="detail-value">${s.credits}</span></div>
          <div class="detail-item"><span class="detail-label">Faculty</span><span class="detail-value faculty-name">${s.faculty}</span></div>
        </div>
        <div class="progress-section">
          <div class="time-display">Study <span id="time-${s.id}">${formatTimeH(studyTimes[s.id] || 0)}</span></div>
          <div class="progress-bar"><div class="progress-fill" id="bar-${s.id}" style="width:${pct}%"></div></div>
          <div class="progress-text"><span id="pct-${s.id}">${Math.round(pct)}%</span><span>Target 4h</span></div>
        </div>
        <div class="file-upload-area" onclick="triggerUpload('${s.id}')" ondragover="dragOver(event,this)" ondragleave="dragLeave(event,this)" ondrop="dropFiles(event,'${s.id}')">
          <div class="upload-text">üìé Drop files here or click to upload</div>
          <div class="upload-subtext">PDF, DOCX, PPTX, images...</div>
          <div class="upload-progress" id="up-${s.id}"></div>
        </div>
        <div class="subject-actions">
          <button class="btn btn-secondary" onclick="openMaterials('${s.id}')">üìÅ Materials</button>
          <button class="btn btn-primary" onclick="openTimer('${s.id}')">‚ñ∂Ô∏è Study Now</button>
        </div>
      </div>
    `);
  });
  
  document.getElementById('totalSubjects').textContent = subjects.length;
  document.getElementById('totalCredits').textContent = subjects.reduce((n, s) => n + s.credits, 0);
}

function addNewSubject() {
  const title = prompt('Subject title:');
  if (!title) return;
  
  const code = prompt('Subject code:') || 'NEW';
  const faculty = prompt('Faculty name:') || 'TBD';
  const credits = parseInt(prompt('Credits:') || '3');
  
  const id = 'sub' + Date.now();
  const colors = ['#667eea', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7', '#fd79a8'];
  const color = colors[Math.floor(Math.random() * colors.length)];
  
  subjects.push({
    id, title, code, faculty, credits, color,
    icon: 'üìñ'
  });
  
  save('subjects', subjects);
  buildSubjectCards();
  buildSubjectSelect();
  show('success', 'Subject added successfully!');
}

function deleteSubject(id) {
  if (!confirm('Delete this subject and all its data?')) return;
  
  subjects = subjects.filter(s => s.id !== id);
  delete files[id];
  delete studyTimes[id];
  
  saveAll();
  buildSubjectCards();
  buildSubjectSelect();
  refreshStats();
  updateCharts();
  show('success', 'Subject deleted');
}

/* ===== FILE UPLOAD ===== */
function triggerUpload(sub) {
  const i = document.createElement('input');
  i.type = 'file';
  i.multiple = true;
  i.onchange = e => saveFiles(sub, [...e.target.files]);
  i.click();
}

function dragOver(e, el) {
  e.preventDefault();
  el.classList.add('dragover');
}

function dragLeave(e, el) {
  e.preventDefault();
  el.classList.remove('dragover');
}

function dropFiles(e, sub) {
  e.preventDefault();
  e.currentTarget.classList.remove('dragover');
  saveFiles(sub, [...e.dataTransfer.files]);
}

function saveFiles(sub, fls) {
  if (!files[sub]) files[sub] = [];
  const bar = document.getElementById('up-' + sub);
  let done = 0;
  
  fls.forEach(f => {
    if (f.size > 10 * 1024 * 1024) {
      show('error', f.name + ' is too large (max 10MB)');
      done++;
      return;
    }
    
    const r = new FileReader();
    r.onload = ev => {
      files[sub].push({
        id: Date.now() + Math.random(),
        name: f.name,
        size: f.size,
        data: ev.target.result,
        ts: Date.now()
      });
      done++;
      if (bar) bar.style.width = (done / fls.length * 100) + '%';
      if (done === fls.length) {
        if (bar) bar.style.width = '0%';
        save('files', files);
        show('success', 'Upload complete!');
      }
    };
    r.readAsDataURL(f);
  });
}

/* ===== MATERIALS MODAL ===== */
function openMaterials(sub) {
  const modal = document.getElementById('materialsModal');
  modal.classList.add('show');
  
  const subject = subjects.find(s => s.id === sub);
  document.getElementById('materialsTitle').textContent = subject.title + ' Materials';
  
  const list = document.getElementById('materialsList');
  list.innerHTML = '';
  
  const subjectFiles = files[sub] || [];
  if (subjectFiles.length === 0) {
    list.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">No materials uploaded yet</p>';
  } else {
    subjectFiles.forEach(f => {
      list.insertAdjacentHTML('beforeend', `
        <div class="file-item">
          <div class="file-info">
            <div class="file-icon">üìÑ</div>
            <div class="file-details">
              <div class="file-name">${f.name}</div>
              <div class="file-meta">${(f.size / 1024).toFixed(1)} KB ‚Ä¢ ${new Date(f.ts).toLocaleDateString()}</div>
            </div>
          </div>
          <div class="file-actions">
            <button class="file-btn" onclick="downloadFile('${sub}', ${f.id})">üì•</button>
            <button class="file-btn danger" onclick="delFile('${sub}', ${f.id})">üóëÔ∏è</button>
          </div>
        </div>
      `);
    });
  }
  
  document.getElementById('uploadMoreBtn').onclick = () => triggerUpload(sub);
}

function closeMaterials() {
  document.getElementById('materialsModal').classList.remove('show');
}

function downloadFile(sub, id) {
  const f = files[sub].find(x => x.id == id);
  if (!f) return;
  
  const a = document.createElement('a');
  a.href = f.data;
  a.download = f.name;
  document.body.append(a);
  a.click();
  a.remove();
  show('success', 'Download started');
}

function delFile(sub, id) {
  if (!confirm('Delete this file?')) return;
  files[sub] = files[sub].filter(x => x.id != id);
  save('files', files);
  openMaterials(sub);
  show('success', 'File deleted');
}

/* ===== TIMER ===== */
function openTimer(sub) {
  currentSub = sub;
  paused = 0;
  startT = Date.now();
  
  const subject = subjects.find(s => s.id === sub);
  document.getElementById('timerDisplay').textContent = '00:00:00';
  document.getElementById('timerModalTitle').textContent = 'Study ‚Äì ' + subject.title;
  document.getElementById('timerModal').classList.add('show');
  
  toggleBtns('stopped');
  updateTimerStats();
}

function closeTimer() {
  clearInterval(timer);
  timer = null;
  document.getElementById('timerModal').classList.remove('show');
}

function toggleBtns(state) {
  const s = document.getElementById('startBtn');
  const p = document.getElementById('pauseBtn');
  const st = document.getElementById('stopBtn');
  
  if (state === 'running') {
    s.classList.add('hidden');
    p.classList.remove('hidden');
    st.classList.remove('hidden');
  } else if (state === 'paused') {
    s.classList.remove('hidden');
    p.classList.add('hidden');
    st.classList.remove('hidden');
  } else {
    s.classList.remove('hidden');
    p.classList.add('hidden');
    st.classList.add('hidden');
  }
}

document.getElementById('startBtn').onclick = () => {
  if (timer) return;
  startT = Date.now() - paused;
  timer = setInterval(updateTimer, 1000);
  toggleBtns('running');
  show('success', 'Timer started!');
};

document.getElementById('pauseBtn').onclick = () => {
  if (!timer) return;
  clearInterval(timer);
  timer = null;
  paused = Date.now() - startT;
  toggleBtns('paused');
  show('warning', 'Timer paused');
};

document.getElementById('stopBtn').onclick = stopTimer;

function updateTimer() {
  const sec = Math.floor((Date.now() - startT) / 1000);
  document.getElementById('timerDisplay').textContent = formatHMS(sec);
  document.getElementById('sessionTime').textContent = Math.floor(sec / 60) + 'm';
  updateTimerStats();
}

function updateTimerStats() {
  const todayStudied = getTodayStudyTime();
  document.getElementById('todayTime').textContent = Math.floor(todayStudied / 60) + 'm';
}

function stopTimer() {
  if (!timer && !paused) return;
  
  const dur = (timer ? Date.now() - startT : paused) / 1000;
  if (dur < 60) {
    show('warning', 'Session too short (minimum 1 minute)');
    closeTimer();
    return;
  }
  
  clearInterval(timer);
  timer = null;
  toggleBtns('stopped');
  
  // Save study time
  studyTimes[currentSub] = (studyTimes[currentSub] || 0) + dur;
  const dStr = new Date().toDateString();
  dailyLog[dStr] = (dailyLog[dStr] || 0) + dur;
  
  saveAll();
  refreshStats();
  updateCharts();
  
  show('success', 'Session saved (' + Math.floor(dur / 60) + ' min)');
  closeTimer();
}

/* ===== ANALYTICS ===== */
function refreshStats() {
  subjects.forEach(s => {
    const t = studyTimes[s.id] || 0;
    const pct = Math.min(t / 14400 * 100, 100);
    const timeEl = document.getElementById('time-' + s.id);
    const barEl = document.getElementById('bar-' + s.id);
    const pctEl = document.getElementById('pct-' + s.id);
    
    if (timeEl) timeEl.textContent = formatTimeH(t);
    if (barEl) barEl.style.width = pct + '%';
    if (pctEl) pctEl.textContent = Math.round(pct) + '%';
  });
  
  const totalSec = Object.values(studyTimes).reduce((a, b) => a + b, 0);
  const todaySec = getTodayStudyTime();
  
  document.getElementById('totalStudyTime').textContent = (totalSec / 3600).toFixed(1) + 'h';
  document.getElementById('totalStudyTimeProgress').textContent = formatTimeH(totalSec);
  document.getElementById('avgProgress').textContent = Math.round(avgProgress()) + '%';
  document.getElementById('averageProgressStat').textContent = Math.round(avgProgress()) + '%';
  document.getElementById('todayStudyTime').textContent = formatTimeH(todaySec);
  
  // Update streak
  document.getElementById('studyStreak').textContent = calculateStreak();
}

function avgProgress() {
  const arr = subjects.map(s => Math.min((studyTimes[s.id] || 0) / 14400 * 100, 100));
  return arr.length ? arr.reduce((a, b) => a + b, 0) / arr.length : 0;
}

function getTodayStudyTime() {
  return dailyLog[new Date().toDateString()] || 0;
}

function calculateStreak() {
  let streak = 0;
  const today = new Date();
  
  for (let i = 0; i < 365; i++) {
    const date = new Date(today);
    date.setDate(date.getDate() - i);
    const dateStr = date.toDateString();
    
    if (dailyLog[dateStr] && dailyLog[dateStr] > 1800) { // At least 30 min
      streak++;
    } else if (i > 0) {
      break;
    }
  }
  
  return streak;
}

/* ===== CHARTS ===== */
function buildSubjectSelect() {
  const sel = document.getElementById('weeklyChartSubject');
  sel.innerHTML = '<option value="all">All Subjects</option>';
  subjects.forEach(s => sel.insertAdjacentHTML('beforeend', `<option value="${s.id}">${s.title}</option>`));
}

function initCharts() {
  if (typeof Chart === 'undefined') {
    console.warn('Chart.js not loaded');
    return;
  }
  
  const ctx1 = document.getElementById('weeklyProgressChart');
  if (ctx1) {
    charts.weekly = new Chart(ctx1, {
      type: 'line',
      data: {
        labels: last7(),
        datasets: [{
          label: 'Hours',
          data: weekData(),
          borderColor: '#667eea',
          backgroundColor: 'rgba(102,126,234,.2)',
          tension: .4,
          fill: true
        }]
      },
      options: chartOpts()
    });
  }
  
  const ctx2 = document.getElementById('subjectDistributionChart');
  if (ctx2) {
    charts.dist = new Chart(ctx2, {
      type: 'doughnut',
      data: {
        labels: subjects.map(s => s.title),
        datasets: [{
          data: subjects.map(s => (studyTimes[s.id] || 0) / 3600),
          backgroundColor: subjects.map(s => s.color)
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: { color: textCol() }
          }
        }
      }
    });
  }
  
  const ctx3 = document.getElementById('performanceTrendChart');
  if (ctx3) {
    charts.trend = new Chart(ctx3, {
      type: 'bar',
      data: {
        labels: lastNDays(7),
        datasets: [{
          data: perfData(7),
          backgroundColor: '#6366f1',
          borderRadius: 6
        }]
      },
      options: chartOpts(true)
    });
  }
}

function updateCharts() {
  if (charts.weekly) {
    charts.weekly.data.labels = last7();
    charts.weekly.data.datasets[0].data = weekData();
    charts.weekly.update();
  }
  
  if (charts.dist) {
    charts.dist.data.datasets[0].data = subjects.map(s => (studyTimes[s.id] || 0) / 3600);
    charts.dist.update();
  }
  
  if (charts.trend) {
    charts.trend.data.labels = lastNDays(7);
    charts.trend.data.datasets[0].data = perfData(7);
    charts.trend.update();
  }
}

function updateChartsColors() {
  const col = textCol();
  Object.values(charts).forEach(c => {
    if (c.options.scales) {
      c.options.scales.x.ticks.color = col;
      c.options.scales.y.ticks.color = col;
    }
    if (c.options.plugins.legend) {
      c.options.plugins.legend.labels.color = col;
    }
    c.update();
  });
}

function chartOpts(bar = false) {
  return {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        display: !bar,
        labels: { color: textCol() }
      }
    },
    scales: {
      x: {
        ticks: { color: textCol() },
        grid: { color: gridCol() }
      },
      y: {
        ticks: { color: textCol() },
        grid: { color: gridCol() },
        beginAtZero: true
      }
    }
  };
}

function textCol() {
  return document.body.dataset.theme === 'dark' ? '#fff' : '#1e1f23';
}

function gridCol() {
  return document.body.dataset.theme === 'dark' ? '#2d2e36' : '#e5e7eb';
}

function last7() {
  return [...Array(7)].map((_, i) => {
    const d = new Date();
    d.setDate(d.getDate() - 6 + i);
    return d.toLocaleDateString(undefined, { weekday: 'short' });
  });
}

function weekData() {
  return [...Array(7)].map((_, i) => {
    const d = new Date();
    d.setDate(d.getDate() - 6 + i);
    return ((dailyLog[d.toDateString()] || 0) / 3600).toFixed(2);
  });
}

function lastNDays(n) {
  return [...Array(n)].map((_, i) => {
    const d = new Date();
    d.setDate(d.getDate() - n + 1 + i);
    return d.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
  });
}

function perfData(n) {
  return lastNDays(n).map((_, i) => {
    const d = new Date();
    d.setDate(d.getDate() - n + 1 + i);
    const sec = dailyLog[d.toDateString()] || 0;
    return Math.min(sec / 14400 * 100, 100).toFixed(1);
  });
}

/* ===== HEATMAP ===== */
function initHeatmap() {
  const cont = document.getElementById('studyHeatmap');
  if (!cont) return;
  
  cont.innerHTML = '';
  const today = new Date();
  
  for (let i = 29; i >= 0; i--) {
    const d = new Date(today);
    d.setDate(d.getDate() - i);
    const sec = dailyLog[d.toDateString()] || 0;
    const lvl = sec === 0 ? 0 : sec < 1800 ? 1 : sec < 3600 ? 2 : sec < 7200 ? 3 : 4;
    
    cont.insertAdjacentHTML('beforeend', 
      `<div class="heatmap-day" data-level="${lvl}" title="${d.toLocaleDateString()}: ${formatTimeH(sec)}"></div>`
    );
  }
}

/* ===== ACHIEVEMENTS ===== */
function initAchievements() {
  const grid = document.getElementById('achievementsGrid');
  if (!grid) return;
  
  const achievements = [
    { icon: 'üåü', title: 'First Steps', desc: 'Complete your first study session', check: () => Object.values(studyTimes).some(t => t > 0) },
    { icon: 'üî•', title: 'Streak Master', desc: 'Study for 7 days in a row', check: () => calculateStreak() >= 7 },
    { icon: 'üí™', title: 'Marathon', desc: 'Study for 4+ hours in one day', check: () => Object.values(dailyLog).some(t => t >= 14400) },
    { icon: 'üéØ', title: 'Consistent', desc: 'Maintain 80%+ average progress', check: () => avgProgress() >= 80 },
    { icon: 'üìö', title: 'Scholar', desc: 'Upload 10+ study materials', check: () => Object.values(files).reduce((sum, arr) => sum + arr.length, 0) >= 10 },
    { icon: '‚ö°', title: 'Quick Learner', desc: 'Complete 20+ study sessions', check: () => Object.values(studyTimes).reduce((sum, t) => sum + Math.floor(t / 1800), 0) >= 20 }
  ];
  
  grid.innerHTML = achievements.map(a => `
    <div class="glass achievement-badge ${a.check() ? 'unlocked' : 'locked'}">
      <div class="achievement-icon">${a.icon}</div>
      <div class="achievement-title">${a.title}</div>
      <div class="achievement-desc">${a.desc}</div>
    </div>
  `).join('');
}

/* ===== AI INTEGRATION ===== */
function checkAIStatus() {
  const hasKey = aiConfig.key && aiConfig.key.length > 0;
  const status = document.getElementById('chatgpt-status');
  
  if (status) {
    status.className = hasKey ? 'tool-status connected' : 'tool-status disconnected';
    status.innerHTML = hasKey ? 
      '<span class="status-dot"></span><span>Connected</span>' :
      '<span class="status-dot"></span><span>Not Connected</span>';
  }
}

function initializeChatGPT() {
  if (!aiConfig.key) {
    openSettings();
    return;
  }
  
  const panel = document.getElementById('chatPanel');
  panel.style.display = 'block';
  panel.scrollIntoView({ behavior: 'smooth' });
}

function closeChatInterface() {
  document.getElementById('chatPanel').style.display = 'none';
}

async function sendMessage() {
  const input = document.getElementById('chatInput');
  const message = input.value.trim();
  
  if (!message || !aiConfig.key) {
    if (!aiConfig.key) {
      show('error', 'Please configure your OpenRouter API key first');
    }
    return;
  }
  
  // Add user message
  addMessageToChat('user', message);
  input.value = '';
  
  const sendBtn = document.getElementById('sendBtn');
  sendBtn.disabled = true;
  sendBtn.textContent = 'Sending...';
  
  try {
    const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${aiConfig.key}`,
        'Content-Type': 'application/json',
        'HTTP-Referer': window.location.origin,
        'X-Title': 'Academic Hub'
      },
      body: JSON.stringify({
        model: aiConfig.model,
        messages: [
          {
            role: 'system',
            content: 'You are an AI tutor helping a BTech AI/ML student. Be helpful and encouraging.'
          },
          {
            role: 'user',
            content: message
          }
        ],
        max_tokens: 1000,
        temperature: 0.7
      })
    });
    
    const data = await response.json();
    
    if (data.choices && data.choices[0]) {
      addMessageToChat('ai', data.choices[0].message.content);
    } else {
      addMessageToChat('ai', 'Sorry, I encountered an error. Please try again.');
    }
  } catch (error) {
    console.error('AI API Error:', error);
    addMessageToChat('ai', 'Sorry, I could not connect to the AI service. Please check your API key.');
  }
  
  sendBtn.disabled = false;
  sendBtn.textContent = 'Send';
}

function addMessageToChat(sender, message) {
  const chatMessages = document.getElementById('chatMessages');
  const messageDiv = document.createElement('div');
  messageDiv.className = `chat-message ${sender}`;
  
  if (sender === 'user') {
    messageDiv.innerHTML = `<strong>You:</strong> ${message}`;
  } else {
    messageDiv.innerHTML = `<strong>AI Assistant:</strong> ${message}`;
  }
  
  chatMessages.appendChild(messageDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Enable Enter key to send messages
document.addEventListener('keydown', function(e) {
  if (e.key === 'Enter' && document.getElementById('chatInput') === document.activeElement) {
    sendMessage();
  }
});

/* ===== SETTINGS ===== */
function openSettings() {
  document.getElementById('apiKeyInput').value = aiConfig.key;
  document.getElementById('modelSelect').value = aiConfig.model;
  document.getElementById('settingsModal').classList.add('show');
}

function closeSettings() {
  document.getElementById('settingsModal').classList.remove('show');
}

function saveSettings() {
  const key = document.getElementById('apiKeyInput').value.trim();
  const model = document.getElementById('modelSelect').value;
  
  aiConfig.key = key;
  aiConfig.model = model;
  
  save('ai', aiConfig);
  checkAIStatus();
  closeSettings();
  show('success', 'API settings saved successfully!');
}

function saveMainSettings() {
  const key = document.getElementById('settingsApiKey').value.trim();
  const model = document.getElementById('settingsModel').value;
  
  aiConfig.key = key;
  aiConfig.model = model;
  
  save('ai', aiConfig);
  checkAIStatus();
  show('success', 'Settings saved successfully!');
}

function uploadDocument() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.pdf,.doc,.docx,.txt';
  input.onchange = function(e) {
    const file = e.target.files[0];
    if (file) {
      show('success', `${file.name} uploaded! Analysis feature coming soon...`);
    }
  };
  input.click();
}

/* ===== UTILITY FUNCTIONS ===== */
function formatTimeH(seconds) {
  if (!seconds || seconds === 0) return '0h 0m';
  const hours = Math.floor(seconds / 3600);
  const minutes = Math.floor((seconds % 3600) / 60);
  return `${hours}h ${minutes}m`;
}

function formatHMS(seconds) {
  const h = Math.floor(seconds / 3600);
  const m = Math.floor((seconds % 3600) / 60);
  const s = seconds % 60;
  return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
}

function save(key, data) {
  localStorage.setItem('ah-' + key, JSON.stringify(data));
}

function saveAll() {
  save('subjects', subjects);
  save('files', files);
  save('studyTimes', studyTimes);
  save('dailyLog', dailyLog);
  save('ai', aiConfig);
}

function show(type, message) {
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.innerHTML = `
    <div style="font-weight: 700; margin-bottom: 4px;">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è'} ${type.charAt(0).toUpperCase() + type.slice(1)}</div>
    <div style="font-size: 14px; color: var(--text-secondary);">${message}</div>
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

/* ===== KEYBOARD SHORTCUTS ===== */
document.addEventListener('keydown', function(e) {
  if (e.ctrlKey || e.metaKey) {
    switch(e.key) {
      case 's':
        e.preventDefault();
        saveAll();
        show('success', 'Data saved');
        break;
      case 't':
        e.preventDefault();
        if (subjects.length > 0) openTimer(subjects[0].id);
        break;
    }
  }
});

console.log('üéì Academic Hub Pro Loaded Successfully!');
  // ========== SEARCH FUNCTIONALITY ==========
function initializeSearch() {
    const searchInput = document.getElementById('searchInput');
    if (!searchInput) return;
    
    searchInput.addEventListener('input', function(e) {
        const query = e.target.value.toLowerCase().trim();
        performSearch(query);
    });
    
    // Add search suggestions
    searchInput.addEventListener('focus', showSearchSuggestions);
    searchInput.addEventListener('blur', hideSearchSuggestions);
}

function performSearch(query) {
    if (!query) {
        // Show all subjects when search is empty
        document.querySelectorAll('.subject-card').forEach(card => {
            card.style.display = 'block';
        });
        return;
    }
    
    let visibleCount = 0;
    
    document.querySelectorAll('.subject-card').forEach(card => {
        const subjectId = card.getAttribute('data-subject');
        const subject = appState.subjects[subjectId];
        
        if (subject) {
            const searchableText = [
                subject.name,
                subject.code,
                subject.faculty,
                subject.category
            ].join(' ').toLowerCase();
            
            const matches = searchableText.includes(query);
            
            if (matches) {
                card.style.display = 'block';
                highlightSearchTerms(card, query);
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        }
    });
    
    // Show search results count
    showSearchResults(visibleCount, query);
}

function highlightSearchTerms(card, query) {
    // Remove previous highlights
    card.querySelectorAll('.highlight').forEach(el => {
        el.classList.remove('highlight');
    });
    
    // Add highlight to matching text
    const title = card.querySelector('.subject-title');
    const code = card.querySelector('.subject-code');
    const faculty = card.querySelector('.faculty-name');
    
    [title, code, faculty].forEach(element => {
        if (element && element.textContent.toLowerCase().includes(query)) {
            element.classList.add('highlight');
        }
    });
}

function showSearchResults(count, query) {
    const existingResults = document.querySelector('.search-results');
    if (existingResults) existingResults.remove();
    
    if (query) {
        const resultsDiv = document.createElement('div');
        resultsDiv.className = 'search-results';
        resultsDiv.innerHTML = `
            <div style="padding: 16px; background: var(--glass-bg); border-radius: 8px; margin: 16px 0; backdrop-filter: blur(10px);">
                üìç Found ${count} result${count !== 1 ? 's' : ''} for "${query}"
                <button onclick="clearSearch()" style="float: right; background: none; border: none; color: var(--accent-primary); cursor: pointer;">‚úï Clear</button>
            </div>
        `;
        
        const container = document.querySelector('.subjects-container');
        container.insertBefore(resultsDiv, container.firstChild);
    }
}

function clearSearch() {
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.value = '';
        performSearch('');
    }
    
    const results = document.querySelector('.search-results');
    if (results) results.remove();
}

function showSearchSuggestions() {
    const suggestions = ['Mathematics', 'Computer Science', 'Engineering', 'Professional Core'];
    // Implementation for search suggestions dropdown
}

function hideSearchSuggestions() {
    // Hide suggestions dropdown
}
// ========== ENHANCED AI SYSTEM ==========
class AIManager {
    constructor() {
        this.apiKey = this.detectAPIKey();
        this.model = 'openai/gpt-4-turbo';
        this.isConnected = !!this.apiKey;
        this.conversationHistory = [];
    }
    
    detectAPIKey() {
        // Method 1: Environment variable (Codespace/GitHub)
        if (typeof process !== 'undefined' && process.env?.OPENROUTER_API_KEY) {
            return process.env.OPENROUTER_API_KEY;
        }
        
        // Method 2: GitHub Codespace environment
        if (window.location.hostname.includes('github.dev') || window.CODESPACE_NAME) {
            // Try to get from Codespace environment
            return localStorage.getItem('GITHUB_CODESPACE_OPENROUTER_KEY') || 
                   sessionStorage.getItem('OPENROUTER_API_KEY');
        }
        
        // Method 3: Local storage fallback
        const stored = localStorage.getItem('academic-hub-ai-config');
        if (stored) {
            try {
                return JSON.parse(stored).openrouterKey;
            } catch (e) {
                console.warn('Failed to parse AI config');
            }
        }
        
        return '';
    }
    
    async sendMessage(message, context = '') {
        if (!this.apiKey) {
            throw new Error('API key not found. Please configure in settings.');
        }
        
        const systemPrompt = `You are an AI study assistant for a BTech AI/ML student. 
        
Current subjects: ${Object.values(appState.subjects).map(s => s.name).join(', ')}
Study progress: ${this.getStudyContext()}
${context ? `Additional context: ${context}` : ''}

Be helpful, encouraging, and provide specific study guidance.`;

        try {
            const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${this.apiKey}`,
                    'Content-Type': 'application/json',
                    'HTTP-Referer': window.location.origin,
                    'X-Title': 'Academic Hub'
                },
                body: JSON.stringify({
                    model: this.model,
                    messages: [
                        { role: 'system', content: systemPrompt },
                        ...this.conversationHistory.slice(-10), // Keep last 10 messages
                        { role: 'user', content: message }
                    ],
                    max_tokens: 1000,
                    temperature: 0.7,
                    stream: false
                })
            });
            
            if (!response.ok) {
                throw new Error(`API request failed: ${response.status}`);
            }
            
            const data = await response.json();
            
            if (data.choices?.[0]?.message?.content) {
                const aiResponse = data.choices[0].message.content;
                
                // Update conversation history
                this.conversationHistory.push(
                    { role: 'user', content: message },
                    { role: 'assistant', content: aiResponse }
                );
                
                return aiResponse;
            } else {
                throw new Error('Invalid response format from API');
            }
            
        } catch (error) {
            console.error('AI API Error:', error);
            throw error;
        }
    }
    
    getStudyContext() {
        const totalTime = Object.values(appState.subjects).reduce((sum, s) => sum + (s.studyTime || 0), 0);
        const streak = calculateStudyStreak();
        return `Total study time: ${formatTime(totalTime)}, Current streak: ${streak} days`;
    }
    
    async analyzeDocument(file) {
        // Placeholder for document analysis
        return `Document "${file.name}" has been analyzed. Key topics identified: [AI would analyze content here]`;
    }
}

// Initialize AI Manager
const aiManager = new AIManager();

// ========== CHAT INTERFACE ==========
function initializeChatInterface() {
    const chatInterface = document.getElementById('chat-interface');
    if (!chatInterface) return;
    
    chatInterface.style.display = 'block';
    
    // Add welcome message if chat is empty
    const messages = chatInterface.querySelector('.chat-messages');
    if (messages.children.length <= 1) {
        addChatMessage('ai', `Hello! I'm your AI study assistant. I can help you with:

‚Ä¢ Subject-specific questions and explanations
‚Ä¢ Study planning and time management  
‚Ä¢ Assignment guidance and problem-solving
‚Ä¢ Exam preparation strategies
‚Ä¢ Progress analysis and recommendations

What would you like to know about your studies?`);
    }
}

function addChatMessage(sender, message) {
    const messagesContainer = document.getElementById('chatMessages');
    if (!messagesContainer) return;
    
    const messageElement = document.createElement('div');
    messageElement.className = `chat-message ${sender}`;
    
    const timestamp = new Date().toLocaleTimeString('en-US', { 
        hour: '2-digit', 
        minute: '2-digit' 
    });
    
    messageElement.innerHTML = `
        <div class="message-content">
            <div class="message-header">
                <strong>${sender === 'user' ? 'You' : 'AI Assistant'}</strong>
                <span class="message-time">${timestamp}</span>
            </div>
            <div class="message-text">${message.replace(/\n/g, '<br>')}</div>
        </div>
    `;
    
    messagesContainer.appendChild(messageElement);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
    
    // Add typing animation for AI messages
    if (sender === 'ai') {
        messageElement.classList.add('typing');
        setTimeout(() => messageElement.classList.remove('typing'), 1000);
    }
}

async function sendChatMessage() {
    const input = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    
    if (!input || !sendBtn) return;
    
    const message = input.value.trim();
    if (!message) return;
    
    // Disable input and show loading
    input.disabled = true;
    sendBtn.disabled = true;
    sendBtn.textContent = 'Sending...';
    
    // Add user message
    addChatMessage('user', message);
    input.value = '';
    
    try {
        // Get AI response
        const response = await aiManager.sendMessage(message);
        addChatMessage('ai', response);
        
    } catch (error) {
        console.error('Chat error:', error);
        addChatMessage('ai', `Sorry, I encountered an error: ${error.message}. Please try again or check your API configuration.`);
    } finally {
        // Re-enable input
        input.disabled = false;
        sendBtn.disabled = false;
        sendBtn.textContent = 'Send';
        input.focus();
    }
}

// Auto-enable AI features if API key is detected
if (aiManager.isConnected) {
    console.log('ü§ñ AI features enabled automatically');
    document.addEventListener('DOMContentLoaded', () => {
        updateAIStatus();
        initializeChatInterface();
    });
}
  <!-- Schedule Content -->
<div class="content-area" id="schedule-content">
    <div class="top-bar">
        <h1 class="page-title">üìÖ Smart Schedule</h1>
        <div class="top-bar-controls">
            <button class="btn btn-primary" onclick="addScheduleEvent()">‚ûï Add Event</button>
            <button id="themeToggle5" class="theme-toggle">üåô</button>
        </div>
    </div>
    
    <div style="padding: 40px;">
        <div class="schedule-container">
            <!-- Calendar Header -->
            <div class="calendar-header">
                <div class="calendar-nav">
                    <button class="btn btn-secondary" onclick="previousWeek()">‚óÄ Previous</button>
                    <h3 id="currentWeekTitle">Week of December 16, 2024</h3>
                    <button class="btn btn-secondary" onclick="nextWeek()">Next ‚ñ∂</button>
                </div>
                <div class="view-controls">
                    <button class="btn btn-secondary active" onclick="setCalendarView('week')">Week</button>
                    <button class="btn btn-secondary" onclick="setCalendarView('month')">Month</button>
                </div>
            </div>
            
            <!-- Weekly Calendar Grid -->
            <div class="glass calendar-grid">
                <div class="time-column">
                    <div class="time-header"></div>
                    <div class="time-slot">8:00 AM</div>
                    <div class="time-slot">9:00 AM</div>
                    <div class="time-slot">10:00 AM</div>
                    <div class="time-slot">11:00 AM</div>
                    <div class="time-slot">12:00 PM</div>
                    <div class="time-slot">1:00 PM</div>
                    <div class="time-slot">2:00 PM</div>
                    <div class="time-slot">3:00 PM</div>
                    <div class="time-slot">4:00 PM</div>
                    <div class="time-slot">5:00 PM</div>
                    <div class="time-slot">6:00 PM</div>
                </div>
                
                <div class="days-grid" id="daysGrid">
                    <!-- Days will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Upcoming Events -->
            <div class="glass upcoming-events" style="margin-top: 24px;">
                <h3>üìã Upcoming Events</h3>
                <div id="upcomingEventsList">
                    <div class="event-item">
                        <div class="event-time">Today, 2:00 PM</div>
                        <div class="event-title">Data Structures Lab</div>
                        <div class="event-location">Computer Lab 1</div>
                    </div>
                    <div class="event-item">
                        <div class="event-time">Tomorrow, 10:00 AM</div>
                        <div class="event-title">Operating Systems Lecture</div>
                        <div class="event-location">Lecture Hall A</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Notes Content -->
<div class="content-area" id="notes-content">
    <div class="top-bar">
        <h1 class="page-title">üìù Smart Notes</h1>
        <div class="top-bar-controls">
            <button class="btn btn-primary" onclick="createNewNote()">‚ûï New Note</button>
            <button id="themeToggle8" class="theme-toggle">üåô</button>
        </div>
    </div>
    
    <div style="padding: 40px;">
        <div class="notes-container">
            <div class="notes-sidebar glass">
                <div class="notes-search">
                    <input type="text" placeholder="Search notes..." id="notesSearch" class="form-input">
                </div>
                <div class="notes-list" id="notesList">
                    <!-- Notes list will be populated here -->
                </div>
            </div>
            
            <div class="notes-editor glass">
                <div class="note-header">
                    <input type="text" placeholder="Note title..." id="noteTitle" class="note-title-input">
                    <select id="noteSubject" class="form-input">
                        <option value="">Select Subject</option>
                        <!-- Subjects will be populated -->
                    </select>
                </div>
                
                <div class="note-toolbar">
                    <button onclick="formatText('bold')" title="Bold">ùêÅ</button>
                    <button onclick="formatText('italic')" title="Italic">ùêº</button>
                    <button onclick="formatText('underline')" title="Underline">ùêî</button>
                    <button onclick="insertList()" title="List">üìã</button>
                    <button onclick="askAI()" title="AI Assist">ü§ñ</button>
                </div>
                
                <textarea id="noteContent" class="note-content" placeholder="Start typing your notes..."></textarea>
                
                <div class="note-footer">
                    <span id="noteStatus">Auto-saved</span>
                    <span id="noteWordCount">0 words</span>
                </div>
            </div>
        </div>
    </div>
</div>
// ========== COMPLETE FEATURE IMPLEMENTATIONS ==========

// Schedule Management
let currentWeek = new Date();
let scheduleEvents = JSON.parse(localStorage.getItem('schedule-events') || '[]');

function addScheduleEvent() {
    const modal = createModal('Add Schedule Event', `
        <form onsubmit="saveScheduleEvent(event)">
            <div class="form-group">
                <label class="form-label">Event Title</label>
                <input type="text" class="form-input" id="eventTitle" required>
            </div>
            <div class="form-group">
                <label class="form-label">Subject</label>
                <select class="form-input" id="eventSubject">
                    <option value="">General</option>
                    ${Object.values(appState.subjects).map(s => `<option value="${s.id}">${s.name}</option>`).join('')}
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Date & Time</label>
                <input type="datetime-local" class="form-input" id="eventDateTime" required>
            </div>
            <div class="form-group">
                <label class="form-label">Duration (minutes)</label>
                <input type="number" class="form-input" id="eventDuration" value="60" min="15" max="480">
            </div>
            <div class="form-group">
                <label class="form-label">Location</label>
                <input type="text" class="form-input" id="eventLocation">
            </div>
            <div style="display: flex; gap: 12px; justify-content: center; margin-top: 24px;">
                <button type="submit" class="btn btn-primary">üíæ Save Event</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal()">‚ùå Cancel</button>
            </div>
        </form>
    `);
}

function saveScheduleEvent(event) {
    event.preventDefault();
    
    const newEvent = {
        id: Date.now(),
        title: document.getElementById('eventTitle').value,
        subject: document.getElementById('eventSubject').value,
        dateTime: document.getElementById('eventDateTime').value,
        duration: parseInt(document.getElementById('eventDuration').value),
        location: document.getElementById('eventLocation').value,
        created: new Date().toISOString()
    };
    
    scheduleEvents.push(newEvent);
    localStorage.setItem('schedule-events', JSON.stringify(scheduleEvents));
    
    closeModal();
    renderSchedule();
    showNotification('Event Added', `${newEvent.title} has been scheduled`, 'success');
}

// Goals Management
let studyGoals = JSON.parse(localStorage.getItem('study-goals') || '[]');

function addNewGoal() {
    const modal = createModal('Create New Goal', `
        <form onsubmit="saveNewGoal(event)">
            <div class="form-group">
                <label class="form-label">Goal Title</label>
                <input type="text" class="form-input" id="goalTitle" placeholder="e.g., Complete 10 hours of DSA study" required>
            </div>
            <div class="form-group">
                <label class="form-label">Subject</label>
                <select class="form-input" id="goalSubject" required>
                    <option value="">Select Subject</option>
                    ${Object.values(appState.subjects).map(s => `<option value="${s.id}">${s.name}</option>`).join('')}
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Target (hours)</label>
                <input type="number" class="form-input" id="goalTarget" value="10" min="1" max="100" required>
            </div>
            <div class="form-group">
                <label class="form-label">Deadline</label>
                <input type="date" class="form-input" id="goalDeadline" required>
            </div>
            <div class="form-group">
                <label class="form-label">Priority</label>
                <select class="form-input" id="goalPriority">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                </select>
            </div>
            <div style="display: flex; gap: 12px; justify-content: center; margin-top: 24px;">
                <button type="submit" class="btn btn-primary">üéØ Create Goal</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal()">‚ùå Cancel</button>
            </div>
        </form>
    `);
}

function saveNewGoal(event) {
    event.preventDefault();
    
    const newGoal = {
        id: Date.now(),
        title: document.getElementById('goalTitle').value,
        subject: document.getElementById('goalSubject').value,
        target: parseFloat(document.getElementById('goalTarget').value),
        current: 0,
        deadline: document.getElementById('goalDeadline').value,
        priority: document.getElementById('goalPriority').value,
        status: 'active',
        created: new Date().toISOString()
    };
    
    studyGoals.push(newGoal);
    localStorage.setItem('study-goals', JSON.stringify(studyGoals));
    
    closeModal();
    renderGoals();
    showNotification('Goal Created', `New goal "${newGoal.title}" has been set!`, 'success');
}

// Notes Management
let studyNotes = JSON.parse(localStorage.getItem('study-notes') || '[]');
let currentNote = null;

function createNewNote() {
    const newNote = {
        id: Date.now(),
        title: 'Untitled Note',
        subject: '',
        content: '',
        tags: [],
        created: new Date().toISOString(),
        updated: new Date().toISOString()
    };
    
    studyNotes.unshift(newNote);
    currentNote = newNote;
    
    renderNotesList();
    loadNoteInEditor(newNote);
    
    // Focus on title input
    setTimeout(() => {
        const titleInput = document.getElementById('noteTitle');
        if (titleInput) {
            titleInput.select();
        }
    }, 100);
}

function loadNoteInEditor(note) {
    document.getElementById('noteTitle').value = note.title;
    document.getElementById('noteSubject').value = note.subject || '';
    document.getElementById('noteContent').value = note.content;
    
    updateWordCount();
    
    // Mark note as active in sidebar
    document.querySelectorAll('.note-item').forEach(item => {
        item.classList.toggle('active', item.dataset.noteId == note.id);
    });
}

function autoSaveNote() {
    if (!currentNote) return;
    
    currentNote.title = document.getElementById('noteTitle').value || 'Untitled Note';
    currentNote.subject = document.getElementById('noteSubject').value;
    currentNote.content = document.getElementById('noteContent').value;
    currentNote.updated = new Date().toISOString();
    
    localStorage.setItem('study-notes', JSON.stringify(studyNotes));
    
    document.getElementById('noteStatus').textContent = 'Auto-saved';
    setTimeout(() => {
        document.getElementById('noteStatus').textContent = 'Auto-saved';
    }, 2000);
}

// Initialize auto-save
setInterval(autoSaveNote, 3000); // Auto-save every 3 seconds

function updateWordCount() {
    const content = document.getElementById('noteContent').value;
    const wordCount = content.trim() ? content.trim().split(/\s+/).length : 0;
    document.getElementById('noteWordCount').textContent = `${wordCount} words`;
}

// Helper function to create modals
function createModal(title, content) {
    const modal = document.createElement('div');
    modal.className = 'modal show';
    modal.innerHTML = `
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">${title}</h2>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            ${content}
        </div>
    `;
    
    document.body.appendChild(modal);
    return modal;
}

function closeModal() {
    document.querySelectorAll('.modal').forEach(modal => modal.remove());
}

// Initialize all features when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    initializeSearch();
    renderSchedule();
    renderGoals();
    renderNotesList();
    
    // Set up note editor event listeners
    const noteTitle = document.getElementById('noteTitle');
    const noteContent = document.getElementById('noteContent');
    
    if (noteTitle) {
        noteTitle.addEventListener('input', autoSaveNote);
    }
    
    if (noteContent) {
        noteContent.addEventListener('input', () => {
            updateWordCount();
            autoSaveNote();
        });
    }
    
    console.log('‚úÖ All features initialized successfully');
});
/* Fix for chart container overflow */
.chart-container {
    position: relative;
    overflow: hidden !important;
    max-width: 100%;
}

.chart-container canvas {
    max-width: 100% !important;
    max-height: 280px !important;
}

/* Search highlight styles */
.highlight {
    background: rgba(255, 255, 0, 0.3);
    padding: 2px 4px;
    border-radius: 3px;
}

/* Heatmap styles */
.heatmap-container {
    display: grid;
    grid-template-columns: repeat(30, 1fr);
    gap: 3px;
    padding: 20px 0;
}

.heatmap-day {
    aspect-ratio: 1;
    background: var(--bg-tertiary);
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.heatmap-day:hover {
    transform: scale(1.1);
}

.heatmap-day[data-level="1"] { background: color-mix(in srgb, var(--accent-primary) 25%, var(--bg-tertiary)); }
.heatmap-day[data-level="2"] { background: color-mix(in srgb, var(--accent-primary) 50%, var(--bg-tertiary)); }
.heatmap-day[data-level="3"] { background: color-mix(in srgb, var(--accent-primary) 75%, var(--bg-tertiary)); }
.heatmap-day[data-level="4"] { background: var(--accent-primary); }

/* Calendar styles */
.calendar-grid {
    display: grid;
    grid-template-columns: 80px 1fr;
    min-height: 400px;
}

.time-column {
    border-right: 1px solid var(--border-primary);
}

.time-slot {
    height: 60px;
    display: flex;
    align-items: center;
    padding: 0 8px;
    font-size: 12px;
    color: var(--text-secondary);
    border-bottom: 1px solid var(--border-primary);
}

/* Notes styles */
.notes-container {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 24px;
    height: 600px;
}

.notes-sidebar {
    padding: 20px;
    overflow-y: auto;
}

.notes-editor {
    padding: 0;
    display: flex;
    flex-direction: column;
}

.note-content {
    flex: 1;
    padding: 20px;
    border: none;
    background: transparent;
    color: var(--text-primary);
    resize: none;
    outline: none;
    font-family: inherit;
    line-height: 1.6;
}

.note-toolbar {
    display: flex;
    gap: 8px;
    padding: 12px 20px;
    border-bottom: 1px solid var(--border-primary);
}

.note-toolbar button {
    padding: 6px 10px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 4px;
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.2s ease;
}

.note-toolbar button:hover {
    background: var(--accent-primary);
    color: white;
}
  // ========== COMPLETE PROGRESS SECTION FIX ==========

// Initialize progress section when page loads
document.addEventListener('DOMContentLoaded', function() {
    console.log('üîß Initializing Progress Section...');
    
    // Fix progress page theme toggle
    const progressThemeBtn = document.getElementById('themeToggle2');
    if (progressThemeBtn) {
        progressThemeBtn.addEventListener('click', function(e) {
            e.preventDefault();
            toggleTheme();
        });
    }
    
    // Initialize progress data
    initializeProgressData();
    
    // Initialize charts when progress tab is clicked
    const progressNavItem = document.querySelector('[data-content="progress"]');
    if (progressNavItem) {
        progressNavItem.addEventListener('click', function() {
            setTimeout(() => {
                initializeProgressCharts();
                updateProgressStats();
                generateHeatmap();
            }, 200);
        });
    }
    
    // Update progress every 30 seconds
    setInterval(updateProgressStats, 30000);
});

// Initialize progress data structure
function initializeProgressData() {
    if (!window.progressData) {
        window.progressData = {
            daily: JSON.parse(localStorage.getItem('study-daily-data')) || {},
            subjects: {},
            streak: 0,
            totalTime: 0
        };
    }
    
    // Calculate total study time from subjects
    let totalTime = 0;
    Object.values(appState.subjects || {}).forEach(subject => {
        totalTime += subject.studyTime || 0;
        window.progressData.subjects[subject.id] = subject.studyTime || 0;
    });
    window.progressData.totalTime = totalTime;
}

// Update progress statistics
function updateProgressStats() {
    initializeProgressData();
    
    const totalTime = window.progressData.totalTime;
    const todayTime = getTodayStudyTime();
    const avgProgress = calculateAverageProgress();
    const streak = calculateStudyStreak();
    
    // Update stat cards
    updateStatCard('totalStudyTime', formatTime(totalTime));
    updateStatCard('averageProgress', avgProgress + '%');
    updateStatCard('studyStreak', streak);
    updateStatCard('todayStudyTime', formatTime(todayTime));
    
    console.log('üìä Progress stats updated:', { totalTime, todayTime, avgProgress, streak });
}

function updateStatCard(id, value) {
    const element = document.getElementById(id);
    if (element) {
        element.textContent = value;
        // Add update animation
        element.style.transform = 'scale(1.1)';
        setTimeout(() => {
            element.style.transform = 'scale(1)';
        }, 200);
    }
}

function getTodayStudyTime() {
    const today = new Date().toDateString();
    return window.progressData.daily[today] || 0;
}

function calculateAverageProgress() {
    const subjects = Object.values(appState.subjects || {});
    if (subjects.length === 0) return 0;
    
    const dailyGoalSeconds = (appState.settings?.dailyGoal || 4) * 3600;
    let totalProgress = 0;
    
    subjects.forEach(subject => {
        const progress = Math.min(((subject.studyTime || 0) / dailyGoalSeconds) * 100, 100);
        totalProgress += progress;
    });
    
    return Math.round(totalProgress / subjects.length);
}

function calculateStudyStreak() {
    let streak = 0;
    const today = new Date();
    
    for (let i = 0; i < 30; i++) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        const dateStr = date.toDateString();
        
        if (window.progressData.daily[dateStr] && window.progressData.daily[dateStr] > 0) {
            streak++;
        } else if (i > 0) {
            break;
        }
    }
    
    return streak;
}

// Initialize Charts
function initializeProgressCharts() {
    if (typeof Chart === 'undefined') {
        console.warn('Chart.js not loaded - loading from CDN...');
        loadChartJS().then(() => {
            createCharts();
        });
        return;
    }
    
    createCharts();
}

function loadChartJS() {
    return new Promise((resolve, reject) => {
        if (typeof Chart !== 'undefined') {
            resolve();
            return;
        }
        
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js';
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
    });
}

function createCharts() {
    createWeeklyChart();
    createSubjectChart();
}

function createWeeklyChart() {
    const canvas = document.getElementById('weeklyProgressChart');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    
    // Destroy existing chart
    if (window.weeklyChart) {
        window.weeklyChart.destroy();
    }
    
    const theme = document.body.getAttribute('data-theme') || 'dark';
    const textColor = theme === 'dark' ? '#ffffff' : '#0f172a';
    const gridColor = theme === 'dark' ? '#2d2e36' : '#e5e7eb';
    
    window.weeklyChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: getLast7Days(),
            datasets: [{
                label: 'Study Hours',
                data: getWeeklyData(),
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#667eea',
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointRadius: 5
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: { color: textColor }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { 
                        color: textColor,
                        callback: function(value) {
                            return value + 'h';
                        }
                    },
                    grid: { color: gridColor }
                },
                x: {
                    ticks: { color: textColor },
                    grid: { color: gridColor }
                }
            }
        }
    });
}

function createSubjectChart() {
    const canvas = document.getElementById('subjectProgressChart');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    
    // Destroy existing chart
    if (window.subjectChart) {
        window.subjectChart.destroy();
    }
    
    const theme = document.body.getAttribute('data-theme') || 'dark';
    const textColor = theme === 'dark' ? '#ffffff' : '#0f172a';
    
    const subjects = Object.values(appState.subjects || {});
    const data = subjects.map(subject => Math.max((subject.studyTime || 0) / 3600, 0.1));
    const colors = subjects.map(subject => subject.color || '#667eea');
    const labels = subjects.map(subject => subject.name || 'Unknown');
    
    window.subjectChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: colors,
                borderWidth: 2,
                borderColor: theme === 'dark' ? '#1a1b23' : '#ffffff',
                cutout: '60%'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { 
                        color: textColor,
                        usePointStyle: true,
                        padding: 15
                    }
                }
            }
        }
    });
}

function getLast7Days() {
    const days = [];
    const today = new Date();
    
    for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        days.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
    }
    
    return days;
}

function getWeeklyData() {
    const data = [];
    const today = new Date();
    
    for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        const dateStr = date.toDateString();
        const dayTime = window.progressData.daily[dateStr] || 0;
        data.push(Math.round((dayTime / 3600) * 10) / 10); // Convert to hours
    }
    
    return data;
}

// Generate Study Heatmap
function generateHeatmap() {
    const container = document.getElementById('studyHeatmap');
    if (!container) return;
    
    container.innerHTML = ''; // Clear existing content
    
    const today = new Date();
    const heatmapGrid = document.createElement('div');
    heatmapGrid.style.cssText = `
        display: grid;
        grid-template-columns: repeat(10, 1fr);
        gap: 3px;
        max-width: 100%;
        margin: 20px 0;
    `;
    
    // Generate last 30 days
    for (let i = 29; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        const dateStr = date.toDateString();
        
        const day = document.createElement('div');
        day.style.cssText = `
            aspect-ratio: 1;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        `;
        
        const studyTime = window.progressData.daily[dateStr] || 0;
        const level = getHeatmapLevel(studyTime);
        
        // Set background color based on study time
        const colors = {
            0: 'var(--bg-tertiary)',
            1: 'rgba(102, 126, 234, 0.3)',
            2: 'rgba(102, 126, 234, 0.5)',
            3: 'rgba(102, 126, 234, 0.7)',
            4: 'rgba(102, 126, 234, 1)'
        };
        
        day.style.backgroundColor = colors[level];
        day.title = `${date.toLocaleDateString()}: ${formatTime(studyTime)}`;
        
        day.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.2)';
            this.style.zIndex = '10';
        });
        
        day.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
            this.style.zIndex = '1';
        });
        
        heatmapGrid.appendChild(day);
    }
    
    container.appendChild(heatmapGrid);
}

function getHeatmapLevel(studyTimeSeconds) {
    const hours = studyTimeSeconds / 3600;
    if (hours === 0) return 0;
    if (hours < 0.5) return 1;
    if (hours < 1) return 2;
    if (hours < 2) return 3;
    return 4;
}

// Record study session (call this from your timer)
function recordStudySession(subjectId, duration) {
    const today = new Date().toDateString();
    
    // Update daily data
    if (!window.progressData.daily[today]) {
        window.progressData.daily[today] = 0;
    }
    window.progressData.daily[today] += duration;
    
    // Save to localStorage
    localStorage.setItem('study-daily-data', JSON.stringify(window.progressData.daily));
    
    // Update displays
    updateProgressStats();
    
    // Update charts if they exist
    if (window.weeklyChart) {
        window.weeklyChart.data.datasets[0].data = getWeeklyData();
        window.weeklyChart.update();
    }
    
    if (window.subjectChart) {
        const subjects = Object.values(appState.subjects || {});
        const data = subjects.map(subject => Math.max((subject.studyTime || 0) / 3600, 0.1));
        window.subjectChart.data.datasets[0].data = data;
        window.subjectChart.update();
    }
    
    // Regenerate heatmap
    generateHeatmap();
    
    console.log('üìä Study session recorded:', { subjectId, duration, today });
}

// Update charts when theme changes
function updateChartsTheme() {
    if (window.weeklyChart || window.subjectChart) {
        setTimeout(() => {
            createCharts(); // Recreate with new theme
        }, 100);
    }
}

// Format time utility
function formatTime(seconds) {
    if (!seconds || seconds === 0) return '0h 0m';
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    return `${hours}h ${minutes}m`;
}

console.log('‚úÖ Progress section initialized!');

// ========== END PROGRESS SECTION FIX ==========
<script>
    // All your existing JavaScript code...
    // ...
    // ...
    
    console.log('üéì Academic Hub JavaScript Loaded Successfully!');
    
    // ========== BUTTON FIX - ADD THIS ENTIRE BLOCK HERE ==========
    
    // Fix all subject card buttons after page loads
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üîß Fixing button connections...');
        
        // Fix "Start Studying" buttons
        document.querySelectorAll('.btn-primary').forEach(btn => {
            if (btn.textContent.includes('Start Studying')) {
                const card = btn.closest('.subject-card');
                const subjectId = card ? card.getAttribute('data-subject') : null;
                if (subjectId) {
                    btn.onclick = function(e) {
                        e.preventDefault();
                        startStudying(subjectId);
                    };
                }
            }
        });
        
        // ... rest of the button fix code ...
        
        console.log('‚úÖ All buttons fixed!');
    });
    
    // All the function definitions (startStudying, viewMaterials, etc.)
    
    console.log('üîß Button fixes applied!');
    
</script> ‚Üê This is where it ends



</script>
</body>
</html>

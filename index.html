<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Academic Hub ‚Äì Advanced Study Dashboard</title>
<meta name="theme-color" content="#667eea">

<!-- External libraries -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
/* ===== THEME VARIABLES ===== */
:root {
  --bg-primary: #0a0b0f;
  --bg-secondary: #1a1b23;
  --bg-tertiary: #2d2e36;
  --text-primary: #ffffff;
  --text-secondary: #8e8e93;
  --text-muted: #6d6d70;
  --accent-primary: #667eea;
  --accent-secondary: #764ba2;
  --accent-success: #10b981;
  --accent-warning: #f59e0b;
  --accent-danger: #ef4444;
  --border-primary: #3a3b42;
  --glass-bg: rgba(26, 27, 35, 0.8);
  --glass-border: rgba(255, 255, 255, 0.1);
  --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.15);
}

[data-theme="light"] {
  --bg-primary: #f8fafc;
  --bg-secondary: #ffffff;
  --bg-tertiary: #f1f5f9;
  --text-primary: #0f172a;
  --text-secondary: #475569;
  --text-muted: #64748b;
  --border-primary: #e2e8f0;
  --glass-bg: rgba(255, 255, 255, 0.8);
  --glass-border: rgba(0, 0, 0, 0.1);
}

/* ===== GLOBAL STYLES ===== */
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Inter', sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  transition: all 0.3s ease;
  overflow-x: hidden;
}

/* ===== SIDEBAR ===== */
.sidebar {
  position: fixed;
  left: 0;
  top: 0;
  width: 280px;
  height: 100vh;
  background: var(--bg-secondary);
  border-right: 1px solid var(--border-primary);
  z-index: 1000;
  display: flex;
  flex-direction: column;
  transition: all 0.3s ease;
}

.sidebar-header {
  padding: 24px 20px;
  border-bottom: 1px solid var(--border-primary);
}

.logo {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}

.logo-icon {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  font-weight: 700;
  color: white;
}

.logo-text {
  font-size: 20px;
  font-weight: 700;
  color: var(--text-primary);
}

.search-container {
  position: relative;
  margin-bottom: 16px;
}

.search-input {
  width: 100%;
  padding: 12px 16px 12px 40px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border-primary);
  border-radius: 8px;
  color: var(--text-primary);
  font-size: 14px;
  outline: none;
}

.search-input::placeholder { color: var(--text-secondary); }

.search-icon {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-secondary);
}

.sidebar-nav {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
}

.nav-section { margin-bottom: 32px; }

.nav-title {
  font-size: 12px;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 12px;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  color: var(--text-secondary);
  border-radius: 8px;
  margin-bottom: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.nav-item:hover {
  background: var(--bg-tertiary);
  color: var(--text-primary);
}

.nav-item.active {
  background: var(--accent-primary);
  color: white;
}

.nav-icon {
  font-size: 16px;
  width: 20px;
  text-align: center;
}

/* ===== MAIN CONTENT ===== */
.main-content {
  margin-left: 280px;
  min-height: 100vh;
  background: var(--bg-primary);
  transition: all 0.3s ease;
}

.top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 24px 40px;
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border-primary);
  position: sticky;
  top: 0;
  z-index: 100;
}

.page-title {
  font-size: 32px;
  font-weight: 700;
  color: var(--text-primary);
}

.top-bar-controls {
  display: flex;
  align-items: center;
  gap: 16px;
}

.real-time-display {
  text-align: right;
  font-family: 'Courier New', monospace;
}

.current-date {
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.current-time {
  font-size: 24px;
  font-weight: 700;
  color: var(--accent-primary);
}

.theme-toggle {
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
  color: var(--text-primary);
  padding: 12px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 18px;
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.theme-toggle:hover {
  transform: scale(1.1);
  background: var(--accent-primary);
  color: white;
}

/* ===== CONTENT AREAS ===== */
.content-area {
  display: none;
  min-height: calc(100vh - 100px);
}

.content-area.active { display: block; }

/* ===== GLASS COMPONENTS ===== */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  box-shadow: var(--shadow-lg);
  transition: all 0.3s ease;
}

.glass:hover { transform: translateY(-4px); }

/* ===== SUBJECTS ===== */
.subjects-container { padding: 40px; }

.subjects-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 32px;
}

.subjects-stats {
  display: flex;
  gap: 32px;
  align-items: center;
}

.stat-item { text-align: center; }

.stat-number {
  font-size: 32px;
  font-weight: 700;
  color: var(--accent-primary);
  display: block;
  font-family: 'Courier New', monospace;
}

.stat-label {
  font-size: 12px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.subjects-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
  gap: 24px;
}

.subject-card {
  padding: 24px;
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
}

.subject-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: var(--accent-color);
}

.subject-card:hover { transform: translateY(-6px); }

.subject-card.math { --accent-color: #667eea; }
.subject-card.dsa { --accent-color: #4ecdc4; }
.subject-card.coa { --accent-color: #45b7d1; }
.subject-card.prog { --accent-color: #f9ca24; }
.subject-card.os { --accent-color: #f0932b; }
.subject-card.uhv { --accent-color: #eb4d4b; }

.subject-header {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  margin-bottom: 20px;
  position: relative;
}

.subject-icon {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  color: white;
  flex-shrink: 0;
}

.subject-info { flex: 1; }

.subject-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 4px;
  line-height: 1.3;
}

.subject-code {
  font-size: 12px;
  color: var(--text-secondary);
  font-weight: 500;
  margin-bottom: 8px;
}

.subject-details {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 20px;
}

.detail-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.detail-label {
  font-size: 14px;
  color: var(--text-secondary);
}

.detail-value {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
}

.faculty-name { color: var(--accent-color) !important; }

.progress-section { margin-bottom: 20px; }

.time-display {
  font-family: 'Courier New', monospace;
  font-size: 14px;
  font-weight: 600;
  color: var(--accent-color);
  margin-bottom: 8px;
}

.progress-bar {
  width: 100%;
  height: 8px;
  background: var(--bg-tertiary);
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 8px;
}

.progress-fill {
  height: 100%;
  background: var(--accent-color);
  width: 0%;
  transition: width 1s ease;
  border-radius: 4px;
}

.progress-text {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  color: var(--text-secondary);
}

.file-upload-area {
  border: 2px dashed var(--border-primary);
  border-radius: 8px;
  padding: 20px;
  margin-top: 16px;
  text-align: center;
  background: var(--bg-tertiary);
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
}

.file-upload-area:hover,
.file-upload-area.dragover {
  border-color: var(--accent-primary);
  background: rgba(102, 126, 234, 0.1);
}

.upload-text {
  color: var(--text-secondary);
  font-size: 14px;
  margin-bottom: 4px;
}

.upload-subtext {
  color: var(--text-muted);
  font-size: 12px;
}

.upload-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  background: var(--accent-primary);
  width: 0%;
  transition: width 0.3s ease;
}

.subject-actions {
  display: flex;
  gap: 12px;
}

.btn {
  padding: 12px 16px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn-primary {
  background: var(--accent-primary);
  color: white;
  flex: 1;
}

.btn-primary:hover {
  background: var(--accent-secondary);
  transform: translateY(-1px);
}

.btn-secondary {
  background: var(--bg-tertiary);
  color: var(--text-secondary);
  border: 1px solid var(--border-primary);
}

.btn-secondary:hover {
  background: var(--border-primary);
  color: var(--text-primary);
}

.btn-secondary.active {
  background: var(--accent-primary);
  color: white;
}

/* ===== MODALS ===== */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

.modal.show { display: flex; }

.modal-content {
  background: var(--bg-secondary);
  border-radius: 12px;
  padding: 32px;
  max-width: 500px;
  width: 90%;
  border: 1px solid var(--border-primary);
  box-shadow: var(--shadow-lg);
  max-height: 80vh;
  overflow-y: auto;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
}

.modal-title {
  font-size: 24px;
  font-weight: 700;
  color: var(--text-primary);
}

.modal-close {
  background: none;
  border: none;
  font-size: 24px;
  color: var(--text-secondary);
  cursor: pointer;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s ease;
}

.modal-close:hover {
  background: var(--bg-tertiary);
  color: var(--text-primary);
}

/* ===== TIMER ===== */
.timer-display {
  font-family: 'Courier New', monospace;
  font-size: 48px;
  font-weight: 700;
  color: var(--accent-primary);
  text-align: center;
  margin: 24px 0;
}

.timer-controls {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin: 24px 0;
}

.timer-btn {
  padding: 12px 24px;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.timer-btn.start {
  background: var(--accent-success);
  color: white;
}

.timer-btn.pause {
  background: var(--accent-warning);
  color: white;
}

.timer-btn.stop {
  background: var(--accent-danger);
  color: white;
}

.timer-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  margin-top: 24px;
  padding-top: 24px;
  border-top: 1px solid var(--border-primary);
}

.timer-stat {
  text-align: center;
}

.timer-stat-value {
  font-size: 20px;
  font-weight: 700;
  color: var(--accent-primary);
  display: block;
}

.timer-stat-label {
  font-size: 12px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* ===== MATERIALS ===== */
.materials-list {
  max-height: 400px;
  overflow-y: auto;
  margin: 20px 0;
}

.file-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  background: var(--bg-tertiary);
  border-radius: 8px;
  margin-bottom: 12px;
  border: 1px solid var(--border-primary);
}

.file-info {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 12px;
}

.file-icon {
  font-size: 24px;
}

.file-details {
  flex: 1;
}

.file-name {
  font-size: 14px;
  color: var(--text-primary);
  font-weight: 600;
  margin-bottom: 4px;
}

.file-meta {
  font-size: 12px;
  color: var(--text-secondary);
}

.file-actions {
  display: flex;
  gap: 8px;
}

.file-btn {
  padding: 8px 12px;
  background: var(--bg-secondary);
  border: 1px solid var(--border-primary);
  border-radius: 6px;
  color: var(--text-primary);
  cursor: pointer;
  font-size: 12px;
  transition: all 0.2s ease;
}

.file-btn:hover {
  background: var(--accent-primary);
  color: white;
}

.file-btn.danger:hover {
  background: var(--accent-danger);
}

/* ===== PROGRESS ANALYTICS ===== */
.progress-container {
  padding: 40px;
  max-width: 1400px;
  margin: 0 auto;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 24px;
  margin-bottom: 32px;
}

.stat-card {
  padding: 24px;
  text-align: center;
}

.chart-container {
  padding: 24px;
  min-height: 350px;
}

.charts-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 24px;
  margin-bottom: 40px;
}

.chart-container.full-width {
  grid-column: 1 / -1;
}

.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.chart-title {
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary);
}

/* ===== HEATMAP ===== */
.heatmap-container {
  display: grid;
  grid-template-columns: repeat(10, 1fr);
  gap: 3px;
  margin: 20px 0;
}

.heatmap-day {
  aspect-ratio: 1;
  border-radius: 3px;
  background: var(--bg-tertiary);
  cursor: pointer;
  transition: all 0.2s ease;
}

.heatmap-day:hover {
  transform: scale(1.2);
}

.heatmap-day[data-level="1"] { background: rgba(102, 126, 234, 0.3); }
.heatmap-day[data-level="2"] { background: rgba(102, 126, 234, 0.5); }
.heatmap-day[data-level="3"] { background: rgba(102, 126, 234, 0.7); }
.heatmap-day[data-level="4"] { background: rgba(102, 126, 234, 1); }

/* ===== AI TOOLS ===== */
.ai-tools-container {
  padding: 40px;
  max-width: 1200px;
  margin: 0 auto;
}

.ai-tools-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 24px;
  margin-bottom: 40px;
}

.ai-tool-card {
  padding: 32px;
  text-align: center;
}

.tool-icon {
  width: 64px;
  height: 64px;
  background: var(--accent-primary);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  margin: 0 auto 16px;
  color: white;
}

.tool-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 8px;
}

.tool-description {
  color: var(--text-secondary);
  margin-bottom: 20px;
}

.tool-status {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  margin-bottom: 16px;
}

.tool-status.connected {
  background: rgba(16, 185, 129, 0.2);
  color: var(--accent-success);
}

.tool-status.disconnected {
  background: rgba(239, 68, 68, 0.2);
  color: var(--accent-danger);
}

.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: currentColor;
}

/* ===== CHAT ===== */
.chat-container {
  height: 500px;
  border: 1px solid var(--border-primary);
  border-radius: 12px;
  overflow: hidden;
  margin-bottom: 16px;
  display: flex;
  flex-direction: column;
}

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  background: var(--bg-primary);
}

.chat-message {
  margin-bottom: 16px;
  max-width: 80%;
}

.chat-message.user {
  margin-left: auto;
  background: var(--accent-primary);
  color: white;
  padding: 12px 16px;
  border-radius: 12px;
}

.chat-message.ai {
  background: var(--bg-tertiary);
  color: var(--text-primary);
  padding: 12px 16px;
  border-radius: 12px;
}

.chat-input-container {
  display: flex;
  gap: 12px;
  padding: 20px;
  background: var(--bg-secondary);
  border-top: 1px solid var(--border-primary);
}

.chat-input {
  flex: 1;
  padding: 12px 16px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border-primary);
  border-radius: 8px;
  color: var(--text-primary);
  outline: none;
}

.send-btn {
  padding: 12px 20px;
  background: var(--accent-primary);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}

.send-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* ===== FORMS ===== */
.form-group {
  margin-bottom: 20px;
}

.form-label {
  display: block;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 8px;
}

.form-input,
.form-select {
  width: 100%;
  padding: 12px 16px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border-primary);
  border-radius: 8px;
  color: var(--text-primary);
  font-size: 14px;
  outline: none;
}

.form-input:focus,
.form-select:focus {
  border-color: var(--accent-primary);
}

.form-help {
  font-size: 12px;
  color: var(--text-secondary);
  margin-top: 4px;
}

/* ===== ACHIEVEMENTS ===== */
.achievements-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 16px;
}

.achievement-badge {
  padding: 20px;
  text-align: center;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.achievement-badge.unlocked {
  background: linear-gradient(135deg, var(--accent-success), rgba(16, 185, 129, 0.8));
}

.achievement-badge.locked {
  opacity: 0.5;
}

.achievement-icon {
  font-size: 40px;
  margin-bottom: 12px;
  display: block;
}

.achievement-title {
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.achievement-desc {
  font-size: 12px;
  color: var(--text-secondary);
}

/* ===== RESPONSIVE ===== */
@media (max-width: 1024px) {
  .sidebar {
    transform: translateX(-100%);
  }

  .sidebar.open {
    transform: translateX(0);
  }

  .main-content {
    margin-left: 0;
  }

  .mobile-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
    display: none;
  }

  .mobile-overlay.show {
    display: block;
  }
}

@media (max-width: 768px) {
  .subjects-grid {
    grid-template-columns: 1fr;
  }

  .charts-grid {
    grid-template-columns: 1fr;
  }

  .top-bar {
    padding: 16px 20px;
  }

  .page-title {
    font-size: 24px;
  }

  .subjects-container,
  .progress-container,
  .ai-tools-container {
    padding: 20px;
  }
}

/* ===== UTILITY ===== */
.hidden { display: none !important; }
.show { display: flex !important; }

/* ===== NOTIFICATIONS ===== */
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: var(--bg-secondary);
  color: var(--text-primary);
  padding: 16px 24px;
  border-radius: 12px;
  border: 1px solid var(--border-primary);
  box-shadow: var(--shadow-lg);
  z-index: 10000;
  max-width: 400px;
  animation: slideIn 0.3s ease;
}

.notification.success {
  border-left: 4px solid var(--accent-success);
}

.notification.error {
  border-left: 4px solid var(--accent-danger);
}

@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}
</style>
</head>

<body data-theme="dark">
<!-- Mobile Overlay -->
<div class="mobile-overlay" id="mobileOverlay"></div>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="logo">
      <div class="logo-icon">AH</div>
      <div class="logo-text">Academic Hub</div>
    </div>
    
    <div class="search-container">
      <span class="search-icon">üîç</span>
      <input type="text" class="search-input" placeholder="Search subjects..." id="searchInput">
    </div>
  </div>

  <div class="sidebar-nav">
    <div class="nav-section">
      <div class="nav-title">Dashboard</div>
      <div class="nav-item active" data-content="subjects">
        <span class="nav-icon">üìö</span>
        <span>My Subjects</span>
      </div>
      <div class="nav-item" data-content="progress">
        <span class="nav-icon">üìä</span>
        <span>Progress Analytics</span>
      </div>
      <div class="nav-item" data-content="schedule">
        <span class="nav-icon">üìÖ</span>
        <span>Smart Schedule</span>
      </div>
      <div class="nav-item" data-content="materials">
        <span class="nav-icon">üìÅ</span>
        <span>Materials Hub</span>
      </div>
    </div>

    <div class="nav-section">
      <div class="nav-title">AI Tools</div>
      <div class="nav-item" data-content="ai-chat">
        <span class="nav-icon">ü§ñ</span>
        <span>AI Assistant</span>
      </div>
      <div class="nav-item" data-content="notebook-llm">
        <span class="nav-icon">üìì</span>
        <span>NotebookLLM</span>
      </div>
    </div>

    <div class="nav-section">
      <div class="nav-title">Tools</div>
      <div class="nav-item" data-content="timer">
        <span class="nav-icon">‚è±Ô∏è</span>
        <span>Focus Timer</span>
      </div>
      <div class="nav-item" data-content="notes">
        <span class="nav-icon">üìù</span>
        <span>Smart Notes</span>
      </div>
      <div class="nav-item" data-content="goals">
        <span class="nav-icon">üéØ</span>
        <span>Study Goals</span>
      </div>
    </div>

    <div class="nav-section">
      <div class="nav-title">Account</div>
      <div class="nav-item" data-content="settings">
        <span class="nav-icon">‚öôÔ∏è</span>
        <span>Settings</span>
      </div>
      <div class="nav-item" data-content="help">
        <span class="nav-icon">‚ùì</span>
        <span>Help</span>
      </div>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="main-content">
  <!-- Subjects Content -->
  <div class="content-area active" id="subjects-content">
    <div class="top-bar">
      <h1 class="page-title">My Subjects</h1>
      <div class="top-bar-controls">
        <div class="real-time-display">
          <div class="current-date" id="currentDate"></div>
          <div class="current-time" id="currentTime"></div>
        </div>
        <button class="btn btn-primary" onclick="addNewSubject()">‚ûï Add Subject</button>
        <button class="theme-toggle" id="themeToggle">üåô</button>
      </div>
    </div>

    <div class="subjects-container">
      <div class="subjects-header">
        <div class="subjects-stats">
          <div class="stat-item">
            <span class="stat-number" id="totalSubjects">6</span>
            <span class="stat-label">Total Subjects</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="totalCredits">23</span>
            <span class="stat-label">Credits</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="avgProgress">0%</span>
            <span class="stat-label">Avg Progress</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="totalStudyTime">0h</span>
            <span class="stat-label">Study Time</span>
          </div>
        </div>
      </div>

      <div class="subjects-grid" id="subjectsGrid"></div>
    </div>
  </div>

  <!-- Progress Analytics Content -->
  <div class="content-area" id="progress-content">
    <div class="top-bar">
      <h1 class="page-title">üìä Progress Analytics</h1>
      <div class="top-bar-controls">
        <div class="real-time-display">
          <div class="current-date" id="progressCurrentDate"></div>
          <div class="current-time" id="progressCurrentTime"></div>
        </div>
        <button class="theme-toggle">üåô</button>
      </div>
    </div>

    <div class="progress-container">
      <div class="stats-grid">
        <div class="glass stat-card">
          <div class="stat-icon">üìö</div>
          <div class="stat-number" id="totalStudyTimeProgress">0h</div>
          <div class="stat-label">Total Study Time</div>
        </div>
        <div class="glass stat-card">
          <div class="stat-icon">üéØ</div>
          <div class="stat-number" id="averageProgressStat">0%</div>
          <div class="stat-label">Average Progress</div>
        </div>
        <div class="glass stat-card">
          <div class="stat-icon">üî•</div>
          <div class="stat-number" id="studyStreak">0</div>
          <div class="stat-label">Study Streak</div>
        </div>
        <div class="glass stat-card">
          <div class="stat-icon">üìà</div>
          <div class="stat-number" id="todayStudyTime">0h</div>
          <div class="stat-label">Today's Study</div>
        </div>
      </div>

      <div class="charts-grid">
        <div class="glass chart-container">
          <div class="chart-header">
            <h3 class="chart-title">üìä Weekly Progress</h3>
            <select id="weeklyChartSubject">
              <option value="all">All Subjects</option>
            </select>
          </div>
          <canvas id="weeklyProgressChart"></canvas>
        </div>

        <div class="glass chart-container">
          <div class="chart-header">
            <h3 class="chart-title">üéØ Subject Distribution</h3>
          </div>
          <canvas id="subjectDistributionChart"></canvas>
        </div>

        <div class="glass chart-container">
          <div class="chart-header">
            <h3 class="chart-title">üìà Performance Trend</h3>
            <div>
              <button class="btn btn-secondary active" data-period="7">7D</button>
              <button class="btn btn-secondary" data-period="30">30D</button>
              <button class="btn btn-secondary" data-period="90">90D</button>
            </div>
          </div>
          <canvas id="performanceTrendChart"></canvas>
        </div>

        <div class="glass chart-container full-width">
          <div class="chart-header">
            <h3 class="chart-title">üóìÔ∏è Study Activity Heatmap (Last 30 Days)</h3>
          </div>
          <div class="heatmap-container" id="studyHeatmap"></div>
        </div>
      </div>

      <h3 style="margin: 24px 0 16px; color: var(--text-primary);">üèÜ Achievements</h3>
      <div class="achievements-grid" id="achievementsGrid"></div>
    </div>
  </div>

  <!-- AI Chat Content -->
  <div class="content-area" id="ai-chat-content">
    <div class="top-bar">
      <h1 class="page-title">ü§ñ AI Assistant</h1>
      <div class="top-bar-controls">
        <button class="btn btn-secondary" onclick="openSettings()">‚öôÔ∏è API Settings</button>
        <button class="theme-toggle">üåô</button>
      </div>
    </div>

    <div class="ai-tools-container">
      <div class="ai-tools-grid">
        <div class="glass ai-tool-card">
          <div class="tool-icon">üí¨</div>
          <div class="tool-title">ChatGPT Assistant</div>
          <div class="tool-description">Get instant help with your studies using ChatGPT via OpenRouter API</div>
          <div class="tool-status disconnected" id="chatgpt-status">
            <span class="status-dot"></span>
            <span>Not Connected</span>
          </div>
          <button onclick="initializeChatGPT()" class="btn btn-primary">Start Chat</button>
        </div>

        <div class="glass ai-tool-card">
          <div class="tool-icon">üìñ</div>
          <div class="tool-title">Study Assistant</div>
          <div class="tool-description">AI that understands your subjects and provides contextual help</div>
          <div class="tool-status connected">
            <span class="status-dot"></span>
            <span>Ready</span>
          </div>
          <button onclick="initializeChatGPT()" class="btn btn-primary">Ask Questions</button>
        </div>
      </div>

      <div class="glass" id="chatPanel" style="display: none;">
        <div class="chart-header">
          <h3 class="chart-title">üí¨ AI Study Assistant</h3>
          <button onclick="closeChatInterface()" class="btn btn-secondary">‚úï</button>
        </div>
        <div class="chat-container">
          <div class="chat-messages" id="chatMessages">
            <div class="chat-message ai">
              <strong>AI Assistant:</strong> Hello! I'm here to help with your studies. What would you like to know?
            </div>
          </div>
          <div class="chat-input-container">
            <input type="text" class="chat-input" id="chatInput" placeholder="Ask me anything about your subjects...">
            <button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- NotebookLLM Content -->
  <div class="content-area" id="notebook-llm-content">
    <div class="top-bar">
      <h1 class="page-title">üìì NotebookLLM</h1>
      <div class="top-bar-controls">
        <button onclick="openSettings()" class="btn btn-secondary">‚öôÔ∏è Settings</button>
        <button class="theme-toggle">üåô</button>
      </div>
    </div>

    <div class="ai-tools-container">
      <div class="glass">
        <div class="chart-header">
          <h3 class="chart-title">üìì Document Analysis & Insights</h3>
        </div>
        <div style="text-align: center; padding: 40px;">
          <div class="tool-icon" style="margin: 0 auto 20px;">üìÅ</div>
          <p style="color: var(--text-secondary); margin-bottom: 20px;">
            Upload your study materials to get AI-powered insights and summaries.
          </p>
          <button class="btn btn-primary" onclick="uploadDocument()">üìé Upload Document</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Other Content Areas -->
  <div class="content-area" id="schedule-content">
    <div class="top-bar">
      <h1 class="page-title">üìÖ Smart Schedule</h1>
      <button class="theme-toggle">üåô</button>
    </div>
    <div style="padding: 40px; text-align: center;">
      <div class="glass" style="padding: 40px;">
        <h3>Smart Scheduling</h3>
        <p style="color: var(--text-secondary);">AI-powered schedule optimization coming soon!</p>
      </div>
    </div>
  </div>

  <div class="content-area" id="materials-content">
    <div class="top-bar">
      <h1 class="page-title">üìÅ Materials Hub</h1>
      <button class="theme-toggle">üåô</button>
    </div>
    <div style="padding: 40px; text-align: center;">
      <div class="glass" style="padding: 40px;">
        <h3>Materials Hub</h3>
        <p style="color: var(--text-secondary);">Centralized materials management!</p>
      </div>
    </div>
  </div>

  <div class="content-area" id="timer-content">
    <div class="top-bar">
      <h1 class="page-title">‚è±Ô∏è Focus Timer</h1>
      <button class="theme-toggle">üåô</button>
    </div>
    <div style="padding: 40px; text-align: center;">
      <div class="glass" style="padding: 40px;">
        <h3>Focus Timer</h3>
        <p style="color: var(--text-secondary);">Pomodoro timer and focus sessions!</p>
      </div>
    </div>
  </div>

  <div class="content-area" id="notes-content">
    <div class="top-bar">
      <h1 class="page-title">üìù Smart Notes</h1>
      <button class="theme-toggle">üåô</button>
    </div>
    <div style="padding: 40px; text-align: center;">
      <div class="glass" style="padding: 40px;">
        <h3>Smart Notes</h3>
        <p style="color: var(--text-secondary);">AI-enhanced note taking!</p>
      </div>
    </div>
  </div>

  <div class="content-area" id="goals-content">
    <div class="top-bar">
      <h1 class="page-title">üéØ Study Goals</h1>
      <button class="theme-toggle">üåô</button>
    </div>
    <div style="padding: 40px; text-align: center;">
      <div class="glass" style="padding: 40px;">
        <h3>Study Goals</h3>
        <p style="color: var(--text-secondary);">Set and track your academic goals!</p>
      </div>
    </div>
  </div>

  <div class="content-area" id="settings-content">
    <div class="top-bar">
      <h1 class="page-title">‚öôÔ∏è Settings</h1>
      <button class="theme-toggle">üåô</button>
    </div>
    <div style="padding: 40px;">
      <div class="glass" style="padding: 32px;">
        <h3 style="margin-bottom: 24px;">üîë API Configuration</h3>
        <div class="form-group">
          <label class="form-label">OpenRouter API Key</label>
          <input type="password" class="form-input" id="settingsApiKey" placeholder="Enter your OpenRouter API key">
          <div class="form-help">Get your API key from <a href="https://openrouter.ai" target="_blank" style="color: var(--accent-primary);">openrouter.ai</a></div>
        </div>
        <div class="form-group">
          <label class="form-label">Preferred AI Model</label>
          <select class="form-select" id="settingsModel">
            <option value="openai/gpt-4-turbo">GPT-4 Turbo</option>
            <option value="openai/gpt-3.5-turbo">GPT-3.5 Turbo</option>
            <option value="anthropic/claude-3-opus">Claude-3 Opus</option>
          </select>
        </div>
        <button onclick="saveMainSettings()" class="btn btn-primary">üíæ Save Settings</button>
      </div>
    </div>
  </div>

  <div class="content-area" id="help-content">
    <div class="top-bar">
      <h1 class="page-title">‚ùì Help</h1>
      <button class="theme-toggle">üåô</button>
    </div>
    <div style="padding: 40px; text-align: center;">
      <div class="glass" style="padding: 40px;">
        <h3>Help & Support</h3>
        <p style="color: var(--text-secondary);">Get help with Academic Hub features!</p>
      </div>
    </div>
  </div>
</div>

<!-- Study Timer Modal -->
<div class="modal" id="timerModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title" id="timerModalTitle">Study Timer</h2>
      <button class="modal-close" onclick="closeTimer()">√ó</button>
    </div>
    
    <div class="timer-display" id="timerDisplay">00:00:00</div>
    
    <div class="timer-controls">
      <button class="timer-btn start" id="startBtn">‚ñ∂Ô∏è Start</button>
      <button class="timer-btn pause hidden" id="pauseBtn">‚è∏Ô∏è Pause</button>
      <button class="timer-btn stop hidden" id="stopBtn">‚èπÔ∏è Stop</button>
    </div>

    <div class="timer-stats">
      <div class="timer-stat">
        <span class="timer-stat-value" id="sessionTime">0m</span>
        <span class="timer-stat-label">Session</span>
      </div>
      <div class="timer-stat">
        <span class="timer-stat-value" id="todayTime">0m</span>
        <span class="timer-stat-label">Today</span>
      </div>
    </div>
  </div>
</div>

<!-- Materials Modal -->
<div class="modal" id="materialsModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title" id="materialsTitle">Materials</h2>
      <button class="modal-close" onclick="closeMaterials()">√ó</button>
    </div>
    
    <div class="materials-list" id="materialsList"></div>
    
    <div style="text-align: center; margin-top: 20px;">
      <button class="btn btn-primary" id="uploadMoreBtn">üìé Upload Files</button>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div class="modal" id="settingsModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">üîë OpenRouter API Settings</h2>
      <button class="modal-close" onclick="closeSettings()">√ó</button>
    </div>
    
    <div class="form-group">
      <label class="form-label">API Key</label>
      <input class="form-input" id="apiKeyInput" type="password" placeholder="sk-or-v1-...">
      <div class="form-help">Your API key is stored securely in your browser only.</div>
    </div>
    
    <div class="form-group">
      <label class="form-label">Default Model</label>
      <select class="form-select" id="modelSelect">
        <option value="openai/gpt-4-turbo">GPT-4 Turbo</option>
        <option value="openai/gpt-3.5-turbo">GPT-3.5 Turbo</option>
        <option value="anthropic/claude-3-sonnet">Claude-3 Sonnet</option>
      </select>
    </div>
    
    <div style="text-align: center; margin-top: 24px;">
      <button class="btn btn-primary" onclick="saveSettings()">üíæ Save</button>
    </div>
  </div>
</div>

<script>
/* ===== GLOBAL STATE ===== */
const defaultSubjects = [
  {id:'math', icon:'üìê', title:'Transforms and Boundary Value Problems', code:'21MAB201T', credits:4, faculty:'Dr. V. Vidhya', color:'#667eea'},
  {id:'dsa', icon:'üå≥', title:'Data Structures and Algorithms', code:'21CSC201J', credits:4, faculty:'Dr. Kalpana C', color:'#4ecdc4'},
  {id:'coa', icon:'üèóÔ∏è', title:'Computer Organization and Architecture', code:'21CSS201T', credits:4, faculty:'Dr. Meenakshi M', color:'#45b7d1'},
  {id:'prog', icon:'üë®‚Äçüíª', title:'Advanced Programming Practice', code:'21CSC203P', credits:4, faculty:'Dr. Prince Chelladurai S', color:'#f9ca24'},
  {id:'os', icon:'‚öôÔ∏è', title:'Operating Systems', code:'21CSC202J', credits:4, faculty:'Dr. G. Priyadharshini', color:'#f0932b'},
  {id:'uhv', icon:'üß†', title:'Universal Human Values - II', code:'21LEM202T', credits:3, faculty:'Dr. Caleb Theodar M', color:'#eb4d4b'}
];

let subjects = JSON.parse(localStorage.getItem('ah-subjects') || 'null') || defaultSubjects;
let files = JSON.parse(localStorage.getItem('ah-files') || 'null') || {};
let studyTimes = JSON.parse(localStorage.getItem('ah-studyTimes') || 'null') || {};
let dailyLog = JSON.parse(localStorage.getItem('ah-dailyLog') || 'null') || {};
let aiConfig = JSON.parse(localStorage.getItem('ah-ai') || 'null') || {key:'', model:'openai/gpt-4-turbo'};

let timer = null, startT = 0, paused = 0, currentSub = null;
const charts = {};

/* ===== INITIALIZATION ===== */
document.addEventListener('DOMContentLoaded', () => {
  buildSubjectCards();
  refreshStats();
  buildSubjectSelect();
  initTheme();
  tickClock();
  setInterval(tickClock, 1000);
  initNav();
  initCharts();
  initHeatmap();
  initAchievements();
  checkAIStatus();
});

/* ===== NAVIGATION ===== */
function initNav() {
  document.querySelectorAll('.nav-item').forEach(el => {
    el.onclick = () => {
      const id = el.dataset.content;
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      el.classList.add('active');
      document.querySelectorAll('.content-area').forEach(c => c.classList.remove('active'));
      document.getElementById(id + '-content').classList.add('active');
      if (id === 'progress') { updateCharts(); }
    };
  });
}

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('mobileOverlay').classList.toggle('show');
}

/* ===== CLOCK ===== */
function tickClock() {
  const now = new Date();
  const d = now.toLocaleDateString(undefined, {weekday:'long', day:'numeric', month:'short', year:'numeric'});
  const t = now.toLocaleTimeString(undefined, {hour:'2-digit', minute:'2-digit', second:'2-digit'});
  document.querySelectorAll('#currentDate, #progressCurrentDate').forEach(e => e.textContent = d);
  document.querySelectorAll('#currentTime, #progressCurrentTime').forEach(e => e.textContent = t);
}

/* ===== THEME ===== */
function initTheme() {
  const btns = document.querySelectorAll('.theme-toggle');
  btns.forEach(b => b.onclick = () => {
    const body = document.body, n = body.dataset.theme === 'dark' ? 'light' : 'dark';
    body.dataset.theme = n;
    localStorage.setItem('ah-theme', n);
    btns.forEach(x => x.textContent = n === 'dark' ? 'üåô' : '‚òÄÔ∏è');
    updateChartsColors();
  });
  
  const saved = localStorage.getItem('ah-theme');
  if (saved) { document.body.dataset.theme = saved; }
  btns.forEach(x => x.textContent = document.body.dataset.theme === 'dark' ? 'üåô' : '‚òÄÔ∏è');
}

/* ===== SUBJECT MANAGEMENT ===== */
function buildSubjectCards() {
  const grid = document.getElementById('subjectsGrid');
  grid.innerHTML = '';
  
  subjects.forEach(s => {
    const pct = Math.min((studyTimes[s.id] || 0) / 14400 * 100, 100); // 4h target
    grid.insertAdjacentHTML('beforeend', `
      <div class="glass subject-card ${s.id}" data-id="${s.id}">
        <div class="subject-header">
          <div class="subject-icon" style="background:${s.color}">${s.icon}</div>
          <div class="subject-info">
            <div class="subject-title">${s.title}</div>
            <div class="subject-code">${s.code}</div>
          </div>
          <button class="modal-close" style="font-size:18px" onclick="deleteSubject('${s.id}')" title="Delete">üóëÔ∏è</button>
        </div>
        <div class="subject-details">
          <div class="detail-item"><span class="detail-label">Credits</span><span class="detail-value">${s.credits}</span></div>
          <div class="detail-item"><span class="detail-label">Faculty</span><span class="detail-value faculty-name">${s.faculty}</span></div>
        </div>
        <div class="progress-section">
          <div class="time-display">Study <span id="time-${s.id}">${formatTimeH(studyTimes[s.id] || 0)}</span></div>
          <div class="progress-bar"><div class="progress-fill" id="bar-${s.id}" style="width:${pct}%"></div></div>
          <div class="progress-text"><span id="pct-${s.id}">${Math.round(pct)}%</span><span>Target 4h</span></div>
        </div>
        <div class="file-upload-area" onclick="triggerUpload('${s.id}')" ondragover="dragOver(event,this)" ondragleave="dragLeave(event,this)" ondrop="dropFiles(event,'${s.id}')">
          <div class="upload-text">üìé Drop files here or click to upload</div>
          <div class="upload-subtext">PDF, DOCX, PPTX, images...</div>
          <div class="upload-progress" id="up-${s.id}"></div>
        </div>
        <div class="subject-actions">
          <button class="btn btn-secondary" onclick="openMaterials('${s.id}')">üìÅ Materials</button>
          <button class="btn btn-primary" onclick="openTimer('${s.id}')">‚ñ∂Ô∏è Study Now</button>
        </div>
      </div>
    `);
  });
  
  document.getElementById('totalSubjects').textContent = subjects.length;
  document.getElementById('totalCredits').textContent = subjects.reduce((n, s) => n + s.credits, 0);
}

function addNewSubject() {
  const title = prompt('Subject title:');
  if (!title) return;
  
  const code = prompt('Subject code:') || 'NEW';
  const faculty = prompt('Faculty name:') || 'TBD';
  const credits = parseInt(prompt('Credits:') || '3');
  
  const id = 'sub' + Date.now();
  const colors = ['#667eea', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7', '#fd79a8'];
  const color = colors[Math.floor(Math.random() * colors.length)];
  
  subjects.push({
    id, title, code, faculty, credits, color,
    icon: 'üìñ'
  });
  
  save('subjects', subjects);
  buildSubjectCards();
  buildSubjectSelect();
  show('success', 'Subject added successfully!');
}

function deleteSubject(id) {
  if (!confirm('Delete this subject and all its data?')) return;
  
  subjects = subjects.filter(s => s.id !== id);
  delete files[id];
  delete studyTimes[id];
  
  saveAll();
  buildSubjectCards();
  buildSubjectSelect();
  refreshStats();
  updateCharts();
  show('success', 'Subject deleted');
}

/* ===== FILE UPLOAD ===== */
function triggerUpload(sub) {
  const i = document.createElement('input');
  i.type = 'file';
  i.multiple = true;
  i.onchange = e => saveFiles(sub, [...e.target.files]);
  i.click();
}

function dragOver(e, el) {
  e.preventDefault();
  el.classList.add('dragover');
}

function dragLeave(e, el) {
  e.preventDefault();
  el.classList.remove('dragover');
}

function dropFiles(e, sub) {
  e.preventDefault();
  e.currentTarget.classList.remove('dragover');
  saveFiles(sub, [...e.dataTransfer.files]);
}

function saveFiles(sub, fls) {
  if (!files[sub]) files[sub] = [];
  const bar = document.getElementById('up-' + sub);
  let done = 0;
  
  fls.forEach(f => {
    if (f.size > 10 * 1024 * 1024) {
      show('error', f.name + ' is too large (max 10MB)');
      done++;
      return;
    }
    
    const r = new FileReader();
    r.onload = ev => {
      files[sub].push({
        id: Date.now() + Math.random(),
        name: f.name,
        size: f.size,
        data: ev.target.result,
        ts: Date.now()
      });
      done++;
      if (bar) bar.style.width = (done / fls.length * 100) + '%';
      if (done === fls.length) {
        if (bar) bar.style.width = '0%';
        save('files', files);
        show('success', 'Upload complete!');
      }
    };
    r.readAsDataURL(f);
  });
}

/* ===== MATERIALS MODAL ===== */
function openMaterials(sub) {
  const modal = document.getElementById('materialsModal');
  modal.classList.add('show');
  
  const subject = subjects.find(s => s.id === sub);
  document.getElementById('materialsTitle').textContent = subject.title + ' Materials';
  
  const list = document.getElementById('materialsList');
  list.innerHTML = '';
  
  const subjectFiles = files[sub] || [];
  if (subjectFiles.length === 0) {
    list.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">No materials uploaded yet</p>';
  } else {
    subjectFiles.forEach(f => {
      list.insertAdjacentHTML('beforeend', `
        <div class="file-item">
          <div class="file-info">
            <div class="file-icon">üìÑ</div>
            <div class="file-details">
              <div class="file-name">${f.name}</div>
              <div class="file-meta">${(f.size / 1024).toFixed(1)} KB ‚Ä¢ ${new Date(f.ts).toLocaleDateString()}</div>
            </div>
          </div>
          <div class="file-actions">
            <button class="file-btn" onclick="downloadFile('${sub}', ${f.id})">üì•</button>
            <button class="file-btn danger" onclick="delFile('${sub}', ${f.id})">üóëÔ∏è</button>
          </div>
        </div>
      `);
    });
  }
  
  document.getElementById('uploadMoreBtn').onclick = () => triggerUpload(sub);
}

function closeMaterials() {
  document.getElementById('materialsModal').classList.remove('show');
}

function downloadFile(sub, id) {
  const f = files[sub].find(x => x.id == id);
  if (!f) return;
  
  const a = document.createElement('a');
  a.href = f.data;
  a.download = f.name;
  document.body.append(a);
  a.click();
  a.remove();
  show('success', 'Download started');
}

function delFile(sub, id) {
  if (!confirm('Delete this file?')) return;
  files[sub] = files[sub].filter(x => x.id != id);
  save('files', files);
  openMaterials(sub);
  show('success', 'File deleted');
}

/* ===== TIMER ===== */
function openTimer(sub) {
  currentSub = sub;
  paused = 0;
  startT = Date.now();
  
  const subject = subjects.find(s => s.id === sub);
  document.getElementById('timerDisplay').textContent = '00:00:00';
  document.getElementById('timerModalTitle').textContent = 'Study ‚Äì ' + subject.title;
  document.getElementById('timerModal').classList.add('show');
  
  toggleBtns('stopped');
  updateTimerStats();
}

function closeTimer() {
  clearInterval(timer);
  timer = null;
  document.getElementById('timerModal').classList.remove('show');
}

function toggleBtns(state) {
  const s = document.getElementById('startBtn');
  const p = document.getElementById('pauseBtn');
  const st = document.getElementById('stopBtn');
  
  if (state === 'running') {
    s.classList.add('hidden');
    p.classList.remove('hidden');
    st.classList.remove('hidden');
  } else if (state === 'paused') {
    s.classList.remove('hidden');
    p.classList.add('hidden');
    st.classList.remove('hidden');
  } else {
    s.classList.remove('hidden');
    p.classList.add('hidden');
    st.classList.add('hidden');
  }
}

document.getElementById('startBtn').onclick = () => {
  if (timer) return;
  startT = Date.now() - paused;
  timer = setInterval(updateTimer, 1000);
  toggleBtns('running');
  show('success', 'Timer started!');
};

document.getElementById('pauseBtn').onclick = () => {
  if (!timer) return;
  clearInterval(timer);
  timer = null;
  paused = Date.now() - startT;
  toggleBtns('paused');
  show('warning', 'Timer paused');
};

document.getElementById('stopBtn').onclick = stopTimer;

function updateTimer() {
  const sec = Math.floor((Date.now() - startT) / 1000);
  document.getElementById('timerDisplay').textContent = formatHMS(sec);
  document.getElementById('sessionTime').textContent = Math.floor(sec / 60) + 'm';
  updateTimerStats();
}

function updateTimerStats() {
  const todayStudied = getTodayStudyTime();
  document.getElementById('todayTime').textContent = Math.floor(todayStudied / 60) + 'm';
}

function stopTimer() {
  if (!timer && !paused) return;
  
  const dur = (timer ? Date.now() - startT : paused) / 1000;
  if (dur < 60) {
    show('warning', 'Session too short (minimum 1 minute)');
    closeTimer();
    return;
  }
  
  clearInterval(timer);
  timer = null;
  toggleBtns('stopped');
  
  // Save study time
  studyTimes[currentSub] = (studyTimes[currentSub] || 0) + dur;
  const dStr = new Date().toDateString();
  dailyLog[dStr] = (dailyLog[dStr] || 0) + dur;
  
  saveAll();
  refreshStats();
  updateCharts();
  
  show('success', 'Session saved (' + Math.floor(dur / 60) + ' min)');
  closeTimer();
}

/* ===== ANALYTICS ===== */
function refreshStats() {
  subjects.forEach(s => {
    const t = studyTimes[s.id] || 0;
    const pct = Math.min(t / 14400 * 100, 100);
    const timeEl = document.getElementById('time-' + s.id);
    const barEl = document.getElementById('bar-' + s.id);
    const pctEl = document.getElementById('pct-' + s.id);
    
    if (timeEl) timeEl.textContent = formatTimeH(t);
    if (barEl) barEl.style.width = pct + '%';
    if (pctEl) pctEl.textContent = Math.round(pct) + '%';
  });
  
  const totalSec = Object.values(studyTimes).reduce((a, b) => a + b, 0);
  const todaySec = getTodayStudyTime();
  
  document.getElementById('totalStudyTime').textContent = (totalSec / 3600).toFixed(1) + 'h';
  document.getElementById('totalStudyTimeProgress').textContent = formatTimeH(totalSec);
  document.getElementById('avgProgress').textContent = Math.round(avgProgress()) + '%';
  document.getElementById('averageProgressStat').textContent = Math.round(avgProgress()) + '%';
  document.getElementById('todayStudyTime').textContent = formatTimeH(todaySec);
  
  // Update streak
  document.getElementById('studyStreak').textContent = calculateStreak();
}

function avgProgress() {
  const arr = subjects.map(s => Math.min((studyTimes[s.id] || 0) / 14400 * 100, 100));
  return arr.length ? arr.reduce((a, b) => a + b, 0) / arr.length : 0;
}

function getTodayStudyTime() {
  return dailyLog[new Date().toDateString()] || 0;
}

function calculateStreak() {
  let streak = 0;
  const today = new Date();
  
  for (let i = 0; i < 365; i++) {
    const date = new Date(today);
    date.setDate(date.getDate() - i);
    const dateStr = date.toDateString();
    
    if (dailyLog[dateStr] && dailyLog[dateStr] > 1800) { // At least 30 min
      streak++;
    } else if (i > 0) {
      break;
    }
  }
  
  return streak;
}

/* ===== CHARTS ===== */
function buildSubjectSelect() {
  const sel = document.getElementById('weeklyChartSubject');
  sel.innerHTML = '<option value="all">All Subjects</option>';
  subjects.forEach(s => sel.insertAdjacentHTML('beforeend', `<option value="${s.id}">${s.title}</option>`));
}

function initCharts() {
  if (typeof Chart === 'undefined') {
    console.warn('Chart.js not loaded');
    return;
  }
  
  const ctx1 = document.getElementById('weeklyProgressChart');
  if (ctx1) {
    charts.weekly = new Chart(ctx1, {
      type: 'line',
      data: {
        labels: last7(),
        datasets: [{
          label: 'Hours',
          data: weekData(),
          borderColor: '#667eea',
          backgroundColor: 'rgba(102,126,234,.2)',
          tension: .4,
          fill: true
        }]
      },
      options: chartOpts()
    });
  }
  
  const ctx2 = document.getElementById('subjectDistributionChart');
  if (ctx2) {
    charts.dist = new Chart(ctx2, {
      type: 'doughnut',
      data: {
        labels: subjects.map(s => s.title),
        datasets: [{
          data: subjects.map(s => (studyTimes[s.id] || 0) / 3600),
          backgroundColor: subjects.map(s => s.color)
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: { color: textCol() }
          }
        }
      }
    });
  }
  
  const ctx3 = document.getElementById('performanceTrendChart');
  if (ctx3) {
    charts.trend = new Chart(ctx3, {
      type: 'bar',
      data: {
        labels: lastNDays(7),
        datasets: [{
          data: perfData(7),
          backgroundColor: '#6366f1',
          borderRadius: 6
        }]
      },
      options: chartOpts(true)
    });
  }
}

function updateCharts() {
  if (charts.weekly) {
    charts.weekly.data.labels = last7();
    charts.weekly.data.datasets[0].data = weekData();
    charts.weekly.update();
  }
  
  if (charts.dist) {
    charts.dist.data.datasets[0].data = subjects.map(s => (studyTimes[s.id] || 0) / 3600);
    charts.dist.update();
  }
  
  if (charts.trend) {
    charts.trend.data.labels = lastNDays(7);
    charts.trend.data.datasets[0].data = perfData(7);
    charts.trend.update();
  }
}

function updateChartsColors() {
  const col = textCol();
  Object.values(charts).forEach(c => {
    if (c.options.scales) {
      c.options.scales.x.ticks.color = col;
      c.options.scales.y.ticks.color = col;
    }
    if (c.options.plugins.legend) {
      c.options.plugins.legend.labels.color = col;
    }
    c.update();
  });
}

function chartOpts(bar = false) {
  return {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        display: !bar,
        labels: { color: textCol() }
      }
    },
    scales: {
      x: {
        ticks: { color: textCol() },
        grid: { color: gridCol() }
      },
      y: {
        ticks: { color: textCol() },
        grid: { color: gridCol() },
        beginAtZero: true
      }
    }
  };
}

function textCol() {
  return document.body.dataset.theme === 'dark' ? '#fff' : '#1e1f23';
}

function gridCol() {
  return document.body.dataset.theme === 'dark' ? '#2d2e36' : '#e5e7eb';
}

function last7() {
  return [...Array(7)].map((_, i) => {
    const d = new Date();
    d.setDate(d.getDate() - 6 + i);
    return d.toLocaleDateString(undefined, { weekday: 'short' });
  });
}

function weekData() {
  return [...Array(7)].map((_, i) => {
    const d = new Date();
    d.setDate(d.getDate() - 6 + i);
    return ((dailyLog[d.toDateString()] || 0) / 3600).toFixed(2);
  });
}

function lastNDays(n) {
  return [...Array(n)].map((_, i) => {
    const d = new Date();
    d.setDate(d.getDate() - n + 1 + i);
    return d.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
  });
}

function perfData(n) {
  return lastNDays(n).map((_, i) => {
    const d = new Date();
    d.setDate(d.getDate() - n + 1 + i);
    const sec = dailyLog[d.toDateString()] || 0;
    return Math.min(sec / 14400 * 100, 100).toFixed(1);
  });
}

/* ===== HEATMAP ===== */
function initHeatmap() {
  const cont = document.getElementById('studyHeatmap');
  if (!cont) return;
  
  cont.innerHTML = '';
  const today = new Date();
  
  for (let i = 29; i >= 0; i--) {
    const d = new Date(today);
    d.setDate(d.getDate() - i);
    const sec = dailyLog[d.toDateString()] || 0;
    const lvl = sec === 0 ? 0 : sec < 1800 ? 1 : sec < 3600 ? 2 : sec < 7200 ? 3 : 4;
    
    cont.insertAdjacentHTML('beforeend', 
      `<div class="heatmap-day" data-level="${lvl}" title="${d.toLocaleDateString()}: ${formatTimeH(sec)}"></div>`
    );
  }
}

/* ===== ACHIEVEMENTS ===== */
function initAchievements() {
  const grid = document.getElementById('achievementsGrid');
  if (!grid) return;
  
  const achievements = [
    { icon: 'üåü', title: 'First Steps', desc: 'Complete your first study session', check: () => Object.values(studyTimes).some(t => t > 0) },
    { icon: 'üî•', title: 'Streak Master', desc: 'Study for 7 days in a row', check: () => calculateStreak() >= 7 },
    { icon: 'üí™', title: 'Marathon', desc: 'Study for 4+ hours in one day', check: () => Object.values(dailyLog).some(t => t >= 14400) },
    { icon: 'üéØ', title: 'Consistent', desc: 'Maintain 80%+ average progress', check: () => avgProgress() >= 80 },
    { icon: 'üìö', title: 'Scholar', desc: 'Upload 10+ study materials', check: () => Object.values(files).reduce((sum, arr) => sum + arr.length, 0) >= 10 },
    { icon: '‚ö°', title: 'Quick Learner', desc: 'Complete 20+ study sessions', check: () => Object.values(studyTimes).reduce((sum, t) => sum + Math.floor(t / 1800), 0) >= 20 }
  ];
  
  grid.innerHTML = achievements.map(a => `
    <div class="glass achievement-badge ${a.check() ? 'unlocked' : 'locked'}">
      <div class="achievement-icon">${a.icon}</div>
      <div class="achievement-title">${a.title}</div>
      <div class="achievement-desc">${a.desc}</div>
    </div>
  `).join('');
}

/* ===== AI INTEGRATION ===== */
function checkAIStatus() {
  const hasKey = aiConfig.key && aiConfig.key.length > 0;
  const status = document.getElementById('chatgpt-status');
  
  if (status) {
    status.className = hasKey ? 'tool-status connected' : 'tool-status disconnected';
    status.innerHTML = hasKey ? 
      '<span class="status-dot"></span><span>Connected</span>' :
      '<span class="status-dot"></span><span>Not Connected</span>';
  }
}

function initializeChatGPT() {
  if (!aiConfig.key) {
    openSettings();
    return;
  }
  
  const panel = document.getElementById('chatPanel');
  panel.style.display = 'block';
  panel.scrollIntoView({ behavior: 'smooth' });
}

function closeChatInterface() {
  document.getElementById('chatPanel').style.display = 'none';
}

async function sendMessage() {
  const input = document.getElementById('chatInput');
  const message = input.value.trim();
  
  if (!message || !aiConfig.key) {
    if (!aiConfig.key) {
      show('error', 'Please configure your OpenRouter API key first');
    }
    return;
  }
  
  // Add user message
  addMessageToChat('user', message);
  input.value = '';
  
  const sendBtn = document.getElementById('sendBtn');
  sendBtn.disabled = true;
  sendBtn.textContent = 'Sending...';
  
  try {
    const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${aiConfig.key}`,
        'Content-Type': 'application/json',
        'HTTP-Referer': window.location.origin,
        'X-Title': 'Academic Hub'
      },
      body: JSON.stringify({
        model: aiConfig.model,
        messages: [
          {
            role: 'system',
            content: 'You are an AI tutor helping a BTech AI/ML student. Be helpful and encouraging.'
          },
          {
            role: 'user',
            content: message
          }
        ],
        max_tokens: 1000,
        temperature: 0.7
      })
    });
    
    const data = await response.json();
    
    if (data.choices && data.choices[0]) {
      addMessageToChat('ai', data.choices[0].message.content);
    } else {
      addMessageToChat('ai', 'Sorry, I encountered an error. Please try again.');
    }
  } catch (error) {
    console.error('AI API Error:', error);
    addMessageToChat('ai', 'Sorry, I could not connect to the AI service. Please check your API key.');
  }
  
  sendBtn.disabled = false;
  sendBtn.textContent = 'Send';
}

function addMessageToChat(sender, message) {
  const chatMessages = document.getElementById('chatMessages');
  const messageDiv = document.createElement('div');
  messageDiv.className = `chat-message ${sender}`;
  
  if (sender === 'user') {
    messageDiv.innerHTML = `<strong>You:</strong> ${message}`;
  } else {
    messageDiv.innerHTML = `<strong>AI Assistant:</strong> ${message}`;
  }
  
  chatMessages.appendChild(messageDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Enable Enter key to send messages
document.addEventListener('keydown', function(e) {
  if (e.key === 'Enter' && document.getElementById('chatInput') === document.activeElement) {
    sendMessage();
  }
});

/* ===== SETTINGS ===== */
function openSettings() {
  document.getElementById('apiKeyInput').value = aiConfig.key;
  document.getElementById('modelSelect').value = aiConfig.model;
  document.getElementById('settingsModal').classList.add('show');
}

function closeSettings() {
  document.getElementById('settingsModal').classList.remove('show');
}

function saveSettings() {
  const key = document.getElementById('apiKeyInput').value.trim();
  const model = document.getElementById('modelSelect').value;
  
  aiConfig.key = key;
  aiConfig.model = model;
  
  save('ai', aiConfig);
  checkAIStatus();
  closeSettings();
  show('success', 'API settings saved successfully!');
}

function saveMainSettings() {
  const key = document.getElementById('settingsApiKey').value.trim();
  const model = document.getElementById('settingsModel').value;
  
  aiConfig.key = key;
  aiConfig.model = model;
  
  save('ai', aiConfig);
  checkAIStatus();
  show('success', 'Settings saved successfully!');
}

function uploadDocument() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.pdf,.doc,.docx,.txt';
  input.onchange = function(e) {
    const file = e.target.files[0];
    if (file) {
      show('success', `${file.name} uploaded! Analysis feature coming soon...`);
    }
  };
  input.click();
}

/* ===== UTILITY FUNCTIONS ===== */
function formatTimeH(seconds) {
  if (!seconds || seconds === 0) return '0h 0m';
  const hours = Math.floor(seconds / 3600);
  const minutes = Math.floor((seconds % 3600) / 60);
  return `${hours}h ${minutes}m`;
}

function formatHMS(seconds) {
  const h = Math.floor(seconds / 3600);
  const m = Math.floor((seconds % 3600) / 60);
  const s = seconds % 60;
  return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
}

function save(key, data) {
  localStorage.setItem('ah-' + key, JSON.stringify(data));
}

function saveAll() {
  save('subjects', subjects);
  save('files', files);
  save('studyTimes', studyTimes);
  save('dailyLog', dailyLog);
  save('ai', aiConfig);
}

function show(type, message) {
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.innerHTML = `
    <div style="font-weight: 700; margin-bottom: 4px;">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è'} ${type.charAt(0).toUpperCase() + type.slice(1)}</div>
    <div style="font-size: 14px; color: var(--text-secondary);">${message}</div>
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

/* ===== KEYBOARD SHORTCUTS ===== */
document.addEventListener('keydown', function(e) {
  if (e.ctrlKey || e.metaKey) {
    switch(e.key) {
      case 's':
        e.preventDefault();
        saveAll();
        show('success', 'Data saved');
        break;
      case 't':
        e.preventDefault();
        if (subjects.length > 0) openTimer(subjects[0].id);
        break;
    }
  }
});

console.log('üéì Academic Hub Pro Loaded Successfully!');
</script>
</body>
</html>

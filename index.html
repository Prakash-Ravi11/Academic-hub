<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#1a1b23">
  <meta name="description" content="Academic Hub Dashboard - Advanced Learning Platform">
  <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiQWNhZGVtaWMgSHViIiwiZmF2aWNvbiI6Ii9mYXZpY29uLmljbyIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5IjoiU3RhbmRhbG9uZSIsIm9yaWVudGF0aW9uIjoiYW55IiwiaWNvbnMiOlt7InNyYy\":\"/favicon.ico","sizes":"192x192","type":"image/png"}]}">
  <title>Academic Hub Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
  <script src="https://unpkg.com/wasm_exec.js"></script>
  <style>
    :root {
      --primary-start: #667eea;
      --primary-end: #764ba2;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --glass-bg: rgba(26, 27, 35, 0.8);
      --glass-bg-light: rgba(243, 244, 246, 0.85);
      --text: #ffffff;
      --text-light: #1a1b23;
      --bg: #1a1b23;
      --bg-light: #f3f4f6;
      --card-bg: rgba(45, 46, 54, 0.9);
      --card-bg-light: rgba(255, 255, 255, 0.9);
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      --border: rgba(255, 255, 255, 0.1);
    }

    [data-theme="light"] {
      --text: var(--text-light);
      --bg: var(--bg-light);
      --card-bg: var(--card-bg-light);
      --glass-bg: var(--glass-bg-light);
      --border: rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
    }

    body {
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s ease, color 0.3s ease;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
    }

    .container {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
      padding: 20px;
      position: fixed;
      height: 100%;
      transform: translateX(0);
      transition: transform 0.3s ease-in-out;
      z-index: 30;
      box-shadow: var(--shadow);
    }

    .sidebar h1 {
      color: white;
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 20px;
      text-align: center;
      background: linear-gradient(135deg, #ffffff, #e0e0e0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .search-input {
      width: 100%;
      padding: 10px 12px 10px 36px;
      border: none;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1) url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" viewBox="0 0 16 16"%3E%3Cpath d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"%3E%3C/path%3E%3C/svg%3E') no-repeat 12px center;
      color: white;
      font-size: 0.9rem;
      transition: background 0.3s ease;
      outline: none;
    }

    .search-input:focus {
      background-color: rgba(255, 255, 255, 0.2);
    }

    .nav-item {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      color: rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      margin: 5px 0;
      transition: all 0.2s ease;
      cursor: pointer;
      font-weight: 500;
      position: relative;
    }

    .nav-item:hover, .nav-item.active {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      transform: translateX(5px);
    }

    .nav-item.active::before {
      content: '•';
      margin-right: 8px;
      color: var(--success);
    }

    /* Main Content */
    .main-content {
      margin-left: 280px;
      width: calc(100% - 280px);
      padding: 20px;
      overflow-y: auto;
      transition: margin-left 0.3s ease-in-out;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      padding: 12px 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      position: sticky;
      top: 0;
      z-index: 20;
      box-shadow: var(--shadow);
    }

    .clock {
      font-size: 1.1rem;
      font-weight: 500;
    }

    .theme-toggle {
      background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
      border: none;
      padding: 8px 15px;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: transform 0.2s ease, background 0.3s ease;
    }

    .theme-toggle:hover {
      transform: scale(1.05);
      background: linear-gradient(135deg, #5a6ee9, #6a439b);
    }

    /* Subject Cards */
    .subjects-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .subject-card {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 15px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid var(--border);
      position: relative;
      overflow: hidden;
    }

    .subject-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
    }

    .subject-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
      z-index: 0;
      transition: transform 0.6s ease;
    }

    .subject-card:hover::before {
      transform: translate(20%, 20%);
    }

    .subject-icon {
      font-size: 1.8rem;
      background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-right: 10px;
    }

    .progress-bar {
      height: 6px;
      background: var(--border);
      border-radius: 3px;
      overflow: hidden;
      margin: 10px 0;
    }

    .progress {
      height: 100%;
      background: var(--success);
      transition: width 0.3s ease;
    }

    .file-upload-area {
      border: 2px dashed var(--border);
      padding: 10px;
      text-align: center;
      border-radius: 6px;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.6);
    }

    .file-upload-area.dragover {
      border-color: var(--primary-start);
      background: rgba(102, 126, 234, 0.15);
      color: white;
    }

    .card-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 15px;
    }

    .btn {
      padding: 8px 12px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: 500;
      transition: transform 0.2s ease, background 0.3s ease;
      min-width: 80px;
      text-align: center;
    }

    .btn:hover {
      transform: scale(1.05);
    }

    .btn-primary { background: var(--primary-start); color: white; }
    .btn-primary:hover { background: var(--primary-end); }
    .btn-success { background: var(--success); color: white; }
    .btn-success:hover { background: #0e9b6e; }
    .btn-danger { background: var(--danger); color: white; }
    .btn-danger:hover { background: #dc2626; }
    .btn-menu { background: var(--border); color: rgba(255, 255, 255, 0.8); }
    .btn-menu:hover { background: rgba(255, 255, 255, 0.2); }

    /* Modals */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 40;
      transition: opacity 0.3s ease;
    }

    .modal-content {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }

    .modal.show .modal-content {
      transform: scale(1);
    }

    .modal-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    /* Charts and Analytics */
    .chart-container {
      background: var(--card-bg);
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
    }

    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .kpi-card {
      background: var(--glass-bg);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      transition: transform 0.3s ease;
    }

    .kpi-card:hover {
      transform: translateY(-3px);
    }

    .heatmap {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
      margin-top: 10px;
    }

    .heatmap-day {
      width: 20px;
      height: 20px;
      background: var(--border);
      border-radius: 4px;
      transition: background 0.3s ease;
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      background: var(--success);
      color: white;
      border-radius: 4px;
      font-size: 0.8rem;
      margin: 2px;
      animation: bounce 0.5s ease;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    /* Canvas Panel */
    .canvas-panel {
      position: fixed;
      right: 20px;
      top: 20px;
      width: 300px;
      height: 400px;
      background: var(--card-bg);
      border-radius: 12px;
      padding: 15px;
      box-shadow: var(--shadow);
      z-index: 50;
      display: none;
      flex-direction: column;
    }

    .canvas-panel.show {
      display: flex;
    }

    #canvasOutput {
      width: 100%;
      height: 250px;
      background: #000;
    }

    #codeInput {
      width: 100%;
      height: 100px;
      margin-top: 10px;
      padding: 5px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.1);
      color: var(--text);
      resize: none;
    }

    /* Notifications */
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--success);
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      box-shadow: var(--shadow);
      display: none;
      z-index: 60;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-280px);
      }
      .sidebar.open {
        transform: translateX(0);
      }
      .main-content {
        margin-left: 0;
        width: 100%;
        padding: 10px;
      }
      .hamburger {
        display: block;
        font-size: 1.5rem;
        cursor: pointer;
        position: absolute;
        top: 15px;
        left: 15px;
        z-index: 50;
        color: white;
        transition: color 0.3s ease;
      }
      .hamburger:hover {
        color: var(--primary-start);
      }
      .subjects-grid {
        grid-template-columns: 1fr;
      }
      .kpi-grid {
        grid-template-columns: 1fr;
      }
      .canvas-panel {
        width: 90%;
        right: 5%;
        top: 10px;
      }
      .notification {
        right: 10px;
        bottom: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar" id="sidebar">
      <h1>🎓 Academic Hub</h1>
      <input type="text" class="search-input" placeholder="🔍 Search Subjects..." id="searchInput">
      <div class="nav-items" id="navItems">
        <div class="nav-item" data-section="dashboard">Dashboard</div>
        <div class="nav-item" data-section="ai-tools">AI Tools</div>
        <div class="nav-item" data-section="study-tools">Study Tools</div>
        <div class="nav-item" data-section="account">Account</div>
        <div class="nav-item" data-section="tools">Advanced Tools</div>
      </div>
    </div>

    <div class="main-content">
      <div class="top-bar">
        <div class="hamburger">☰</div>
        <span class="clock" id="clock">06:18 PM</span>
        <button class="theme-toggle" id="themeToggle">Toggle Theme</button>
      </div>

      <div id="contentArea">
        <!-- Dashboard -->
        <div class="subjects-grid" id="dashboard">
          <div class="subject-card" data-subject="math">
            <div class="flex items-center mb-2 relative z-10">
              <span class="subject-icon">📐</span>
              <h3 class="ml-2">Mathematics (Transforms & BVP)</h3>
            </div>
            <p class="text-sm text-gray-400 relative z-10">Code: MA101 | Faculty: Dr. Smith | Credits: 4</p>
            <div class="progress-bar relative z-10">
              <div class="progress" id="mathProgress" style="width: 75%"></div>
            </div>
            <p class="text-sm text-gray-400 relative z-10">Progress: 75% | Time: 12h 30m</p>
            <div class="file-upload-area relative z-10" data-subject="math">Drop files here or click to upload</div>
            <div class="card-actions relative z-10">
              <button class="btn btn-primary">Materials</button>
              <button class="btn btn-success" onclick="openTimer('math')">Study Now</button>
              <div class="btn btn-menu" onclick="toggleMenu(this)">⋮</div>
              <div class="menu-options" style="display: none;">
                <button class="btn btn-primary w-full mb-1">Rename</button>
                <button class="btn btn-danger w-full">Delete</button>
              </div>
            </div>
          </div>
          <!-- Other subject cards remain the same as previous version -->
          <div class="subject-card" data-subject="dsa">
            <div class="flex items-center mb-2 relative z-10">
              <span class="subject-icon">🌳</span>
              <h3 class="ml-2">Data Structures & Algorithms</h3>
            </div>
            <p class="text-sm text-gray-400 relative z-10">Code: CS201 | Faculty: Dr. Jones | Credits: 4</p>
            <div class="progress-bar relative z-10">
              <div class="progress" id="dsaProgress" style="width: 60%"></div>
            </div>
            <p class="text-sm text-gray-400 relative z-10">Progress: 60% | Time: 10h 15m</p>
            <div class="file-upload-area relative z-10" data-subject="dsa">Drop files here or click to upload</div>
            <div class="card-actions relative z-10">
              <button class="btn btn-primary">Materials</button>
              <button class="btn btn-success" onclick="openTimer('dsa')">Study Now</button>
              <div class="btn btn-menu" onclick="toggleMenu(this)">⋮</div>
              <div class="menu-options" style="display: none;">
                <button class="btn btn-primary w-full mb-1">Rename</button>
                <button class="btn btn-danger w-full">Delete</button>
              </div>
            </div>
          </div>
          <div class="subject-card" data-subject="coa">
            <div class="flex items-center mb-2 relative z-10">
              <span class="subject-icon">🏗️</span>
              <h3 class="ml-2">Computer Organization</h3>
            </div>
            <p class="text-sm text-gray-400 relative z-10">Code: CS202 | Faculty: Dr. Brown | Credits: 3</p>
            <div class="progress-bar relative z-10">
              <div class="progress" id="coaProgress" style="width: 45%"></div>
            </div>
            <p class="text-sm text-gray-400 relative z-10">Progress: 45% | Time: 8h 45m</p>
            <div class="file-upload-area relative z-10" data-subject="coa">Drop files here or click to upload</div>
            <div class="card-actions relative z-10">
              <button class="btn btn-primary">Materials</button>
              <button class="btn btn-success" onclick="openTimer('coa')">Study Now</button>
              <div class="btn btn-menu" onclick="toggleMenu(this)">⋮</div>
              <div class="menu-options" style="display: none;">
                <button class="btn btn-primary w-full mb-1">Rename</button>
                <button class="btn btn-danger w-full">Delete</button>
              </div>
            </div>
          </div>
          <div class="subject-card" data-subject="prog">
            <div class="flex items-center mb-2 relative z-10">
              <span class="subject-icon">👨‍💻</span>
              <h3 class="ml-2">Advanced Programming</h3>
            </div>
            <p class="text-sm text-gray-400 relative z-10">Code: CS203 | Faculty: Dr. Davis | Credits: 4</p>
            <div class="progress-bar relative z-10">
              <div class="progress" id="progProgress" style="width: 80%"></div>
            </div>
            <p class="text-sm text-gray-400 relative z-10">Progress: 80% | Time: 14h 20m</p>
            <div class="file-upload-area relative z-10" data-subject="prog">Drop files here or click to upload</div>
            <div class="card-actions relative z-10">
              <button class="btn btn-primary">Materials</button>
              <button class="btn btn-success" onclick="openTimer('prog')">Study Now</button>
              <div class="btn btn-menu" onclick="toggleMenu(this)">⋮</div>
              <div class="menu-options" style="display: none;">
                <button class="btn btn-primary w-full mb-1">Rename</button>
                <button class="btn btn-danger w-full">Delete</button>
              </div>
            </div>
          </div>
          <div class="subject-card" data-subject="os">
            <div class="flex items-center mb-2 relative z-10">
              <span class="subject-icon">⚙️</span>
              <h3 class="ml-2">Operating Systems</h3>
            </div>
            <p class="text-sm text-gray-400 relative z-10">Code: CS204 | Faculty: Dr. Wilson | Credits: 3</p>
            <div class="progress-bar relative z-10">
              <div class="progress" id="osProgress" style="width: 55%"></div>
            </div>
            <p class="text-sm text-gray-400 relative z-10">Progress: 55% | Time: 9h 10m</p>
            <div class="file-upload-area relative z-10" data-subject="os">Drop files here or click to upload</div>
            <div class="card-actions relative z-10">
              <button class="btn btn-primary">Materials</button>
              <button class="btn btn-success" onclick="openTimer('os')">Study Now</button>
              <div class="btn btn-menu" onclick="toggleMenu(this)">⋮</div>
              <div class="menu-options" style="display: none;">
                <button class="btn btn-primary w-full mb-1">Rename</button>
                <button class="btn btn-danger w-full">Delete</button>
              </div>
            </div>
          </div>
          <div class="subject-card" data-subject="uhv">
            <div class="flex items-center mb-2 relative z-10">
              <span class="subject-icon">🧠</span>
              <h3 class="ml-2">Universal Human Values</h3>
            </div>
            <p class="text-sm text-gray-400 relative z-10">Code: HU101 | Faculty: Dr. Taylor | Credits: 2</p>
            <div class="progress-bar relative z-10">
              <div class="progress" id="uhvProgress" style="width: 70%"></div>
            </div>
            <p class="text-sm text-gray-400 relative z-10">Progress: 70% | Time: 11h 0m</p>
            <div class="file-upload-area relative z-10" data-subject="uhv">Drop files here or click to upload</div>
            <div class="card-actions relative z-10">
              <button class="btn btn-primary">Materials</button>
              <button class="btn btn-success" onclick="openTimer('uhv')">Study Now</button>
              <div class="btn btn-menu" onclick="toggleMenu(this)">⋮</div>
              <div class="menu-options" style="display: none;">
                <button class="btn btn-primary w-full mb-1">Rename</button>
                <button class="btn btn-danger w-full">Delete</button>
              </div>
            </div>
          </div>
        </div>

        <!-- AI Tools -->
        <div id="ai-tools" style="display: none;">
          <div class="bg-gray-800 p-4 rounded-lg mb-4">
            <h2 class="text-xl font-semibold mb-4">AI Chat</h2>
            <div class="h-64 overflow-y-auto bg-gray-700 p-4 rounded mb-2 space-y-2" id="chatMessages"></div>
            <div class="flex gap-2">
              <input type="text" id="chatInput" class="w-full p-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-primary-start" placeholder="Ask AI...">
              <button id="sendChatBtn" class="btn btn-primary">Send</button>
            </div>
          </div>
          <button class="btn btn-primary" id="apiKeyBtn">Set API Key</button>
          <div class="mt-4 p-4 bg-gray-800 rounded-lg">
            <h2 class="text-xl font-semibold mb-2">NotebookLLM</h2>
            <div class="file-upload-area" id="notebookUpload">Drop documents here or click to upload</div>
          </div>
        </div>

        <!-- Study Tools -->
        <div id="study-tools" style="display: none;">
          <div class="chart-container">
            <canvas id="weeklyChart" style="height: 200px;"></canvas>
          </div>
          <button class="btn btn-success mt-4" id="startTimerBtn">Start Study Timer</button>
          <div id="timerModal" class="modal">
            <div class="modal-content">
              <h2 class="text-xl font-semibold mb-4">Study Timer</h2>
              <div id="timerDisplay" class="text-4xl mb-4 text-center font-mono">00:00:00</div>
              <div class="flex justify-between gap-2">
                <button id="startBtn" class="btn btn-success flex-1">Start</button>
                <button id="pauseBtn" class="btn btn-warning flex-1" style="display: none;">Pause</button>
                <button id="stopBtn" class="btn btn-danger flex-1" style="display: none;">Stop</button>
                <button id="resetBtn" class="btn btn-menu flex-1">Reset</button>
              </div>
              <div id="sessionStats" class="mt-4 text-sm text-gray-400"></div>
              <svg class="w-32 h-32 mx-auto mt-4">
                <circle cx="50%" cy="50%" r="45" fill="none" stroke="#333" stroke-width="5"/>
                <circle id="progressRing" cx="50%" cy="50%" r="45" fill="none" stroke="var(--success)" stroke-width="5" stroke-dasharray="282.74" stroke-dashoffset="282.74"/>
              </svg>
            </div>
          </div>
        </div>

        <!-- Account -->
        <div id="account" style="display: none;">
          <p class="text-center">Account settings coming soon...</p>
        </div>

        <!-- Advanced Tools -->
        <div id="tools" style="display: none;">
          <div class="chart-container mb-4">
            <h2 class="text-xl font-semibold mb-2">Canvas Panel</h2>
            <button class="btn btn-primary mb-2" id="toggleCanvas">Toggle Canvas</button>
            <div class="canvas-panel" id="canvasPanel">
              <canvas id="canvasOutput"></canvas>
              <textarea id="codeInput" placeholder="Enter Python code (e.g., print('Hello'))"></textarea>
              <button class="btn btn-success mt-2" id="runCode">Run Code</button>
              <div id="codeOutput" class="mt-2 text-sm"></div>
            </div>
          </div>
          <div class="chart-container mb-4">
            <h2 class="text-xl font-semibold mb-2">Image Analysis</h2>
            <div class="file-upload-area" id="imageUpload">Drop image here or click to upload</div>
            <div id="imageAnalysis" class="mt-2 text-sm"></div>
          </div>
          <div class="chart-container mb-4">
            <h2 class="text-xl font-semibold mb-2">Web Search</h2>
            <input type="text" id="searchQuery" class="w-full p-2 mb-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-primary-start" placeholder="Search the web...">
            <button class="btn btn-primary" id="searchWeb">Search</button>
            <div id="webResults" class="mt-2 text-sm"></div>
          </div>
          <div class="chart-container">
            <h2 class="text-xl font-semibold mb-2">X Post Analysis</h2>
            <input type="text" id="xQuery" class="w-full p-2 mb-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-primary-start" placeholder="Enter X username or keyword...">
            <button class="btn btn-primary" id="analyzeX">Analyze</button>
            <div id="xAnalysis" class="mt-2 text-sm"></div>
          </div>
          <div class="chart-container mt-4">
            <h2 class="text-xl font-semibold mb-2">Progress Prediction</h2>
            <canvas id="predictionChart" style="height: 200px;"></canvas>
            <button class="btn btn-primary mt-2" id="predictProgress">Predict Progress</button>
          </div>
        </div>
      </div>

      <!-- Analytics Dashboard -->
      <div class="chart-container">
        <div class="kpi-grid">
          <div class="kpi-card">
            <span>📚</span>
            <p>Total Hours</p>
            <p class="text-2xl">45h 45m</p>
          </div>
          <div class="kpi-card">
            <span>🏆</span>
            <p>Streak</p>
            <p class="text-2xl">7 Days</p>
          </div>
          <div class="kpi-card">
            <span>📂</span>
            <p>Files</p>
            <p class="text-2xl">12</p>
          </div>
        </div>
        <canvas id="subjectChart" style="height: 200px;"></canvas>
        <canvas id="trendChart" style="height: 200px;"></canvas>
        <div class="heatmap" id="heatmap"></div>
        <div id="badges" class="mt-4">
          <span class="badge">Beginner</span>
          <span class="badge">Consistent</span>
        </div>
      </div>

      <!-- Notification Area -->
      <div id="notification" class="notification">New update available!</div>
    </div>
  </div>

  <script>
    (function () {
      'use strict';

      // State Management
      let state = JSON.parse(localStorage.getItem('academic-hub-state')) || {
        theme: 'dark',
        subjects: {
          math: { progress: 75, time: 45000 },
          dsa: { progress: 60, time: 36900 },
          coa: { progress: 45, time: 31500 },
          prog: { progress: 80, time: 51600 },
          os: { progress: 55, time: 33000 },
          uhv: { progress: 70, time: 39600 }
        },
        files: {},
        apiKey: '',
        heatmap: Array(30).fill(0),
        progressHistory: [50, 60, 70, 75, 80] // Sample historical data
      };
      let timer = null;
      let startTime = null;
      let pausedTime = 0;
      let currentSubject = null;
      let ws = null;

      // DOM Elements
      const themeToggle = document.getElementById('themeToggle');
      const clock = document.getElementById('clock');
      const sidebar = document.getElementById('sidebar');
      const navItems = document.querySelectorAll('.nav-item');
      const contentArea = document.getElementById('contentArea');
      const timerDisplay = document.getElementById('timerDisplay');
      const startTimerBtn = document.getElementById('startTimerBtn');
      const timerModal = document.getElementById('timerModal');
      const timerButtons = document.querySelectorAll('#timerModal button');
      const chatInput = document.getElementById('chatInput');
      const chatMessages = document.getElementById('chatMessages');
      const apiKeyBtn = document.getElementById('apiKeyBtn');
      const sendChatBtn = document.getElementById('sendChatBtn');
      const searchInput = document.getElementById('searchInput');
      const sessionStats = document.getElementById('sessionStats');
      const progressRing = document.getElementById('progressRing');
      const notebookUpload = document.getElementById('notebookUpload');
      const heatmap = document.getElementById('heatmap');
      const badges = document.getElementById('badges');
      const toggleCanvas = document.getElementById('toggleCanvas');
      const canvasPanel = document.getElementById('canvasPanel');
      const canvasOutput = document.getElementById('canvasOutput');
      const codeInput = document.getElementById('codeInput');
      const runCode = document.getElementById('runCode');
      const codeOutput = document.getElementById('codeOutput');
      const imageUpload = document.getElementById('imageUpload');
      const imageAnalysis = document.getElementById('imageAnalysis');
      const searchQuery = document.getElementById('searchQuery');
      const searchWeb = document.getElementById('searchWeb');
      const webResults = document.getElementById('webResults');
      const xQuery = document.getElementById('xQuery');
      const analyzeX = document.getElementById('analyzeX');
      const xAnalysis = document.getElementById('xAnalysis');
      const predictProgress = document.getElementById('predictProgress');
      const predictionChart = document.getElementById('predictionChart');
      const notification = document.getElementById('notification');

      // WebAssembly Setup
      async function initWasm() {
        if (!WebAssembly.instantiate) return;
        const go = new Go();
        const wasm = await WebAssembly.instantiateStreaming(fetch('https://unpkg.com/wasm_exec.js'), go.importObject);
        go.run(wasm.instance);
        window.calcProgress = (progress) => {
          return wasm.instance.exports.calcProgress(progress); // Hypothetical Wasm function
        };
      }

      // Service Worker Registration
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register(new Blob(['self.addEventListener("install", e => e.waitUntil(caches.open("academic-hub-cache").then(cache => cache.addAll(["/", "/index.html", "/styles.css", "/script.js"]))));self.addEventListener("fetch", e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))));'], { type: 'application/javascript' })).then(() => console.log('Service Worker registered')).catch(err => console.error('Service Worker error:', err));
      }

      // WebSocket Setup
      function initWebSocket() {
        ws = new WebSocket('wss://echo.websocket.org'); // Mock server
        ws.onopen = () => console.log('WebSocket connected');
        ws.onmessage = (e) => {
          const data = JSON.parse(e.data);
          if (data.type === 'notification') {
            showNotification(data.message);
          }
        };
        ws.onerror = (e) => console.error('WebSocket error:', e);
        ws.onclose = () => console.log('WebSocket closed');
      }

      // Initialize
      async function init() {
        await initWasm();
        initWebSocket();

        // Theme Toggle
        if (themeToggle) {
          themeToggle.addEventListener('click', () => {
            state.theme = state.theme === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', state.theme);
            saveState();
          });
        }
        document.body.setAttribute('data-theme', state.theme);

        // Real-time Clock
        function updateClock() {
          if (clock) {
            const now = new Date();
            clock.textContent = now.toLocaleTimeString('en-IN', { hour12: true, timeZone: 'Asia/Kolkata' });
          }
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Navigation
        if (navItems.length > 0) {
          navItems.forEach(item => {
            item.addEventListener('click', () => {
              navItems.forEach(i => i.classList.remove('active'));
              item.classList.add('active');
              if (contentArea) {
                contentArea.querySelectorAll('div').forEach(div => div.style.display = 'none');
                document.getElementById(item.dataset.section).style.display = 'block';
              }
            });
          });
          navItems[0].click(); // Default to dashboard
        }

        // Study Timer
        if (startTimerBtn && timerModal && timerButtons.length > 0) {
          startTimerBtn.addEventListener('click', () => openTimer());
          timerButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
              const action = e.target.id.replace('Btn', '');
              if (action === 'start') {
                startTime = Date.now() - pausedTime;
                timer = setInterval(updateTimer, 1000);
                toggleTimerButtons('running');
              } else if (action === 'pause') {
                clearInterval(timer);
                timer = null;
                pausedTime = Date.now() - startTime;
                toggleTimerButtons('paused');
              } else if (action === 'stop') {
                const sessionTime = timer ? (Date.now() - startTime) / 1000 : pausedTime / 1000;
                if (currentSubject && state.subjects[currentSubject]) {
                  state.subjects[currentSubject].time += sessionTime;
                  state.heatmap[Math.floor(Math.random() * 30)] += sessionTime / 3600;
                  updateProgress(currentSubject, state.subjects[currentSubject].progress + (sessionTime / 3600) * 5); // Simplified
                  updateBadges();
                  saveState();
                }
                clearInterval(timer);
                timer = null;
                pausedTime = 0;
                updateTimer();
                updateProgressRing(0);
                toggleTimerButtons('stopped');
                timerModal.classList.remove('show');
                sessionStats.textContent = `Session: ${Math.floor(sessionTime / 3600)}h ${Math.floor((sessionTime % 3600) / 60)}m ${Math.floor(sessionTime % 60)}s`;
              } else if (action === 'reset') {
                clearInterval(timer);
                timer = null;
                startTime = null;
                pausedTime = 0;
                updateTimer();
                updateProgressRing(0);
                toggleTimerButtons('stopped');
              }
            });
          });
        }

        function updateTimer() {
          if (timerDisplay && startTime) {
            const elapsed = (timer ? Date.now() : startTime + pausedTime) - startTime;
            const totalSeconds = Math.floor(elapsed / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            timerDisplay.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            updateProgressRing(totalSeconds / (4 * 3600) * 100);
          }
        }

        function updateProgress(subject, progress) {
          if (state.subjects[subject]) {
            state.subjects[subject].progress = Math.min(100, progress);
            document.getElementById(`${subject}Progress`).style.width = `${state.subjects[subject].progress}%`;
            saveState();
            if (window.calcProgress) {
              const wasmProgress = window.calcProgress(progress); // Wasm optimization
              console.log('Wasm calculated progress:', wasmProgress);
            }
          }
        }

        function updateProgressRing(percentage) {
          if (progressRing) {
            const circumference = 2 * Math.PI * 45;
            const offset = circumference - (percentage / 100) * circumference;
            progressRing.style.strokeDashoffset = offset;
          }
        }

        function toggleTimerButtons(state) {
          const [startBtn, pauseBtn, stopBtn, resetBtn] = timerButtons;
          if (startBtn && pauseBtn && stopBtn && resetBtn) {
            startBtn.style.display = state === 'running' ? 'none' : 'block';
            pauseBtn.style.display = state === 'running' ? 'block' : 'none';
            stopBtn.style.display = state !== 'stopped' ? 'block' : 'none';
            resetBtn.style.display = state === 'stopped' ? 'block' : 'none';
          }
        }

        function openTimer(subject) {
          currentSubject = subject || currentSubject;
          timerModal.classList.add('show');
          updateTimer();
          updateProgressRing(0);
          sessionStats.textContent = '';
        }

        // File Upload
        document.querySelectorAll('.file-upload-area').forEach(area => {
          area.addEventListener('dragover', (e) => {
            e.preventDefault();
            area.classList.add('dragover');
          });
          area.addEventListener('dragleave', (e) => {
            e.preventDefault();
            area.classList.remove('dragover');
          });
          area.addEventListener('drop', (e) => {
            e.preventDefault();
            area.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            handleFileUpload(area.dataset.subject || 'notebook', files);
          });
          area.addEventListener('click', () => {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.accept = '.pdf,.doc,.docx,.ppt,.txt,.jpg,.png';
            input.onchange = (e) => handleFileUpload(area.dataset.subject || 'notebook', Array.from(e.target.files));
            input.click();
          });
        });

        function handleFileUpload(subject, files) {
          const uploadProgress = document.createElement('div');
          uploadProgress.className = 'progress-bar mt-2';
          uploadProgress.innerHTML = '<div class="progress" style="width: 0;"></div>';
          const parent = subject === 'notebook' ? notebookUpload.parentElement : document.querySelector(`.subject-card[data-subject="${subject}"] .card-actions`);
          parent.appendChild(uploadProgress);

          files.forEach((file, index) => {
            if (file.size > 10 * 1024 * 1024) {
              alert(`File ${file.name} exceeds 10MB limit`);
              return;
            }
            const reader = new FileReader();
            reader.onprogress = (e) => {
              if (e.lengthComputable) {
                const progress = (e.loaded / e.total) * 100;
                uploadProgress.querySelector('.progress').style.width = `${progress}%`;
              }
            };
            reader.onload = (e) => {
              if (!state.files[subject]) state.files[subject] = [];
              state.files[subject].push({
                name: file.name,
                size: file.size,
                type: file.type,
                data: e.target.result,
                uploadedAt: new Date().toISOString()
              });
              if (index === files.length - 1) {
                parent.removeChild(uploadProgress);
                saveState();
                alert(`Uploaded ${files.length} file(s) successfully!`);
              }
            };
            reader.readAsDataURL(file);
          });
        }

        // Download/Delete Files
        document.querySelectorAll('.file-upload-area').forEach(area => {
          area.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            const subject = area.dataset.subject || 'notebook';
            if (state.files[subject] && state.files[subject].length > 0) {
              const modal = document.createElement('div');
              modal.className = 'modal';
              modal.innerHTML = `
                <div class="modal-content">
                  <h3 class="text-lg font-semibold mb-2">Manage Files</h3>
                  <ul class="mb-2">
                    ${state.files[subject].map((file, i) => `
                      <li class="flex justify-between items-center py-1">
                        <span>${file.name} (${(file.size / 1024).toFixed(2)}KB)</span>
                        <div>
                          <button class="btn btn-primary btn-sm mr-1" onclick="downloadFile('${subject}', ${i})">Download</button>
                          <button class="btn btn-danger btn-sm" onclick="deleteFile('${subject}', ${i})">Delete</button>
                        </div>
                      </li>
                    `).join('')}
                  </ul>
                  <button class="btn btn-primary w-full">Close</button>
                </div>
              `;
              document.body.appendChild(modal);
              modal.classList.add('show');
              modal.querySelector('button').addEventListener('click', () => {
                modal.classList.remove('show');
                setTimeout(() => modal.remove(), 300);
              });
              modal.addEventListener('click', (e) => e.target === modal && (modal.classList.remove('show'), setTimeout(() => modal.remove(), 300)));
              document.addEventListener('keydown', (e) => e.key === 'Escape' && (modal.classList.remove('show'), setTimeout(() => modal.remove(), 300)), { once: true });
            }
          });
        });

        window.downloadFile = (subject, index) => {
          const file = state.files[subject][index];
          const link = document.createElement('a');
          link.href = file.data;
          link.download = file.name;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        };

        window.deleteFile = (subject, index) => {
          if (confirm(`Delete ${state.files[subject][index].name}?`)) {
            state.files[subject].splice(index, 1);
            saveState();
            document.querySelector('.modal.show')?.classList.remove('show');
            setTimeout(() => document.querySelector('.modal.show')?.remove(), 300);
          }
        };

        // Charts
        if (window.Chart) {
          new Chart(document.getElementById('weeklyChart'), {
            type: 'line',
            data: {
              labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
              datasets: [{
                label: 'Study Hours',
                data: [2, 4, 3, 5, 6, 4, 7],
                borderColor: 'var(--primary-start)',
                fill: false,
                tension: 0.4
              }]
            },
            options: { responsive: true, maintainAspectRatio: false }
          });
          new Chart(document.getElementById('subjectChart'), {
            type: 'doughnut',
            data: {
              labels: Object.keys(state.subjects),
              datasets: [{
                data: Object.values(state.subjects).map(s => s.progress),
                backgroundColor: ['var(--primary-start)', 'var(--success)', 'var(--warning)', 'var(--danger)', '#10b981', '#f59e0b'],
                borderWidth: 0
              }]
            },
            options: { responsive: true, maintainAspectRatio: false }
          });
          new Chart(document.getElementById('trendChart'), {
            type: 'bar',
            data: {
              labels: ['Week 1', 'Week 2', 'Week 3'],
              datasets: [{
                label: 'Progress',
                data: [50, 65, 75],
                backgroundColor: 'var(--primary-start)'
              }]
            },
            options: { responsive: true, maintainAspectRatio: false }
          });
        }

        // Heatmap
        if (heatmap) {
          const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
          const now = new Date();
          for (let i = 29; i >= 0; i--) {
            const date = new Date(now);
            date.setDate(now.getDate() - i);
            const dayIndex = date.getDay();
            const heat = state.heatmap[29 - i] || 0;
            const color = heat > 5 ? '#10b981' : heat > 2 ? '#f59e0b' : '#ef4444';
            heatmap.innerHTML += `<div class="heatmap-day" title="${days[dayIndex]}, ${date.toLocaleDateString()}: ${heat}h" style="background: ${heat > 0 ? color : var(--border)}"></div>`;
          }
        }

        // Badges
        function updateBadges() {
          if (badges) {
            badges.innerHTML = '';
            const totalHours = Object.values(state.subjects).reduce((sum, s) => sum + s.time / 3600, 0);
            if (totalHours > 50) badges.innerHTML += '<span class="badge">Advanced</span>';
            if (totalHours > 20) badges.innerHTML += '<span class="badge">Intermediate</span>';
            if (totalHours > 5) badges.innerHTML += '<span class="badge">Beginner</span>';
            if (state.heatmap.filter(h => h > 0).length >= 7) badges.innerHTML += '<span class="badge">Consistent</span>';
          }
        }
        updateBadges();

        // AI Chat
        if (chatInput && chatMessages && sendChatBtn) {
          const sendMessage = () => {
            const message = chatInput.value.trim();
            if (message) {
              chatMessages.innerHTML += `<div class="bg-blue-600 p-2 rounded-lg ml-auto max-w-[70%]">${message}</div>`;
              chatInput.value = '';
              chatMessages.scrollTop = chatMessages.scrollHeight;
              sendChatBtn.disabled = true;
              setTimeout(() => {
                const response = message.toLowerCase().includes('math') ? 'Let’s solve x² - 4 = 0!' : 'How can I help you?';
                chatMessages.innerHTML += `<div class="bg-gray-600 p-2 rounded-lg max-w-[70%]">${response}</div>`;
                chatMessages.scrollTop = chatMessages.scrollHeight;
                sendChatBtn.disabled = false;
              }, 1000);
            }
          };
          chatInput.addEventListener('keypress', (e) => e.key === 'Enter' && sendMessage());
          sendChatBtn.addEventListener('click', sendMessage);
        }

        // API Key Modal
        if (apiKeyBtn) {
          apiKeyBtn.addEventListener('click', () => {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
              <div class="modal-content">
                <h3 class="text-lg font-semibold mb-2">Set API Key</h3>
                <input type="text" placeholder="Enter OpenRouter API Key" class="w-full p-2 mb-2 bg-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-primary-start" value="${state.apiKey}">
                <button class="btn btn-primary w-full">Save</button>
              </div>
            `;
            document.body.appendChild(modal);
            modal.classList.add('show');
            modal.querySelector('button').addEventListener('click', () => {
              state.apiKey = modal.querySelector('input').value;
              saveState();
              modal.classList.remove('show');
              setTimeout(() => modal.remove(), 300);
            });
            modal.addEventListener('click', (e) => e.target === modal && (modal.classList.remove('show'), setTimeout(() => modal.remove(), 300)));
            document.addEventListener('keydown', (e) => e.key === 'Escape' && (modal.classList.remove('show'), setTimeout(() => modal.remove(), 300)), { once: true });
          });
        }

        // Search
        if (searchInput) {
          searchInput.addEventListener('input', () => {
            const query = searchInput.value.toLowerCase();
            document.querySelectorAll('.subject-card').forEach(card => {
              const title = card.querySelector('h3').textContent.toLowerCase();
              card.style.display = title.includes(query) ? 'block' : 'none';
            });
          });
        }

        // Menu Toggle
        window.toggleMenu = (btn) => {
          const options = btn.nextElementSibling;
          options.style.display = options.style.display === 'block' ? 'none' : 'block';
          document.addEventListener('click', (e) => {
            if (!btn.contains(e.target) && !options.contains(e.target)) options.style.display = 'none';
          }, { once: true });
        };

        // Mobile Menu
        const hamburger = document.querySelector('.hamburger');
        if (hamburger && sidebar) {
          hamburger.addEventListener('click', () => {
            sidebar.classList.toggle('open');
            document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : 'auto';
          });
        }

        // Modal Close on Escape
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && timerModal.classList.contains('show')) {
            timerModal.classList.remove('show');
            clearInterval(timer);
            timer = null;
            startTime = null;
            pausedTime = 0;
            updateTimer();
            toggleTimerButtons('stopped');
          }
        });

        // Canvas Panel
        if (toggleCanvas && canvasPanel) {
          toggleCanvas.addEventListener('click', () => {
            canvasPanel.classList.toggle('show');
            if (canvasPanel.classList.contains('show')) {
              const ctx = canvasOutput.getContext('2d');
              ctx.clearRect(0, 0, canvasOutput.width, canvasOutput.height);
              ctx.beginPath();
              ctx.arc(150, 125, 50, 0, Math.PI * 2);
              ctx.fillStyle = 'var(--primary-start)';
              ctx.fill();
              ctx.closePath();
            }
          });
          runCode.addEventListener('click', async () => {
            codeOutput.textContent = 'Loading...';
            try {
              await loadPyodide();
              const pyodide = await window.pyodide;
              const output = pyodide.runPython(codeInput.value);
              codeOutput.textContent = output || 'No output';
            } catch (e) {
              codeOutput.textContent = `Error: ${e.message}`;
            }
          });
        }

        // Image Analysis
        if (imageUpload) {
          imageUpload.addEventListener('click', () => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = (e) => {
              const file = e.target.files[0];
              if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                  const img = new Image();
                  img.src = e.target.result;
                  img.onload = () => {
                    const ctx = document.createElement('canvas').getContext('2d');
                    ctx.canvas.width = img.width;
                    ctx.canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    const data = ctx.getImageData(0, 0, img.width, img.height).data;
                    let text = 'Text detection: ';
                    for (let i = 0; i < data.length; i += 4) {
                      if (data[i] > 200 && data[i + 1] > 200 && data[i + 2] > 200) text += 'Light ';
                      else text += 'Dark ';
                    }
                    imageAnalysis.textContent = `${text} (Simplified analysis)`;
                  };
                };
                reader.readAsDataURL(file);
              }
            };
            input.click();
          });
          imageUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            imageUpload.classList.add('dragover');
          });
          imageUpload.addEventListener('dragleave', (e) => {
            e.preventDefault();
            imageUpload.classList.remove('dragover');
          });
          imageUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            imageUpload.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (e) => {
                const img = new Image();
                img.src = e.target.result;
                img.onload = () => {
                  const ctx = document.createElement('canvas').getContext('2d');
                  ctx.canvas.width = img.width;
                  ctx.canvas.height = img.height;
                  ctx.drawImage(img, 0, 0);
                  const data = ctx.getImageData(0, 0, img.width, img.height).data;
                  let text = 'Text detection: ';
                  for (let i = 0; i < data.length; i += 4) {
                    if (data[i] > 200 && data[i + 1] > 200 && data[i + 2] > 200) text += 'Light ';
                    else text += 'Dark ';
                  }
                  imageAnalysis.textContent = `${text} (Simplified analysis)`;
                };
              };
              reader.readAsDataURL(file);
            }
          });
        }

        // Web Search
        if (searchWeb && searchQuery) {
          searchWeb.addEventListener('click', () => {
            const query = searchQuery.value.trim();
            if (query) {
              webResults.textContent = 'Searching...';
              setTimeout(() => {
                webResults.innerHTML = `
                  <p><strong>Results for "${query}":</strong></p>
                  <p>1. Sample result: Academic resources - <a href="#">link1.com</a></p>
                  <p>2. Study tips: <a href="#">link2.com</a></p>
                `;
              }, 1000);
            }
          });
        }

        // X Post Analysis
        if (analyzeX && xQuery) {
          analyzeX.addEventListener('click', () => {
            const query = xQuery.value.trim();
            if (query) {
              xAnalysis.textContent = 'Analyzing...';
              setTimeout(() => {
                xAnalysis.innerHTML = `
                  <p><strong>Analysis for "${query}":</strong></p>
                  <p>Sample post: "Learning is fun! #education" - Sentiment: Positive</p>
                  <p>Engagement: 50 likes, 10 retweets</p>
                `;
              }, 1000);
            }
          });
        }

        // Progress Prediction with TensorFlow.js
        if (predictProgress && predictionChart) {
          predictProgress.addEventListener('click', async () => {
            const model = tf.sequential();
            model.add(tf.layers.dense({ units: 1, inputShape: [1] }));
            model.compile({ loss: 'meanSquaredError', optimizer: 'sgd' });
            const xs = tf.tensor2d(state.progressHistory.map((v, i) => [i]), [state.progressHistory.length, 1]);
            const ys = tf.tensor2d(state.progressHistory, [state.progressHistory.length, 1]);
            await model.fit(xs, ys, { epochs: 100 });
            const futurePredictions = [];
            for (let i = state.progressHistory.length; i < state.progressHistory.length + 3; i++) {
              const pred = model.predict(tf.tensor2d([[i]], [1, 1]));
              futurePredictions.push(pred.dataSync()[0]);
            }
            new Chart(predictionChart, {
              type: 'line',
              data: {
                labels: [...Array(state.progressHistory.length).keys(), ...Array(3).keys()].map(i => `Week ${i + 1}`),
                datasets: [{
                  label: 'Progress Trend',
                  data: [...state.progressHistory, ...futurePredictions],
                  borderColor: 'var(--primary-start)',
                  fill: false,
                  tension: 0.4
                }]
              },
              options: { responsive: true, maintainAspectRatio: false }
            });
          });
        }

        // PWA Install Prompt
        if ('BeforeInstallPromptEvent' in window) {
          window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            const installBtn = document.createElement('button');
            installBtn.textContent = 'Install App';
            installBtn.className = 'btn btn-primary fixed bottom-20 right-20';
            document.body.appendChild(installBtn);
            installBtn.addEventListener('click', () => {
              e.prompt();
              installBtn.remove();
            });
          });
        }

        // Notifications
        function showNotification(message) {
          if (notification) {
            notification.textContent = message;
            notification.style.display = 'block';
            setTimeout(() => notification.style.display = 'none', 3000);
          }
        }
        setInterval(() => ws?.send(JSON.stringify({ type: 'ping' })), 5000); // Mock notification trigger
      }

      // Save State
      function saveState() {
        try {
          localStorage.setItem('academic-hub-state', JSON.stringify(state));
        } catch (e) {
          console.error('Save error:', e);
          alert('Failed to save state. Check console for details.');
        }
      }

      // Error Handling
      window.addEventListener('error', (e) => {
        console.error('JavaScript Error:', e.message);
        alert('An error occurred. Check the console for details.');
      });

      // Initialize on DOM Load
      document.addEventListener('DOMContentLoaded', init);
    })();
  </script>
</body>
</html>

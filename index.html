<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Hub - AI-Powered Learning Platform</title>
    <meta name="description" content="Complete academic platform with AI tutoring, voice commands, study tools, and intelligent assistance">
    <meta name="theme-color" content="#6366f1">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <!-- External Resources -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    
    <style>
        :root {
            /* Academic Theme Variables */
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --accent-color: #06d6a0;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --success-color: #10b981;
            
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-secondary: rgba(255, 255, 255, 0.95);
            --bg-tertiary: rgba(248, 250, 252, 0.9);
            --bg-card: rgba(255, 255, 255, 0.9);
            
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-accent: #6366f1;
            
            --border-color: rgba(0, 0, 0, 0.1);
            --shadow-primary: 0 10px 25px rgba(0, 0, 0, 0.1);
            --shadow-secondary: 0 4px 15px rgba(0, 0, 0, 0.08);
            
            --academic-gradient: linear-gradient(135deg, #6366f1, #8b5cf6);
        }

        [data-theme="dark"] {
            --bg-primary: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            --bg-secondary: rgba(17, 24, 39, 0.95);
            --bg-tertiary: rgba(31, 41, 55, 0.9);
            --bg-card: rgba(17, 24, 39, 0.9);
            
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-accent: #a78bfa;
            
            --border-color: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header Styles */
        .header {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow-secondary);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text-primary);
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--academic-gradient);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Voice Control Panel */
        .voice-panel {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 2rem auto;
            max-width: 1400px;
            box-shadow: var(--shadow-secondary);
            border: 1px solid var(--border-color);
        }

        .voice-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .voice-btn {
            width: 80px;
            height: 80px;
            border: none;
            border-radius: 50%;
            background: var(--academic-gradient);
            color: white;
            cursor: pointer;
            font-size: 2rem;
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
            transition: all 0.3s ease;
            position: relative;
        }

        .voice-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(99, 102, 241, 0.4);
        }

        .voice-btn.listening {
            background: var(--danger-color);
            animation: pulse 2s infinite;
        }

        .voice-status {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            text-align: center;
        }

        .voice-commands {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .command-card {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .command-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .command-example {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Main Content Area */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
        }

        .content-area {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Card Styles */
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--shadow-secondary);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-primary);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-subtitle {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        /* AI Tutor Interface */
        .ai-tutor {
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
        }

        .message {
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 16px;
            max-width: 85%;
            word-wrap: break-word;
        }

        .message.user {
            background: var(--academic-gradient);
            color: white;
            margin-left: auto;
            text-align: right;
        }

        .message.ai {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .chat-input-container {
            display: flex;
            gap: 0.75rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 1rem;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Study Tools */
        .study-tools {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .tool-card {
            background: var(--bg-tertiary);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .tool-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-secondary);
            border-color: var(--primary-color);
        }

        .tool-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .tool-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .tool-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Calculator Interface */
        .calculator {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .calc-display {
            background: var(--bg-card);
            padding: 1rem;
            border-radius: 8px;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: right;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .calc-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }

        .calc-btn {
            padding: 1rem;
            border: none;
            border-radius: 8px;
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .calc-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .calc-btn.operator {
            background: var(--primary-color);
            color: white;
        }

        /* Study Progress */
        .progress-card {
            text-align: center;
        }

        .progress-circle {
            width: 120px;
            height: 120px;
            margin: 0 auto 1rem;
            position: relative;
        }

        .progress-circle svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-circle circle {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
        }

        .progress-bg {
            stroke: var(--border-color);
        }

        .progress-bar {
            stroke: var(--primary-color);
            stroke-dasharray: 314;
            stroke-dashoffset: 314;
            transition: stroke-dashoffset 1s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: var(--academic-gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Voice Recording Indicator */
        .voice-recording {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: var(--shadow-primary);
            z-index: 1000;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .recording-wave {
            width: 60px;
            height: 60px;
            background: var(--danger-color);
            border-radius: 50%;
            margin: 0 auto 1rem;
            animation: pulse 1.5s infinite;
        }

        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        /* Theme Toggle */
        .theme-toggle {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 4px;
            display: flex;
            gap: 4px;
        }

        .theme-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 16px;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .theme-btn.active {
            background: var(--primary-color);
            color: white;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: -1;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 1rem;
            }
            
            .voice-controls {
                flex-direction: column;
                gap: 1rem;
            }
            
            .voice-btn {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
            
            .study-tools {
                grid-template-columns: 1fr;
            }
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-4 { margin-top: 1rem; }
    </style>
</head>
<body data-theme="light">
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">🎓</div>
                <span>Academic Hub</span>
            </div>
            <div class="header-controls">
                <div class="theme-toggle">
                    <button class="theme-btn active" onclick="setTheme('light')">Light</button>
                    <button class="theme-btn" onclick="setTheme('dark')">Dark</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Voice Control Panel -->
    <div class="voice-panel fade-in">
        <div class="voice-controls">
            <button class="voice-btn" id="voiceBtn" onclick="toggleVoiceRecognition()">
                🎤
            </button>
            <div class="voice-status" id="voiceStatus">
                Click the microphone and say anything - I'll help you with your studies!
            </div>
        </div>
        
        <div class="voice-commands">
            <div class="command-card">
                <div class="command-title">📚 Study Help</div>
                <div class="command-example">"Explain photosynthesis" or "Help me with calculus"</div>
            </div>
            <div class="command-card">
                <div class="command-title">🧮 Math Solver</div>
                <div class="command-example">"Calculate 2 plus 2" or "Solve x squared equals 16"</div>
            </div>
            <div class="command-card">
                <div class="command-title">📝 Note Taking</div>
                <div class="command-example">"Take a note about chemistry" or "Add to my study list"</div>
            </div>
            <div class="command-card">
                <div class="command-title">⏰ Timer Control</div>
                <div class="command-example">"Start 25 minute timer" or "Set study alarm"</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Content Area -->
        <div class="content-area">
            <!-- AI Tutor -->
            <div class="card fade-in">
                <div class="card-title">
                    🤖 AI Tutor Assistant
                </div>
                <div class="card-subtitle">
                    Ask me anything about your studies - I can help with any subject, solve problems, and explain concepts!
                </div>
                
                <div class="ai-tutor">
                    <div class="chat-messages" id="chatMessages">
                        <div class="message ai">
                            <strong>🎓 AI Tutor:</strong> Hello! I'm your AI academic assistant. I can help you with any subject - mathematics, science, history, literature, programming, and more. Just ask me anything or use voice commands!
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <input type="text" class="chat-input" id="chatInput" placeholder="Ask me anything about your studies...">
                        <button class="btn btn-primary" onclick="sendMessage()">
                            <span>Send</span>
                        </button>
                        <button class="btn btn-secondary" onclick="startVoiceChat()">
                            🎤
                        </button>
                    </div>
                </div>
            </div>

            <!-- Study Tools -->
            <div class="card fade-in">
                <div class="card-title">
                    🛠️ Study Tools
                </div>
                <div class="card-subtitle">
                    Access powerful tools to enhance your learning experience
                </div>
                
                <div class="study-tools">
                    <div class="tool-card" onclick="openCalculator()">
                        <div class="tool-icon">🧮</div>
                        <div class="tool-title">Calculator</div>
                        <div class="tool-description">Scientific calculator with voice commands</div>
                    </div>
                    
                    <div class="tool-card" onclick="openTimer()">
                        <div class="tool-icon">⏰</div>
                        <div class="tool-title">Study Timer</div>
                        <div class="tool-description">Pomodoro timer with voice control</div>
                    </div>
                    
                    <div class="tool-card" onclick="openNotes()">
                        <div class="tool-icon">📝</div>
                        <div class="tool-title">Voice Notes</div>
                        <div class="tool-description">Take notes with voice commands</div>
                    </div>
                    
                    <div class="tool-card" onclick="openQuiz()">
                        <div class="tool-icon">🧠</div>
                        <div class="tool-title">AI Quiz</div>
                        <div class="tool-description">Generate quizzes on any topic</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Calculator -->
            <div class="card fade-in" id="calculatorCard">
                <div class="card-title">
                    🧮 Voice Calculator
                </div>
                
                <div class="calculator">
                    <div class="calc-display" id="calcDisplay">0</div>
                    <div class="calc-buttons">
                        <button class="calc-btn" onclick="clearCalc()">C</button>
                        <button class="calc-btn" onclick="calcInput('/')" title="÷">÷</button>
                        <button class="calc-btn" onclick="calcInput('*')" title="×">×</button>
                        <button class="calc-btn" onclick="deleteLast()">⌫</button>
                        
                        <button class="calc-btn" onclick="calcInput('7')">7</button>
                        <button class="calc-btn" onclick="calcInput('8')">8</button>
                        <button class="calc-btn" onclick="calcInput('9')">9</button>
                        <button class="calc-btn" onclick="calcInput('-')">-</button>
                        
                        <button class="calc-btn" onclick="calcInput('4')">4</button>
                        <button class="calc-btn" onclick="calcInput('5')">5</button>
                        <button class="calc-btn" onclick="calcInput('6')">6</button>
                        <button class="calc-btn" onclick="calcInput('+')">+</button>
                        
                        <button class="calc-btn" onclick="calcInput('1')">1</button>
                        <button class="calc-btn" onclick="calcInput('2')">2</button>
                        <button class="calc-btn" onclick="calcInput('3')">3</button>
                        <button class="calc-btn operator" onclick="calculate()" rowspan="2">=</button>
                        
                        <button class="calc-btn" onclick="calcInput('0')" colspan="2">0</button>
                        <button class="calc-btn" onclick="calcInput('.')">.</button>
                    </div>
                </div>
            </div>

            <!-- Study Progress -->
            <div class="card fade-in">
                <div class="card-title">
                    📊 Study Progress
                </div>
                
                <div class="progress-card">
                    <div class="progress-circle">
                        <svg>
                            <circle class="progress-bg" cx="60" cy="60" r="50"></circle>
                            <circle class="progress-bar" cx="60" cy="60" r="50" id="progressCircle"></circle>
                        </svg>
                        <div class="progress-text" id="progressText">75%</div>
                    </div>
                    <div class="card-subtitle">Weekly Study Goal</div>
                    <button class="btn btn-primary" onclick="updateProgress()">
                        Update Progress
                    </button>
                </div>
            </div>

            <!-- Quick Notes -->
            <div class="card fade-in">
                <div class="card-title">
                    📝 Quick Notes
                </div>
                
                <textarea id="notesArea" placeholder="Say 'take a note' to add voice notes here..." style="width: 100%; height: 120px; padding: 1rem; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-tertiary); color: var(--text-primary); resize: vertical;"></textarea>
                
                <div style="margin-top: 1rem;">
                    <button class="btn btn-primary" onclick="saveNotes()">
                        💾 Save Notes
                    </button>
                    <button class="btn btn-secondary" onclick="clearNotes()">
                        🗑️ Clear
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Voice Recording Indicator -->
    <div id="voiceRecording" class="voice-recording hidden">
        <div class="recording-wave"></div>
        <h3>Listening...</h3>
        <p>Speak your command or question</p>
        <button class="btn btn-secondary" onclick="stopVoiceRecognition()">Stop</button>
    </div>

    <script>
        // ============ ACADEMIC HUB WITH ADVANCED VOICE RECOGNITION ============
        
        let recognition = null;
        let isListening = false;
        let currentExpression = '';
        let chatHistory = [];
        let studyNotes = [];

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeVoiceRecognition();
            initializeTextToSpeech();
            loadSavedData();
            
            // Add keyboard shortcuts
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        });

        // ============ VOICE RECOGNITION SYSTEM ============
        function initializeVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onstart = function() {
                    isListening = true;
                    document.getElementById('voiceBtn').classList.add('listening');
                    document.getElementById('voiceStatus').textContent = 'Listening... Speak now!';
                    document.getElementById('voiceRecording').classList.remove('hidden');
                };
                
                recognition.onend = function() {
                    isListening = false;
                    document.getElementById('voiceBtn').classList.remove('listening');
                    document.getElementById('voiceStatus').textContent = 'Click the microphone and say anything - I\'ll help you with your studies!';
                    document.getElementById('voiceRecording').classList.add('hidden');
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript.toLowerCase();
                    console.log('Voice command received:', transcript);
                    processVoiceCommand(transcript);
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    speak('Sorry, I didn\'t catch that. Please try again.');
                };
            } else {
                document.getElementById('voiceStatus').textContent = 'Voice recognition not supported in this browser';
            }
        }

        function toggleVoiceRecognition() {
            if (!recognition) {
                speak('Voice recognition is not supported in this browser');
                return;
            }
            
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

        function stopVoiceRecognition() {
            if (recognition && isListening) {
                recognition.stop();
            }
        }

        // ============ VOICE COMMAND PROCESSING ============
        function processVoiceCommand(transcript) {
            console.log('Processing command:', transcript);
            
            // Math calculations
            if (transcript.includes('calculate') || transcript.includes('what is') || transcript.includes('solve') || 
                transcript.includes('plus') || transcript.includes('minus') || transcript.includes('times') || 
                transcript.includes('divided by') || transcript.includes('squared') || transcript.includes('equals')) {
                handleMathCommand(transcript);
                return;
            }
            
            // Timer commands
            if (transcript.includes('timer') || transcript.includes('set alarm') || transcript.includes('start timer')) {
                handleTimerCommand(transcript);
                return;
            }
            
            // Note taking
            if (transcript.includes('take a note') || transcript.includes('add note') || transcript.includes('write down')) {
                handleNoteCommand(transcript);
                return;
            }
            
            // Theme change
            if (transcript.includes('dark mode') || transcript.includes('dark theme')) {
                setTheme('dark');
                speak('Switched to dark theme');
                return;
            }
            
            if (transcript.includes('light mode') || transcript.includes('light theme')) {
                setTheme('light');
                speak('Switched to light theme');
                return;
            }
            
            // Calculator control
            if (transcript.includes('open calculator') || transcript.includes('show calculator')) {
                openCalculator();
                speak('Calculator is ready for use');
                return;
            }
            
            // Clear commands
            if (transcript.includes('clear calculator') || transcript.includes('reset calculator')) {
                clearCalc();
                speak('Calculator cleared');
                return;
            }
            
            if (transcript.includes('clear notes') || transcript.includes('delete notes')) {
                clearNotes();
                speak('Notes cleared');
                return;
            }
            
            // Help command
            if (transcript.includes('help') || transcript.includes('what can you do')) {
                const helpMessage = `I can help you with many things! I can solve math problems, explain concepts, set timers, take notes, and answer questions about any academic subject. Try saying things like "calculate 2 plus 2", "explain photosynthesis", "set a 25 minute timer", or "take a note about chemistry".`;
                addChatMessage(helpMessage, 'ai');
                speak(helpMessage);
                return;
            }
            
            // Default: Send to AI tutor for academic help
            handleAcademicQuestion(transcript);
        }

        // ============ SPECIALIZED COMMAND HANDLERS ============
        function handleMathCommand(transcript) {
            try {
                // Convert voice to math expression
                let expression = transcript
                    .replace(/calculate|what is|solve|equals/g, '')
                    .replace(/plus/g, '+')
                    .replace(/minus/g, '-')
                    .replace(/times|multiplied by/g, '*')
                    .replace(/divided by/g, '/')
                    .replace(/squared/g, '^2')
                    .replace(/cubed/g, '^3')
                    .replace(/to the power of/g, '^')
                    .replace(/square root of/g, 'sqrt(')
                    .replace(/percent/g, '/100')
                    .trim();
                
                // Handle special cases
                if (expression.includes('sqrt(') && !expression.includes(')')) {
                    expression += ')';
                }
                
                // Evaluate using math.js for advanced calculations
                let result;
                try {
                    result = math.evaluate(expression);
                } catch {
                    // Fallback to basic eval for simple expressions
                    result = eval(expression.replace(/\^/g, '**'));
                }
                
                // Update calculator display
                document.getElementById('calcDisplay').textContent = result;
                
                // Respond with voice and chat
                const response = `The answer is ${result}`;
                addChatMessage(`Calculate: ${expression} = ${result}`, 'ai');
                speak(response);
                
            } catch (error) {
                console.error('Math calculation error:', error);
                const errorMsg = 'Sorry, I couldn\'t calculate that. Please try rephrasing your math problem.';
                addChatMessage(errorMsg, 'ai');
                speak(errorMsg);
            }
        }

        function handleTimerCommand(transcript) {
            // Extract time duration
            const timeMatch = transcript.match(/(\d+)\s*(minute|minutes|min|hour|hours|second|seconds)/);
            if (timeMatch) {
                const duration = parseInt(timeMatch[1]);
                const unit = timeMatch[2];
                
                let seconds = duration;
                if (unit.includes('minute') || unit.includes('min')) {
                    seconds = duration * 60;
                } else if (unit.includes('hour')) {
                    seconds = duration * 3600;
                }
                
                startTimer(seconds);
                speak(`Timer set for ${duration} ${unit}`);
                addChatMessage(`⏰ Timer set for ${duration} ${unit}`, 'ai');
            } else {
                // Default 25-minute Pomodoro timer
                startTimer(1500);
                speak('Started 25-minute study timer');
                addChatMessage('⏰ Started 25-minute Pomodoro study timer', 'ai');
            }
        }

        function handleNoteCommand(transcript) {
            // Extract the note content
            const noteContent = transcript
                .replace(/take a note|add note|write down|note that/g, '')
                .replace(/about|on/g, '')
                .trim();
            
            if (noteContent) {
                const timestamp = new Date().toLocaleString();
                const fullNote = `[${timestamp}] ${noteContent}`;
                
                // Add to notes area
                const notesArea = document.getElementById('notesArea');
                notesArea.value += (notesArea.value ? '\n\n' : '') + fullNote;
                
                // Save and respond
                saveNotes();
                speak(`Note added: ${noteContent}`);
                addChatMessage(`📝 Note added: ${noteContent}`, 'ai');
            } else {
                speak('What would you like me to note down?');
                addChatMessage('📝 What would you like me to note down?', 'ai');
            }
        }

        function handleAcademicQuestion(transcript) {
            // Send the original transcript to AI tutor
            document.getElementById('chatInput').value = transcript;
            sendMessage();
        }

        // ============ TEXT-TO-SPEECH SYSTEM ============
        let voices = [];
        let selectedVoice = null;

        function initializeTextToSpeech() {
            if ('speechSynthesis' in window) {
                speechSynthesis.onvoiceschanged = function() {
                    voices = speechSynthesis.getVoices();
                    // Prefer female English voices for academic setting
                    selectedVoice = voices.find(voice => 
                        voice.lang.includes('en') && voice.name.toLowerCase().includes('female')
                    ) || voices.find(voice => voice.lang.includes('en')) || voices[0];
                };
            }
        }

        function speak(text) {
            if ('speechSynthesis' in window && text) {
                speechSynthesis.cancel(); // Stop any ongoing speech
                
                const utterance = new SpeechSynthesisUtterance(text);
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                }
                utterance.rate = 0.9;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                
                speechSynthesis.speak(utterance);
            }
        }

        // ============ AI TUTOR CHAT SYSTEM ============
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            addChatMessage('Thinking...', 'ai', true);
            
            // Simulate AI response (replace with real AI API)
            setTimeout(() => {
                removeTypingIndicator();
                const response = generateAIResponse(message);
                addChatMessage(response, 'ai');
                speak(response.substring(0, 200)); // Speak first 200 characters
            }, 1500);
        }

        function generateAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Subject-specific responses
            if (lowerMessage.includes('math') || lowerMessage.includes('calculate') || lowerMessage.includes('algebra')) {
                return "I'd be happy to help you with mathematics! I can solve equations, explain concepts like algebra and calculus, help with geometry problems, and work through step-by-step solutions. What specific math topic would you like to explore?";
            }
            
            if (lowerMessage.includes('science') || lowerMessage.includes('physics') || lowerMessage.includes('chemistry') || lowerMessage.includes('biology')) {
                return "Science is fascinating! I can help explain concepts in physics (like motion, energy, and forces), chemistry (atoms, molecules, reactions), biology (cells, genetics, evolution), and more. What scientific concept would you like me to explain?";
            }
            
            if (lowerMessage.includes('history') || lowerMessage.includes('historical')) {
                return "History helps us understand our world! I can discuss different time periods, important events, historical figures, and how past events shaped our present. What historical topic interests you?";
            }
            
            if (lowerMessage.includes('english') || lowerMessage.includes('literature') || lowerMessage.includes('writing')) {
                return "I love helping with English and literature! I can assist with writing essays, analyzing poems and stories, understanding grammar, improving vocabulary, and developing better communication skills. What would you like to work on?";
            }
            
            if (lowerMessage.includes('programming') || lowerMessage.includes('coding') || lowerMessage.includes('computer')) {
                return "Programming is an amazing skill! I can help you learn different programming languages like Python, JavaScript, Java, and more. I can explain concepts, help debug code, and guide you through projects. What programming topic interests you?";
            }
            
            // General study help
            if (lowerMessage.includes('study') || lowerMessage.includes('learn') || lowerMessage.includes('homework')) {
                return "I'm here to make studying more effective! I can help you understand difficult concepts, create study plans, explain topics in simple terms, and provide memory techniques. What subject or topic would you like to focus on?";
            }
            
            // Default academic response
            return `Great question! I'm your AI academic assistant and I'm here to help you learn and understand any topic. Whether it's mathematics, science, history, literature, or any other subject, I can provide explanations, solve problems, and guide you through concepts. What would you like to explore today?`;
        }

        function addChatMessage(message, sender, isTyping = false) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            if (isTyping) messageDiv.classList.add('typing');
            
            if (sender === 'ai') {
                messageDiv.innerHTML = `<strong>🎓 AI Tutor:</strong> ${message}`;
            } else {
                messageDiv.innerHTML = `<strong>You:</strong> ${message}`;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Save to history
            if (!isTyping) {
                chatHistory.push({ sender, message, timestamp: new Date() });
                saveChatHistory();
            }
        }

        function removeTypingIndicator() {
            const typingMessage = document.querySelector('.message.typing');
            if (typingMessage) {
                typingMessage.remove();
            }
        }

        function startVoiceChat() {
            if (recognition) {
                recognition.start();
            } else {
                speak('Voice recognition is not available in this browser');
            }
        }

        // ============ CALCULATOR FUNCTIONS ============
        function calcInput(value) {
            const display = document.getElementById('calcDisplay');
            if (display.textContent === '0') {
                display.textContent = value;
            } else {
                display.textContent += value;
            }
            currentExpression = display.textContent;
        }

        function clearCalc() {
            document.getElementById('calcDisplay').textContent = '0';
            currentExpression = '';
        }

        function deleteLast() {
            const display = document.getElementById('calcDisplay');
            if (display.textContent.length > 1) {
                display.textContent = display.textContent.slice(0, -1);
            } else {
                display.textContent = '0';
            }
            currentExpression = display.textContent;
        }

        function calculate() {
            try {
                const result = math.evaluate(currentExpression);
                document.getElementById('calcDisplay').textContent = result;
                speak(`The result is ${result}`);
            } catch (error) {
                document.getElementById('calcDisplay').textContent = 'Error';
                speak('Calculation error');
            }
        }

        // ============ STUDY TOOLS ============
        let studyTimer = null;

        function startTimer(seconds) {
            if (studyTimer) {
                clearInterval(studyTimer);
            }
            
            let timeLeft = seconds;
            const minutes = Math.floor(seconds / 60);
            
            addChatMessage(`⏰ Timer started for ${minutes} minutes`, 'ai');
            
            studyTimer = setInterval(() => {
                timeLeft--;
                
                if (timeLeft <= 0) {
                    clearInterval(studyTimer);
                    studyTimer = null;
                    
                    // Timer completion
                    const completionMsg = 'Time\'s up! Great job studying. Take a break!';
                    addChatMessage(`⏰ ${completionMsg}`, 'ai');
                    speak(completionMsg);
                    
                    // Browser notification
                    if ('Notification' in window && Notification.permission === 'granted') {
                        new Notification('Study Timer Complete!', {
                            body: completionMsg,
                            icon: 'icon-192.png'
                        });
                    }
                }
            }, 1000);
        }

        function openCalculator() {
            document.getElementById('calculatorCard').scrollIntoView({ behavior: 'smooth' });
            speak('Calculator is ready for use');
        }

        function openTimer() {
            speak('Say "set timer for X minutes" to start a study timer');
            addChatMessage('🕐 Say "set timer for X minutes" to start a study timer, or try "start 25 minute timer" for a Pomodoro session.', 'ai');
        }

        function openNotes() {
            document.getElementById('notesArea').focus();
            speak('Notes area is ready. You can type or say "take a note" followed by your note.');
            addChatMessage('📝 You can type in the notes area or use voice commands like "take a note about chemistry"', 'ai');
        }

        function openQuiz() {
            const quizMsg = 'I can create quizzes on any topic! Try saying "quiz me on biology" or "test my knowledge of world history"';
            addChatMessage(`🧠 ${quizMsg}`, 'ai');
            speak(quizMsg);
        }

        // ============ NOTES SYSTEM ============
        function saveNotes() {
            const notes = document.getElementById('notesArea').value;
            localStorage.setItem('academicHub_notes', notes);
            speak('Notes saved successfully');
            
            // Show brief confirmation
            const originalBg = document.getElementById('notesArea').style.background;
            document.getElementById('notesArea').style.background = 'rgba(16, 185, 129, 0.1)';
            setTimeout(() => {
                document.getElementById('notesArea').style.background = originalBg;
            }, 1000);
        }

        function clearNotes() {
            if (confirm('Are you sure you want to clear all notes?')) {
                document.getElementById('notesArea').value = '';
                localStorage.removeItem('academicHub_notes');
                speak('Notes cleared');
            }
        }

        // ============ PROGRESS TRACKING ============
        function updateProgress() {
            const currentProgress = parseInt(document.getElementById('progressText').textContent);
            const newProgress = Math.min(currentProgress + 10, 100);
            
            setProgress(newProgress);
            speak(`Progress updated to ${newProgress} percent`);
            addChatMessage(`📊 Study progress updated to ${newProgress}%! Keep up the great work!`, 'ai');
        }

        function setProgress(percentage) {
            const circle = document.getElementById('progressCircle');
            const text = document.getElementById('progressText');
            
            const circumference = 2 * Math.PI * 50;
            const offset = circumference - (percentage / 100) * circumference;
            
            circle.style.strokeDashoffset = offset;
            text.textContent = `${percentage}%`;
            
            localStorage.setItem('academicHub_progress', percentage);
        }

        // ============ THEME MANAGEMENT ============
        function setTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            
            // Update active button
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase() === theme);
            });
            
            localStorage.setItem('academicHub_theme', theme);
        }

        // ============ DATA PERSISTENCE ============
        function saveChatHistory() {
            localStorage.setItem('academicHub_chatHistory', JSON.stringify(chatHistory.slice(-50))); // Keep last 50 messages
        }

        function loadSavedData() {
            // Load theme
            const savedTheme = localStorage.getItem('academicHub_theme');
            if (savedTheme) {
                setTheme(savedTheme);
            }
            
            // Load notes
            const savedNotes = localStorage.getItem('academicHub_notes');
            if (savedNotes) {
                document.getElementById('notesArea').value = savedNotes;
            }
            
            // Load progress
            const savedProgress = localStorage.getItem('academicHub_progress');
            if (savedProgress) {
                setProgress(parseInt(savedProgress));
            }
            
            // Load chat history
            const savedChat = localStorage.getItem('academicHub_chatHistory');
            if (savedChat) {
                chatHistory = JSON.parse(savedChat);
                // Optionally restore recent messages to chat
            }
            
            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        // ============ INITIALIZATION ============
        console.log('🎓 Academic Hub initialized with advanced voice recognition!');
        console.log('Try saying: "Calculate 2 plus 2", "Explain photosynthesis", "Set 25 minute timer", "Take a note about chemistry"');
    </script>
</body>
</html>
